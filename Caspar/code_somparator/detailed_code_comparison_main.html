<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Code Comparison Report</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 20px; line-height: 1.6; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .summary-table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        .summary-table th, .summary-table td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        .summary-table th { background-color: #f2f2f2; font-weight: bold; }
        .function-container { background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 8px; margin: 10px 0; padding: 15px; }
        .function-header { background: #343a40; color: white; padding: 10px; border-radius: 5px; margin-bottom: 10px; font-family: monospace; font-weight: bold; }
        .code-block { background: #ffffff; border: 1px solid #dee2e6; border-radius: 5px; padding: 15px; margin: 10px 0; font-family: 'Courier New', monospace; white-space: pre-wrap; line-height: 1.4; }
        .added-line { background-color: #d4edda !important; color: #155724 !important; display: block; margin: 2px 0; padding: 2px 5px; border-left: 4px solid #28a745; }
        .removed-line { background-color: #f8d7da !important; color: #721c24 !important; display: block; margin: 2px 0; padding: 2px 5px; border-left: 4px solid #dc3545; }
        .unchanged-line { display: block; margin: 1px 0; padding: 2px 5px; }
        .section { margin: 30px 0; padding: 20px; border-radius: 8px; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .file-title { color: #495057; border-bottom: 2px solid #007bff; padding-bottom: 10px; margin-bottom: 20px; }
        .legend { background: #e9ecef; padding: 15px; border-radius: 5px; margin: 20px 0; }
        .legend-item { margin: 5px 0; }
        .no-changes { color: #6c757d; font-style: italic; }
    </style>
</head>
<body>

        <div class="header">
            <h1>üìä Code Comparison Report - Complete Functions View</h1>
            <p><strong>üìÅ Version v_3.2.0 (New):</strong> E:/Job_1/SHS--version_3.1.3/FSTI/Piston/Caspar/main/src</p>
            <p><strong>üìÅ Version v_2.0.0 (Old):</strong> E:/Job_1/SHS--Original/localCopy/FSTI/piston/Caspar/main/src</p>
            <p><strong>üìÖ Generated:</strong> 2025-06-08 18:34:13</p>
        </div>
        
        <div class="section">
            <h2>üéØ Quick Summary</h2>
            <table class="summary-table">
                <tr><th>Status</th><th>Count</th><th>Files</th></tr>
        <tr><td>üîµ <strong>Modified</strong></td><td>17</td><td>CGapInput.cpp, CGapODE.cpp, CNewtonIteration.cpp...</td></tr><tr><td>‚ú® <strong>New in v_3.2.0</strong></td><td>1</td><td>version_define.h</td></tr><tr><td>üóëÔ∏è <strong>Removed from v_2.0.0</strong></td><td>1</td><td>CPistonGapHD.cpp</td></tr><tr><td>‚úÖ <strong>Identical</strong></td><td>13</td><td>No changes</td></tr><tr><td><strong>üìä Total Changes</strong></td><td><strong>+1000 -2953</strong></td><td><strong>Net: -1953 lines</strong></td></tr>
            </table>
        </div>
        
        <div class="legend">
            <h3>üîπ How to Read the Code Changes:</h3>
            <div class="legend-item"><span class="removed-line" style="display: inline; padding: 2px 5px;">üóëÔ∏è Red sections</span> show code that was REMOVED from v_2.0.0</div>
            <div class="legend-item"><span class="added-line" style="display: inline; padding: 2px 5px;">‚ú® Green sections</span> show code that was ADDED in v_3.2.0</div>
            <div class="legend-item"><span class="unchanged-line" style="display: inline; padding: 2px 5px;">üìÑ Gray lines</span> provide context around changes</div>
            <p><strong>New Approach:</strong> Instead of mixing added/removed lines together, each change is shown as a separate section with clear context, making it easier to understand what was removed vs what was added.</p>
        </div>
        <div class="section"><h2>üìã File-by-File Analysis - Complete Functions</h2><div class="section"><h3 class="file-title">üìÑ CGapInput.cpp</h3><p><strong>Status:</strong> üîµ 8 additions and 44 deletions (net reduction of 36 lines)</p><p><strong>Size:</strong> 38,980 ‚Üí 37,943 bytes (-1,037 bytes)</p><p><strong>Changes:</strong> +8 lines added, -44 lines removed</p><p><strong>Types of Changes:</strong> Functions, Comments, Control flow</p><h4>üîß Code Changes (Separated by Type):</h4><h5>üóëÔ∏è Removed Code Sections:</h5><div class="function-container"><div class="function-header">‚ùå Removed Section 1 (around line 1210)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  			{</span><span class="unchanged-line">  				iniss &amp;gt;&amp;gt; xyzfB_th(i,0) &amp;gt;&amp;gt; xyzfB_th(i,1) &amp;gt;&amp;gt; xyzfB_th(i,2);</span><span class="unchanged-line">  			};</span><span class="removed-line">- 			//xyzfB_th(i,2) -= meshshift;</span><span class="unchanged-line">  			i++;</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 2 (around line 1244)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  			{</span><span class="unchanged-line">  				iniss &amp;gt;&amp;gt; xyznB_th(i,0) &amp;gt;&amp;gt; xyznB_th(i,1) &amp;gt;&amp;gt; xyznB_th(i,2);</span><span class="unchanged-line">  			};</span><span class="removed-line">- 			//xyznB_th(i,2) -= meshshift;</span><span class="unchanged-line">  			i++;</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 3 (around line 1267)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	nFaces_gap = (int) xyzfK_p.extent(0);</span><span class="unchanged-line">  	nNodes_gap = (int) xyznK_p.extent(0);</span><span class="unchanged-line">  	//number of matrices: gap_faces + DC + CASE + socket_0 + socket_1</span><span class="removed-line">- 	nIM = nFaces_gap + 4;//4;</span><span class="unchanged-line">  	//size influence matrices total container</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 4 (around line 1355)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		//reading loop over number of matrices</span><span class="unchanged-line">  		for(int i=0;i&amp;lt;nIM;i++)</span><span class="unchanged-line">  		{</span><span class="removed-line">- 			if(i&amp;lt;nIM-4)//4)</span><span class="unchanged-line">  			{</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 5 (around line 1661)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	double phitemp;</span><span class="unchanged-line">  	double FTGtemp;</span><span class="unchanged-line">  </span><span class="removed-line">- 	ifstream fFTGFile("./output/slipper/ftg.txt");</span><span class="unchanged-line">  </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><h5>‚ú® Added Code Sections:</h5><div class="function-container"><div class="function-header">‚úÖ Added Section 1 (around line 1265)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	nFaces_gap = (int) xyzfK_p.extent(0);</span><span class="unchanged-line">  	nNodes_gap = (int) xyznK_p.extent(0);</span><span class="unchanged-line">  	//number of matrices: gap_faces + DC + CASE + socket_0 + socket_1</span><span class="added-line">+ 	nIM = nFaces_gap + 2;//4;</span><span class="unchanged-line">  	//size influence matrices total container</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 2 (around line 1308)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		fin.read(reinterpret_cast&amp;lt;char*&amp;gt;(IM), nNodes_gap*nFaces_gap*sizeof(double));</span><span class="unchanged-line">  		for(int j=0;j&amp;lt;nNodes_gap;j++)</span><span class="unchanged-line">  		{</span><span class="added-line">+ 			</span><span class="unchanged-line">  			IM_piston(j+nNodes_gap*(nFaces_gap+1)) = 0.01 * IM[j];</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 3 (around line 1320)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		//reading loop over number of matrices</span><span class="unchanged-line">  		for(int i=0;i&amp;lt;nIM;i++)</span><span class="unchanged-line">  		{</span><span class="added-line">+ 			if(i&amp;lt;nIM-2)//4)</span><span class="unchanged-line">  			{</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 4 (around line 1626)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	double phitemp;</span><span class="unchanged-line">  	double FTGtemp;</span><span class="unchanged-line">  </span><span class="added-line">+ 	ifstream fFTGFile("./outputs/slipper/ftg.txt");</span><span class="unchanged-line">  </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div></div><div class="section"><h3 class="file-title">üìÑ CGapODE.cpp</h3><p><strong>Status:</strong> üîµ 242 additions and 261 deletions (net reduction of 19 lines)</p><p><strong>Size:</strong> 56,887 ‚Üí 64,824 bytes (+7,937 bytes)</p><p><strong>Changes:</strong> +242 lines added, -261 lines removed</p><p><strong>Types of Changes:</strong> Class/Struct definitions, Functions, Include statements, Comments, Control flow, Variable assignments</p><h4>üîß Code Changes (Separated by Type):</h4><h5>üóëÔ∏è Removed Code Sections:</h5><div class="function-container"><div class="function-header">‚ùå Removed Section 1 (around line 13)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  extern bool coupled_caspar_simulation;</span><span class="unchanged-line">  extern double caspar_autoconverge;</span><span class="unchanged-line">  extern int min_revs;</span><span class="removed-line">- extern int hd_revs;</span><span class="unchanged-line">  </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 2 (around line 239)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	myNewtonIteration.dt = hmax;</span><span class="unchanged-line">  	</span><span class="unchanged-line">  	//Final value for x</span><span class="removed-line">- 	xend = myinput.data.lubrication_module.n_lubrication_revolutions / (myinput.data.operating_conditions.speed/(2*PI));</span><span class="unchanged-line">  	//Interval of x for printing output</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 3 (around line 257)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	Array&amp;lt;double,2&amp;gt; convergance;</span><span class="unchanged-line">  	convergance.resize(6,2);</span><span class="unchanged-line">  	convergance = 0.0;</span><span class="removed-line">- 	//double vel,lim;</span><span class="unchanged-line">  	do</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 4 (around line 291)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		};</span><span class="unchanged-line">  		//assign new time</span><span class="unchanged-line">  		y[0] = x;</span><span class="removed-line">- 		// assign h to h_pre</span><span class="removed-line">- 		//myNewtonIteration.myPistonGap.h_pre = myNewtonIteration.myPistonGap.h;</span><span class="unchanged-line">  		//Handle coupled caspar blocking events</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 5 (around line 304)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  			//Check for the end of a revolution</span><span class="unchanged-line">  			</span><span class="unchanged-line">  			//double deg = fmod(6.0*myGapInput.General.speed*x, 360.0);//should work if needed</span><span class="removed-line">- 			</span><span class="unchanged-line">  			</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 6 (around line 449)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	if ( xold==0.0 || x&amp;gt;(xd+tol) ) </span><span class="unchanged-line">  	{</span><span class="unchanged-line">  </span><span class="removed-line">- 		</span><span class="removed-line">- </span><span class="unchanged-line">  		//Population of total loss vectors</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 7 (around line 498)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  			PhiD_vol_tot += myNewtonIteration.myPistonGap.PhiD_vol;</span><span class="unchanged-line">  		}</span><span class="unchanged-line">  </span><span class="removed-line">- </span><span class="removed-line">- 		//Positions and velocities, .pos file</span><span class="removed-line">- 		fout.open("./output/piston/piston.txt",ios::app);</span><span class="removed-line">- 		fout &amp;lt;&amp;lt; scientific &amp;lt;&amp;lt; myGapResult.time												//1</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myinput.data.operating_conditions.speed * myGapResult.time / (2*PI)	//2</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myGapResult.phi														//3</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myGapResult.gappositions[1]											//4</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myGapResult.gappositions[2]											//5</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myGapResult.gappositions[3]											//6</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myGapResult.gappositions[4]											//7</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myGapResult.gapvelocities[0]											//8</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myGapResult.gapvelocities[1]											//9</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myGapResult.gapvelocities[2]											//10</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myGapResult.gapvelocities[3]											//11</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.geometrypistongap.lvar					//12</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.geometrypistongap.lout					//13</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.geometrypistongap.pos_A				//14</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.geometrypistongap.pos_B				//15</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.geometrypistongap.zRK					//16</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.geometrypistongap.sK					//17</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.geometrypistongap.lA					//18</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.geometrypistongap.lB					//19</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.geometrypistongap.z_A					//20</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.geometrypistongap.z_B					//21</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.operatingpistongap.vK					//22</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.operatingpistongap.QSK					//23</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.operatingpistongap.QSK_p				//24</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.operatingpistongap.QSK_c				//25</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.forcespistongap.MTK					//26</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.forcespistongap.MTKtan					//27</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; sum(myNewtonIteration.myPistonGap.forcespistongap.FTKy)				//28</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; sum(myNewtonIteration.myPistonGap.forcespistongap.FTKy_p)			//29</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; sum(myNewtonIteration.myPistonGap.forcespistongap.FTKy_c)			//30</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; sum(myNewtonIteration.myPistonGap.forcespistongap.FTKx	)			//31</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; sum(myNewtonIteration.myPistonGap.forcespistongap.FTKx_p)			//32</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; sum(myNewtonIteration.myPistonGap.forcespistongap.FTKx_c)			//33</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.forcespistongap.FTG					//34</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myGapResult.pDC														//35</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; sum(myNewtonIteration.myPistonGap.forcespistongap.FTby	)			//36</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; sum(myNewtonIteration.myPistonGap.forcespistongap.FTby_p)			//37</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; sum(myNewtonIteration.myPistonGap.forcespistongap.FTby_c)			//38</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; sum(myNewtonIteration.myPistonGap.forcespistongap.FTbx	)			//39</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; sum(myNewtonIteration.myPistonGap.forcespistongap.FTbx_p)			//40</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; sum(myNewtonIteration.myPistonGap.forcespistongap.FTbx_c)			//41</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myGapResult.pHP														//42</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myGapResult.PLP														//43</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.forcespistongap.F_external[0]			//44</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.forcespistongap.F_external[1]			//45</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.forcespistongap.F_external[2]			//46</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.forcespistongap.F_external[3]			//47</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.forcespistongap.F_fluid[0]				//48</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.forcespistongap.F_fluid[1]				//49</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.forcespistongap.F_fluid[2]				//50</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.forcespistongap.F_fluid[3]				//51</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.forcespistongap.F_contact[0]			//52</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.forcespistongap.F_contact[1]			//53</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.forcespistongap.F_contact[2]			//54</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.forcespistongap.F_contact[3]			//55</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.forcespistongap.dF[0]					//56</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.forcespistongap.dF[1]					//57</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.forcespistongap.dF[2]					//58</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.forcespistongap.dF[3]					//59</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; QSKTot																//60</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; MSKTot																//61</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; MFT																	//62</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; PhiD_mech_tot														//63</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; PhiD_vol_tot															//64</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.PhiD_mech								//65</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.PhiD_vol								//66</span><span class="removed-line">- 			&amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 		fout.close();</span><span class="removed-line">- 		fout.clear();</span><span class="removed-line">- </span><span class="removed-line">- </span><span class="removed-line">- 		//Output FTK force for coupled simulation.</span><span class="removed-line">- 		</span><span class="removed-line">- 		if(coupled_caspar_simulation){</span><span class="removed-line">- 			fout.open("./output/piston/ftk.txt",ios::app);</span><span class="removed-line">- 			fout &amp;lt;&amp;lt; scientific &amp;lt;&amp;lt; myGapResult.time											//1</span><span class="removed-line">- 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; myGapResult.phi													//2</span><span class="removed-line">- 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; sum(myNewtonIteration.myPistonGap.forcespistongap.FTKy) &amp;lt;&amp;lt; "\n";		//3</span><span class="unchanged-line">  			fout.close();</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 8 (around line 593)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  				//Piston total heat flux, .QK file  [W/m2]</span><span class="unchanged-line">  				fout.open("./output/piston/matlab/Piston_Body_Heat_Flux.txt",ios::app);</span><span class="unchanged-line">  				fout &amp;lt;&amp;lt; "%Revolution Number: " &amp;lt;&amp;lt; revcounter &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 				for(int j=0;j&amp;lt;myNewtonIteration.myPistonGap.qbi_piston.size();j++)</span><span class="removed-line">- 				{</span><span class="removed-line">- 				for(int i=0;i&amp;lt;(int) myNewtonIteration.myPistonGap.qbi_piston[j].extent(0);i++)</span><span class="removed-line">- 				{</span><span class="removed-line">- 					fout &amp;lt;&amp;lt; scientific &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.qbi_piston[j](i) &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 				}</span><span class="unchanged-line">  				}</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 9 (around line 607)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  				//Cylinder total heat flux, .QB file  [W/m2]</span><span class="unchanged-line">  				fout.open("./output/piston/matlab/Piston_Cylinder_Body_Heat_Flux.txt",ios::app);</span><span class="unchanged-line">  				fout &amp;lt;&amp;lt; "%Revolution Number: " &amp;lt;&amp;lt; revcounter &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 				for(int j=0;j&amp;lt;myNewtonIteration.myPistonGap.qbi_cylinder.size();j++)</span><span class="removed-line">- 				{</span><span class="removed-line">- 				for(int i=0;i&amp;lt;(int) myNewtonIteration.myPistonGap.qbi_cylinder[j].extent(0);i++)</span><span class="removed-line">- 				{</span><span class="removed-line">- 					fout &amp;lt;&amp;lt; scientific &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.qbi_cylinder[j](i) &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 				}</span><span class="unchanged-line">  				}</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 10 (around line 729)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		fout.close();</span><span class="unchanged-line">  		fout.clear();</span><span class="unchanged-line">  </span><span class="removed-line">- 		//dht_total</span><span class="removed-line">- 		fout.open("./output/piston/matlab/dht_total.txt",ios::app);</span><span class="removed-line">- 		fout &amp;lt;&amp;lt; "%PHI [deg]: " &amp;lt;&amp;lt; myGapResult.phi &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 		for(int i = 0; i &amp;lt; N ; i++)</span><span class="removed-line">- 		{</span><span class="removed-line">- 			for(int j = 0; j &amp;lt; M ; j++)</span><span class="removed-line">-             {</span><span class="removed-line">- 				fout &amp;lt;&amp;lt; scientific &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.dht_total(j+i*M) &amp;lt;&amp;lt; "\t" ;</span><span class="removed-line">-             }</span><span class="removed-line">- 			fout &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 		}</span><span class="removed-line">- 		fout &amp;lt;&amp;lt; "%" &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 		fout.close();</span><span class="removed-line">- 		fout.clear();</span><span class="removed-line">- </span><span class="removed-line">- 		//oilviscosity</span><span class="removed-line">- 		fout.open("./output/piston/matlab/oilviscosity.txt",ios::app);</span><span class="removed-line">- 		fout &amp;lt;&amp;lt; "%PHI [deg]: " &amp;lt;&amp;lt; myGapResult.phi &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 		for(int i = 0; i &amp;lt; N ; i++)</span><span class="removed-line">- 		{</span><span class="removed-line">- 			for(int j = 0; j &amp;lt; M ; j++)</span><span class="removed-line">-             {</span><span class="removed-line">- 				fout &amp;lt;&amp;lt; scientific &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.mu(j+i*M) &amp;lt;&amp;lt; "\t" ;</span><span class="removed-line">-             }</span><span class="removed-line">- 			fout &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 		}</span><span class="removed-line">- 		fout &amp;lt;&amp;lt; "%" &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 		fout.close();</span><span class="removed-line">- 		fout.clear();</span><span class="removed-line">- </span><span class="removed-line">- 		//oildensity</span><span class="removed-line">- 		fout.open("./output/piston/matlab/oildensity.txt",ios::app);</span><span class="removed-line">- 		fout &amp;lt;&amp;lt; "%PHI [deg]: " &amp;lt;&amp;lt; myGapResult.phi &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 		for(int i = 0; i &amp;lt; N ; i++)</span><span class="removed-line">- 		{</span><span class="removed-line">- 			for(int j = 0; j &amp;lt; M ; j++)</span><span class="removed-line">-             {</span><span class="removed-line">- 				fout &amp;lt;&amp;lt; scientific &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.rho2d(j+i*M) &amp;lt;&amp;lt; "\t" ;</span><span class="removed-line">-             }</span><span class="removed-line">- 			fout &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 		}</span><span class="removed-line">- 		fout &amp;lt;&amp;lt; "%" &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 		fout.close();</span><span class="removed-line">- 		fout.clear();</span><span class="removed-line">- </span><span class="unchanged-line">  </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 11 (around line 794)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  				}</span><span class="unchanged-line">  				else</span><span class="unchanged-line">  				{</span><span class="removed-line">- 					fout &amp;lt;&amp;lt; scientific &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.p(j+i*M)*1.0e-5 &amp;lt;&amp;lt; "\t" ;</span><span class="unchanged-line">  				}</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 12 (around line 999)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		//Output vtk (vectors are outside first, then inside).</span><span class="unchanged-line">  		</span><span class="unchanged-line">  		static int vtknum = ceil(360 / myinput.data.options_piston.numeric.Simalphaplot);//Number of VTK files to retain not to exceed one revolution to minimize file size.</span><span class="removed-line">- 		short Mcells, Ncells,Qcells;</span><span class="unchanged-line">  		if(myinput.data.options_piston.general.ReynoldsMultiGrid){</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 13 (around line 1042)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		}</span><span class="unchanged-line">  		fout &amp;lt;&amp;lt; " " &amp;lt;&amp;lt; "\n";</span><span class="unchanged-line">  		fout &amp;lt;&amp;lt; "POINT_DATA " &amp;lt;&amp;lt; 2*Mcells*(Ncells+1)&amp;lt;&amp;lt;"\n";</span><span class="removed-line">- 		fout &amp;lt;&amp;lt; "VECTORS Film_Shape_[m] double"&amp;lt;&amp;lt;"\n";</span><span class="unchanged-line">  		for(int i=0;i&amp;lt;Ncells;i++)</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 14 (around line 1068)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  			fout &amp;lt;&amp;lt; scientific &amp;lt;&amp;lt; ( myNewtonIteration.myPistonGap.defB_gap(j) - myNewtonIteration.myPistonGap.McrB(j) - myNewtonIteration.myPistonGap.h(j) ) &amp;lt;&amp;lt; "\t0\t0" &amp;lt;&amp;lt; "\n";</span><span class="unchanged-line">  		}</span><span class="unchanged-line">  		fout &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 		fout &amp;lt;&amp;lt; "VECTORS Pressure_Deformation_[m] double" &amp;lt;&amp;lt; "\n";</span><span class="unchanged-line">  		for(int i = 0; i &amp;lt; Ncells ; i++)</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 15 (around line 1092)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  			fout &amp;lt;&amp;lt; scientific &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.defK_p_gap(j) &amp;lt;&amp;lt; "\t0\t0" &amp;lt;&amp;lt; "\n" ;</span><span class="unchanged-line">  		}</span><span class="unchanged-line">  		fout &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 		fout &amp;lt;&amp;lt; "VECTORS Thermal_Deformation_[m] double" &amp;lt;&amp;lt; "\n";</span><span class="unchanged-line">  		for(int i = 0; i &amp;lt; Ncells ; i++)</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 16 (around line 1169)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		}</span><span class="unchanged-line">  		fout &amp;lt;&amp;lt; "\n";</span><span class="unchanged-line">  		//fout &amp;lt;&amp;lt; "POINT DATA" &amp;lt;&amp;lt; 2*M*(N+1) &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 		fout &amp;lt;&amp;lt; "SCALARS Energy_Dissipation_[W] double 1\n";</span><span class="removed-line">- 		fout &amp;lt;&amp;lt; "LOOKUP_TABLE default\n";</span><span class="removed-line">- 		for(int c = 0; c &amp;lt; 2 ; c++)</span><span class="removed-line">- 		{</span><span class="removed-line">- 			for(int i = 0; i &amp;lt; Ncells ; i++)</span><span class="removed-line">- 			{</span><span class="removed-line">- 				for(int j = 0; j &amp;lt; Mcells ; j++)</span><span class="removed-line">- 			    {</span><span class="removed-line">- 					fout &amp;lt;&amp;lt; scientific &amp;lt;&amp;lt; myGapResult.PhiD_mech_2d(j+Mcells*i) &amp;lt;&amp;lt; "\t";</span><span class="removed-line">- 			    }</span><span class="removed-line">- 				fout &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 			}</span><span class="removed-line">- 			for(int j = 0; j &amp;lt; Mcells ; j++)</span><span class="removed-line">- 			{</span><span class="removed-line">- 				fout &amp;lt;&amp;lt; scientific &amp;lt;&amp;lt; myGapResult.PhiD_mech_2d(j) &amp;lt;&amp;lt; "\t";</span><span class="removed-line">- 			}</span><span class="removed-line">- 			fout&amp;lt;&amp;lt;"\n";</span><span class="removed-line">- 		}</span><span class="removed-line">- 		fout &amp;lt;&amp;lt; "SCALARS Film_Thickness_[m] double 1\n";</span><span class="removed-line">- 		fout &amp;lt;&amp;lt; "LOOKUP_TABLE default\n";</span><span class="removed-line">- 		for(int c = 0; c &amp;lt; 2 ; c++)</span><span class="removed-line">- 		{</span><span class="removed-line">- 			for(int i = 0; i &amp;lt; Ncells ; i++)</span><span class="removed-line">- 			{</span><span class="removed-line">- 				for(int j = 0; j &amp;lt; Mcells ; j++)</span><span class="removed-line">- 			    {</span><span class="removed-line">- 					fout &amp;lt;&amp;lt; scientific &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.h(j+Mcells*i) &amp;lt;&amp;lt; "\t";</span><span class="removed-line">- 			    }</span><span class="removed-line">- 				fout &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 			}</span><span class="removed-line">- 			for(int j = 0; j &amp;lt; Mcells ; j++)</span><span class="removed-line">- 			{</span><span class="removed-line">- 				fout &amp;lt;&amp;lt; scientific &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.h(j) &amp;lt;&amp;lt; "\t";</span><span class="removed-line">- 			}</span><span class="removed-line">- 			fout&amp;lt;&amp;lt;"\n";</span><span class="removed-line">- 		}</span><span class="removed-line">- 		// 2d temperature field</span><span class="removed-line">- 		fout &amp;lt;&amp;lt; "SCALARS Film_Temperature_[C] double 1\n";</span><span class="removed-line">- 		fout &amp;lt;&amp;lt; "LOOKUP_TABLE default\n";</span><span class="removed-line">- 		for(int c = 0; c &amp;lt; 2 ; c++)</span><span class="removed-line">- 		{</span><span class="removed-line">- 			for(int i = 0; i &amp;lt; Ncells ; i++)</span><span class="removed-line">- 			{</span><span class="removed-line">- 				for(int j = 0; j &amp;lt; Mcells ; j++)</span><span class="removed-line">- 			    {</span><span class="removed-line">- 					fout &amp;lt;&amp;lt; scientific &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.T_2d(j+Mcells*i) &amp;lt;&amp;lt; "\t";</span><span class="removed-line">- 			    }</span><span class="removed-line">- 				fout &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 			}</span><span class="removed-line">- 			for(int j = 0; j &amp;lt; Mcells ; j++)</span><span class="removed-line">- 			{</span><span class="removed-line">- 				fout &amp;lt;&amp;lt; scientific &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.T_2d(j) &amp;lt;&amp;lt; "\t";</span><span class="removed-line">- 			}</span><span class="removed-line">- 			fout&amp;lt;&amp;lt;"\n";</span><span class="removed-line">- 		}</span><span class="removed-line">- 		// 2d phiD field</span><span class="removed-line">- 		fout &amp;lt;&amp;lt; "SCALARS Film_phiD double 1\n";</span><span class="removed-line">- 		fout &amp;lt;&amp;lt; "LOOKUP_TABLE default\n";</span><span class="removed-line">- 		for(int c = 0; c &amp;lt; 2 ; c++)</span><span class="removed-line">- 		{</span><span class="removed-line">- 			for(int i = 0; i &amp;lt; Ncells ; i++)</span><span class="removed-line">- 			{</span><span class="removed-line">- 				for(int j = 0; j &amp;lt; Mcells ; j++)</span><span class="removed-line">- 			    {</span><span class="removed-line">- 					fout &amp;lt;&amp;lt; scientific &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.phiD_2d(j+Mcells*i) &amp;lt;&amp;lt; "\t";</span><span class="removed-line">- 			    }</span><span class="removed-line">- 				fout &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 			}</span><span class="removed-line">- 			for(int j = 0; j &amp;lt; Mcells ; j++)</span><span class="removed-line">- 			{</span><span class="removed-line">- 				fout &amp;lt;&amp;lt; scientific &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.phiD_2d(j) &amp;lt;&amp;lt; "\t";</span><span class="removed-line">- 			}</span><span class="removed-line">- 			fout&amp;lt;&amp;lt;"\n";</span><span class="removed-line">- 		}</span><span class="unchanged-line">  		fout &amp;lt;&amp;lt; "SCALARS Gap_Pressure_[bar] double 1" &amp;lt;&amp;lt; "\n";</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 17 (around line 1253)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  			    {</span><span class="unchanged-line">  					if(j==0)</span><span class="unchanged-line">  					{</span><span class="removed-line">- 						fout &amp;lt;&amp;lt; scientific &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.ploop(j+i*Mcells)*1.0e-5 &amp;lt;&amp;lt; "\t" ;</span><span class="unchanged-line">  					}</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 18 (around line 1270)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  			{</span><span class="unchanged-line">  				if(j==0)</span><span class="unchanged-line">  				{</span><span class="removed-line">- 					fout &amp;lt;&amp;lt; scientific &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.ploop(j)*1.0e-5 &amp;lt;&amp;lt; "\t" ;</span><span class="unchanged-line">  				}</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 19 (around line 1309)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		for(int j = 0; j &amp;lt; Mcells ; j++)</span><span class="unchanged-line">          {</span><span class="unchanged-line">  			fout &amp;lt;&amp;lt; scientific &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.TK_surf_gap(j) &amp;lt;&amp;lt;  "\t" ;</span><span class="removed-line">-         }</span><span class="removed-line">- 		fout &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 		// heat flux on both surface</span><span class="removed-line">- 		fout &amp;lt;&amp;lt; "SCALARS Heat_flux_[W/m2] double 1" &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 		fout &amp;lt;&amp;lt; "LOOKUP_TABLE default" &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 		for(int i = 0; i &amp;lt; Ncells ; i++)</span><span class="removed-line">- 		{</span><span class="removed-line">- 			for(int j = 0; j &amp;lt; Mcells ; j++)</span><span class="removed-line">-             {</span><span class="removed-line">- 					fout &amp;lt;&amp;lt; scientific &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.QgapB(j+i*Mcells) &amp;lt;&amp;lt;  "\t" ;</span><span class="removed-line">-             }</span><span class="removed-line">- 			fout &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 		}</span><span class="removed-line">- 		for(int j = 0; j &amp;lt; Mcells ; j++)</span><span class="removed-line">-         {</span><span class="removed-line">- 			fout &amp;lt;&amp;lt; scientific &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.QgapB(j) &amp;lt;&amp;lt;  "\t" ;</span><span class="removed-line">-         }</span><span class="removed-line">- 		fout &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 		for(int i = 0; i &amp;lt; Ncells ; i++)</span><span class="removed-line">- 		{</span><span class="removed-line">- 			for(int j = 0; j &amp;lt; Mcells ; j++)</span><span class="removed-line">-             {</span><span class="removed-line">- 					fout &amp;lt;&amp;lt; scientific &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.QgapK(j+i*Mcells) &amp;lt;&amp;lt;  "\t" ;</span><span class="removed-line">-             }</span><span class="removed-line">- 			fout &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 		}</span><span class="removed-line">- 		for(int j = 0; j &amp;lt; Mcells ; j++)</span><span class="removed-line">-         {</span><span class="removed-line">- 			fout &amp;lt;&amp;lt; scientific &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.QgapK(j) &amp;lt;&amp;lt;  "\t" ;</span><span class="unchanged-line">          }</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><h5>‚ú® Added Code Sections:</h5><div class="function-container"><div class="function-header">‚úÖ Added Section 1 (around line 6)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  #include "../../caspar_input/input.h"</span><span class="unchanged-line">  #include &amp;lt;iostream&amp;gt;</span><span class="unchanged-line">  #include "CNewtonIteration.h"</span><span class="added-line">+ #include &amp;lt;boost_1_53_0\boost\math\special_functions\fpclassify.hpp&amp;gt;</span><span class="unchanged-line">  #pragma once</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 2 (around line 239)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	myNewtonIteration.dt = hmax;</span><span class="unchanged-line">  	</span><span class="unchanged-line">  	//Final value for x</span><span class="added-line">+ 	xend = abs(myinput.data.lubrication_module.n_lubrication_revolutions) / (myinput.data.operating_conditions.speed/(2*PI));</span><span class="unchanged-line">  	//Interval of x for printing output</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 3 (around line 257)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	Array&amp;lt;double,2&amp;gt; convergance;</span><span class="unchanged-line">  	convergance.resize(6,2);</span><span class="unchanged-line">  	convergance = 0.0;</span><span class="added-line">+ 	double vel,lim;</span><span class="unchanged-line">  	do</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 4 (around line 287)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		};</span><span class="unchanged-line">  		//assign new time</span><span class="unchanged-line">  		y[0] = x;</span><span class="added-line">+ </span><span class="unchanged-line">  		//Handle coupled caspar blocking events</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 5 (around line 296)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  			//Check for the end of a revolution</span><span class="unchanged-line">  			</span><span class="unchanged-line">  			//double deg = fmod(6.0*myGapInput.General.speed*x, 360.0);//should work if needed</span><span class="added-line">+ 			int rev = floor(myinput.data.operating_conditions.speed*x/(2*PI));//may need to add ~1/7200 to get </span><span class="unchanged-line">  			</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 6 (around line 417)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	x += hmax;</span><span class="unchanged-line">  </span><span class="unchanged-line">  }</span><span class="added-line">+ </span><span class="added-line">+ // converts the infinite values to the Nan values </span><span class="added-line">+ std::string checkNanInfinity(double value){</span><span class="added-line">+ 	using boost::math::isnan;</span><span class="added-line">+ 	using boost::math::isinf;</span><span class="added-line">+ 	if (isnan(value) || isinf(value)) {</span><span class="added-line">+         return "NaN";</span><span class="added-line">+     } else {</span><span class="added-line">+         std::stringstream ss;</span><span class="added-line">+         ss &amp;lt;&amp;lt; std::scientific &amp;lt;&amp;lt; value;</span><span class="added-line">+         return ss.str();</span><span class="added-line">+     }</span><span class="added-line">+ }</span><span class="unchanged-line">  //Solver output results</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 7 (around line 501)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  			PhiD_vol_tot += myNewtonIteration.myPistonGap.PhiD_vol;</span><span class="unchanged-line">  		}</span><span class="unchanged-line">  </span><span class="added-line">+ 		if(myinput.data.options_piston.general.inclined_piston){</span><span class="added-line">+ 			//Positions and velocities, .pos file</span><span class="added-line">+ 			fout.open("./output/piston/piston.txt",ios::app);</span><span class="added-line">+ 			fout &amp;lt;&amp;lt; scientific &amp;lt;&amp;lt; checkNanInfinity(myGapResult.time)												//1</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myinput.data.operating_conditions.speed * myGapResult.time / (2*PI))	//2</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myGapResult.phi)														//3</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myGapResult.gappositions[1])											//4</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myGapResult.gappositions[2])											//5</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myGapResult.gappositions[3])											//6</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myGapResult.gappositions[4])											//7</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myGapResult.gapvelocities[0])											//8</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myGapResult.gapvelocities[1])											//9</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myGapResult.gapvelocities[2])											//10</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myGapResult.gapvelocities[3])											//11</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.geometrypistongap.lvar)					//12</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.geometrypistongap.lout)					//13</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.geometrypistongap.pos_A)				//14</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.geometrypistongap.pos_B)				//15</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.geometrypistongap.zRK)					//16</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.geometrypistongap.sK)					//17</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.geometrypistongap.lA)					//18</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.geometrypistongap.lB)					//19</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.geometrypistongap.z_A)					//20</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.geometrypistongap.z_B)					//21</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.operatingpistongap.vK)					//22</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.operatingpistongap.QSK)					//23</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.operatingpistongap.QSK_p)				//24</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.operatingpistongap.QSK_c)				//25</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.forcespistongap.MTK)					//26</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.forcespistongap.MTKtan)					//27</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(sum(myNewtonIteration.myPistonGap.forcespistongap.FTKy))				//28</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(sum(myNewtonIteration.myPistonGap.forcespistongap.FTKy_p))			//29</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(sum(myNewtonIteration.myPistonGap.forcespistongap.FTKy_c))			//30</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(sum(myNewtonIteration.myPistonGap.forcespistongap.FTKx))			//31</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(sum(myNewtonIteration.myPistonGap.forcespistongap.FTKx_p))			//32</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(sum(myNewtonIteration.myPistonGap.forcespistongap.FTKx_c))			//33</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.forcespistongap.FTG)					//34</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myGapResult.pDC)														//35</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(sum(myNewtonIteration.myPistonGap.forcespistongap.FTby))			//36</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(sum(myNewtonIteration.myPistonGap.forcespistongap.FTby_p))			//37</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(sum(myNewtonIteration.myPistonGap.forcespistongap.FTby_c))			//38</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(sum(myNewtonIteration.myPistonGap.forcespistongap.FTbx))			//39</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(sum(myNewtonIteration.myPistonGap.forcespistongap.FTbx_p))			//40</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(sum(myNewtonIteration.myPistonGap.forcespistongap.FTbx_c))			//41</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myGapResult.pHP)														//42</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myGapResult.PLP)														//43</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.forcespistongap.F_external[0])			//44</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.forcespistongap.F_external[1])			//45</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.forcespistongap.F_external[2])			//46</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.forcespistongap.F_external[3])			//47</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.forcespistongap.F_fluid[0])				//48</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.forcespistongap.F_fluid[1])				//49</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.forcespistongap.F_fluid[2])				//50</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.forcespistongap.F_fluid[3])				//51</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.forcespistongap.F_contact[0])			//52</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.forcespistongap.F_contact[1])			//53</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.forcespistongap.F_contact[2])			//54</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.forcespistongap.F_contact[3])			//55</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.forcespistongap.dF[0])					//56</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.forcespistongap.dF[1])					//57</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.forcespistongap.dF[2])					//58</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.forcespistongap.dF[3])					//59</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(QSKTot)																//60</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(MSKTot)																//61</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(MFT)																	//62</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(PhiD_mech_tot)														//63</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(PhiD_vol_tot)															//64</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.PhiD_mech)								//65</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.PhiD_vol)		                        //66</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.forcespistongap.FSKx)                   //67</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.forcespistongap.FSKy)                   //68</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.forcespistongap.FAKz)                   //69</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.forcespistongap.FKx)                    //70</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.forcespistongap.FKy)                    //71</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.forcespistongap.FK)                     //72</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.forcespistongap.FaK)                    //73</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.forcespistongap.FDK)                    //74</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.forcespistongap.Fwk)                    //75</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.forcespistongap.FAKy)                   //76</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.forcespistongap.Fwky)                   //77</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.forcespistongap.Fwkz)                   //78</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.forcespistongap.FAK_inclined)           //79</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.forcespistongap.MKx)                    //80</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.forcespistongap.MKy)                    //81</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; checkNanInfinity(myNewtonIteration.myPistonGap.forcespistongap.MK)                     //82</span><span class="added-line">+ 				&amp;lt;&amp;lt; "\n";</span><span class="unchanged-line">  			fout.close();</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 8 (around line 722)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  				//Piston total heat flux, .QK file  [W/m2]</span><span class="unchanged-line">  				fout.open("./output/piston/matlab/Piston_Body_Heat_Flux.txt",ios::app);</span><span class="unchanged-line">  				fout &amp;lt;&amp;lt; "%Revolution Number: " &amp;lt;&amp;lt; revcounter &amp;lt;&amp;lt; "\n";</span><span class="added-line">+ 				for(int i=0;i&amp;lt;(int) myNewtonIteration.myPistonGap.qbi_piston[0].extent(0);i++)</span><span class="added-line">+ 				{</span><span class="added-line">+ 					fout &amp;lt;&amp;lt; scientific &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.qbi_piston[0](i) &amp;lt;&amp;lt; "\n";</span><span class="unchanged-line">  				}</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 9 (around line 733)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  				//Cylinder total heat flux, .QB file  [W/m2]</span><span class="unchanged-line">  				fout.open("./output/piston/matlab/Piston_Cylinder_Body_Heat_Flux.txt",ios::app);</span><span class="unchanged-line">  				fout &amp;lt;&amp;lt; "%Revolution Number: " &amp;lt;&amp;lt; revcounter &amp;lt;&amp;lt; "\n";</span><span class="added-line">+ 				for(int i=0;i&amp;lt;(int) myNewtonIteration.myPistonGap.qbi_cylinder[0].extent(0);i++)</span><span class="added-line">+ 				{</span><span class="added-line">+ 					fout &amp;lt;&amp;lt; scientific &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.qbi_cylinder[0](i) &amp;lt;&amp;lt; "\n";</span><span class="unchanged-line">  				}</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 10 (around line 872)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  				}</span><span class="unchanged-line">  				else</span><span class="unchanged-line">  				{</span><span class="added-line">+ 					fout &amp;lt;&amp;lt; scientific &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.ploop(j+i*M)*1.0e-5 &amp;lt;&amp;lt; "\t" ;</span><span class="unchanged-line">  				}</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 11 (around line 1077)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		//Output vtk (vectors are outside first, then inside).</span><span class="unchanged-line">  		</span><span class="unchanged-line">  		static int vtknum = ceil(360 / myinput.data.options_piston.numeric.Simalphaplot);//Number of VTK files to retain not to exceed one revolution to minimize file size.</span><span class="added-line">+ 		short Mcells, Ncells;</span><span class="unchanged-line">  		if(myinput.data.options_piston.general.ReynoldsMultiGrid){</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 12 (around line 1118)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		}</span><span class="unchanged-line">  		fout &amp;lt;&amp;lt; " " &amp;lt;&amp;lt; "\n";</span><span class="unchanged-line">  		fout &amp;lt;&amp;lt; "POINT_DATA " &amp;lt;&amp;lt; 2*Mcells*(Ncells+1)&amp;lt;&amp;lt;"\n";</span><span class="added-line">+ 		fout &amp;lt;&amp;lt; "VECTORS Gap_Height_[um] double"&amp;lt;&amp;lt;"\n";</span><span class="unchanged-line">  		for(int i=0;i&amp;lt;Ncells;i++)</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 13 (around line 1144)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  			fout &amp;lt;&amp;lt; scientific &amp;lt;&amp;lt; ( myNewtonIteration.myPistonGap.defB_gap(j) - myNewtonIteration.myPistonGap.McrB(j) - myNewtonIteration.myPistonGap.h(j) ) &amp;lt;&amp;lt; "\t0\t0" &amp;lt;&amp;lt; "\n";</span><span class="unchanged-line">  		}</span><span class="unchanged-line">  		fout &amp;lt;&amp;lt; "\n";</span><span class="added-line">+ 		fout &amp;lt;&amp;lt; "VECTORS Pressure_Deformation_[um] double" &amp;lt;&amp;lt; "\n";</span><span class="unchanged-line">  		for(int i = 0; i &amp;lt; Ncells ; i++)</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 14 (around line 1168)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  			fout &amp;lt;&amp;lt; scientific &amp;lt;&amp;lt; myNewtonIteration.myPistonGap.defK_p_gap(j) &amp;lt;&amp;lt; "\t0\t0" &amp;lt;&amp;lt; "\n" ;</span><span class="unchanged-line">  		}</span><span class="unchanged-line">  		fout &amp;lt;&amp;lt; "\n";</span><span class="added-line">+ 		fout &amp;lt;&amp;lt; "VECTORS Thermal_Deformation_[um] double" &amp;lt;&amp;lt; "\n";</span><span class="unchanged-line">  		for(int i = 0; i &amp;lt; Ncells ; i++)</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 15 (around line 1255)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  			    {</span><span class="unchanged-line">  					if(j==0)</span><span class="unchanged-line">  					{</span><span class="added-line">+ 						fout &amp;lt;&amp;lt; scientific &amp;lt;&amp;lt; pDC &amp;lt;&amp;lt; "\t" ;</span><span class="unchanged-line">  					}</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 16 (around line 1272)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  			{</span><span class="unchanged-line">  				if(j==0)</span><span class="unchanged-line">  				{</span><span class="added-line">+ 					fout &amp;lt;&amp;lt; scientific &amp;lt;&amp;lt; pDC &amp;lt;&amp;lt; "\t" ;</span><span class="unchanged-line">  				}</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div></div><div class="section"><h3 class="file-title">üìÑ CNewtonIteration.cpp</h3><p><strong>Status:</strong> üîµ 10 additions and 26 deletions (net reduction of 16 lines)</p><p><strong>Size:</strong> 30,770 ‚Üí 29,694 bytes (-1,076 bytes)</p><p><strong>Changes:</strong> +10 lines added, -26 lines removed</p><p><strong>Types of Changes:</strong> Functions, Comments, Control flow, Variable assignments</p><h4>üîß Code Changes (Separated by Type):</h4><h5>üóëÔ∏è Removed Code Sections:</h5><div class="function-container"><div class="function-header">‚ùå Removed Section 1 (around line 55)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	if(myPistonGap.HeatTransfer)</span><span class="unchanged-line">  	{</span><span class="unchanged-line">  		myPistonGap.PistonCylinderCalcBodyThermalFlux();</span><span class="removed-line">- 		myPistonGap.PistonCylinderConstructWeightedMatrix();</span><span class="unchanged-line">  	}</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 2 (around line 90)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  				}</span><span class="unchanged-line">  			}</span><span class="unchanged-line">  </span><span class="removed-line">- 			myPistonGap.PistonCylinderSolveBodyThermal_new();</span><span class="unchanged-line">  </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 3 (around line 151)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	gappositions_in[3] = cos(dphi) * temp[3] + sin(dphi) * temp[2];</span><span class="unchanged-line">  </span><span class="unchanged-line">  	myPistonGap.IMParallel(0,0,0);</span><span class="removed-line">- 	</span><span class="unchanged-line">  	//Solve main convergence loop</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 4 (around line 183)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		denom = 1.0/(2.0*delta_v);</span><span class="unchanged-line">  </span><span class="unchanged-line">  		//Forward velocity</span><span class="removed-line">- 		//if(gappositions[j] &amp;lt; 0.0)</span><span class="removed-line">- 			gapvelocities[j] += delta_v;      </span><span class="unchanged-line">  		</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 5 (around line 608)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  //Solve Newton Iterative Loop</span><span class="unchanged-line">  void CNewtonIteration::NewtonLoop(double epsilon,vector&amp;lt;double&amp;gt; &amp;gappositions,vector&amp;lt;double&amp;gt; &amp;gapvelocities)</span><span class="unchanged-line">  {</span><span class="removed-line">- 	</span><span class="unchanged-line">  	//Parameters definition</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 6 (around line 627)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  </span><span class="unchanged-line">  </span><span class="unchanged-line">  	//First call to PistonGap function with no convergence loop</span><span class="removed-line">- 	myPistonGap.PistonGapJacobian(gappositions,gapvelocities,dF,dt);</span><span class="unchanged-line">  	//Calculate dF</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 7 (around line 639)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	ks = 0;</span><span class="unchanged-line">  	cas = 0;</span><span class="unchanged-line">  	//----------External while loop----------//</span><span class="removed-line">- 	//fout.open("./output/piston/dF.txt",ios::app);</span><span class="unchanged-line">  	do</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 8 (around line 669)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  				tempgapvelocities[i] = gapvelocities[i] - omega * deltagapvelocities[i];</span><span class="unchanged-line">  			}</span><span class="unchanged-line">  			//Newton relaxed loop</span><span class="removed-line">- 			myPistonGap.PistonGapJacobian(gappositions,tempgapvelocities,dF,dt);</span><span class="removed-line">- 			//fout &amp;lt;&amp;lt; phi &amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; tempgapvelocities[0] &amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; tempgapvelocities[1] &amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; tempgapvelocities[2] &amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; tempgapvelocities[3] &amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; dF[0] &amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; dF[1] &amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; dF[2] &amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; dF[3] &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 		</span><span class="unchanged-line">  			//dF result vector</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 9 (around line 679)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  			//Internal counter</span><span class="unchanged-line">  			jj++;</span><span class="unchanged-line">  		}while(dFnormint &amp;gt; dFnorm &amp;&amp; jj &amp;lt; jmax);</span><span class="removed-line">- 		Log &amp;lt;&amp;lt; "j: " &amp;lt;&amp;lt; jj &amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; "dFnorm_j: " &amp;lt;&amp;lt; dFnormint &amp;lt;&amp;lt; "\t scale: 1.0\n";</span><span class="unchanged-line">  </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 10 (around line 727)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		//Check for value very close to tolerance</span><span class="unchanged-line">  		if( fabs(dFnorm-epsilon) &amp;lt; 3.0 )</span><span class="unchanged-line">  		{</span><span class="removed-line">- 			dFnorm = 0.0; </span><span class="unchanged-line">  		};</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><h5>‚ú® Added Code Sections:</h5><div class="function-container"><div class="function-header">‚úÖ Added Section 1 (around line 89)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  				}</span><span class="unchanged-line">  			}</span><span class="unchanged-line">  </span><span class="added-line">+ 			myPistonGap.PistonCylinderSolveBodyThermal();</span><span class="unchanged-line">  </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 2 (around line 150)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	gappositions_in[3] = cos(dphi) * temp[3] + sin(dphi) * temp[2];</span><span class="unchanged-line">  </span><span class="unchanged-line">  	myPistonGap.IMParallel(0,0,0);</span><span class="added-line">+ </span><span class="unchanged-line">  	//Solve main convergence loop</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 3 (around line 181)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		denom = 1.0/(2.0*delta_v);</span><span class="unchanged-line">  </span><span class="unchanged-line">  		//Forward velocity</span><span class="added-line">+ 		gapvelocities[j] += delta_v;      </span><span class="unchanged-line">  		</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 4 (around line 604)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  //Solve Newton Iterative Loop</span><span class="unchanged-line">  void CNewtonIteration::NewtonLoop(double epsilon,vector&amp;lt;double&amp;gt; &amp;gappositions,vector&amp;lt;double&amp;gt; &amp;gapvelocities)</span><span class="unchanged-line">  {</span><span class="added-line">+ </span><span class="unchanged-line">  	//Parameters definition</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 5 (around line 623)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  </span><span class="unchanged-line">  </span><span class="unchanged-line">  	//First call to PistonGap function with no convergence loop</span><span class="added-line">+ 	myPistonGap.PistonGapJacobian(gappositions,gapvelocities,dF);</span><span class="unchanged-line">  	//Calculate dF</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 6 (around line 654)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  				tempgapvelocities[i] = gapvelocities[i] - omega * deltagapvelocities[i];</span><span class="unchanged-line">  			}</span><span class="unchanged-line">  			//Newton relaxed loop</span><span class="added-line">+ 			myPistonGap.PistonGapJacobian(gappositions,tempgapvelocities,dF);</span><span class="unchanged-line">  			//dF result vector</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 7 (around line 662)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  			//Internal counter</span><span class="unchanged-line">  			jj++;</span><span class="unchanged-line">  		}while(dFnormint &amp;gt; dFnorm &amp;&amp; jj &amp;lt; jmax);</span><span class="added-line">+ 		Log &amp;lt;&amp;lt; "j: " &amp;lt;&amp;lt; jj &amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; "dFnorm_j: " &amp;lt;&amp;lt; dFnormint &amp;lt;&amp;lt; "\n";</span><span class="unchanged-line">  </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 8 (around line 710)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		//Check for value very close to tolerance</span><span class="unchanged-line">  		if( fabs(dFnorm-epsilon) &amp;lt; 3.0 )</span><span class="unchanged-line">  		{</span><span class="added-line">+ 			dFnorm = 0.0;</span><span class="unchanged-line">  		};</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div></div><div class="section"><h3 class="file-title">üìÑ CPistonGap.cpp</h3><p><strong>Status:</strong> üîµ 155 additions and 712 deletions (net reduction of 557 lines)</p><p><strong>Size:</strong> 114,472 ‚Üí 97,175 bytes (-17,297 bytes)</p><p><strong>Changes:</strong> +155 lines added, -712 lines removed</p><p><strong>Types of Changes:</strong> Functions, Comments, Control flow</p><h4>üîß Code Changes (Separated by Type):</h4><h5>üóëÔ∏è Removed Code Sections:</h5><div class="function-container"><div class="function-header">‚ùå Removed Section 1 (around line 15)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  extern class input myinput;</span><span class="unchanged-line">  extern bool force_balance_iterative;</span><span class="unchanged-line">  extern double mixed_friction;</span><span class="removed-line">- extern int hd_levels;</span><span class="removed-line">- extern int hd_revs;</span><span class="unchanged-line">  </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 2 (around line 185)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  			levels[l].x.resize(levels[l].N*levels[l].M);			levels[l].x=0.0;</span><span class="unchanged-line">  			levels[l].h.resize(levels[l].N*levels[l].M);			levels[l].h=0.0;</span><span class="unchanged-line">  			levels[l].mu.resize(levels[l].N*levels[l].M);			levels[l].mu=0.0;</span><span class="removed-line">- 			levels[l].rho.resize(levels[l].N*levels[l].M);			levels[l].rho=0.0;</span><span class="unchanged-line">  			levels[l].phi.resize(levels[l].N*levels[l].M);			levels[l].phi=0.0;	</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 3 (around line 232)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  </span><span class="unchanged-line">  </span><span class="unchanged-line">  	//If EHD Test Rig is simulated, no relative piston rotation is considered</span><span class="removed-line">- 	/*if(EHDTestRig)</span><span class="unchanged-line">  	{</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 4 (around line 245)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	//oilpistongap.oilbetaP = myinput.data.oil.oilbetaP;</span><span class="unchanged-line">  	//oilpistongap.oilbetaT = myinput.data.oil.oilbetaT;</span><span class="unchanged-line">  	//oilpistongap.oilPc1 = myinput.data.oil.oilPc1;</span><span class="removed-line">- 	//oilpistongap.oilPc2 = myinput.data.oil.oilPc2;</span><span class="unchanged-line">  	//oilpistongap.oilTc1 = myinput.data.oil.oilTc1;</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 5 (around line 264)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		Log &amp;lt;&amp;lt; "Using User Defined Oil Model" &amp;lt;&amp;lt; "\n";</span><span class="unchanged-line">  		my_oil=new user_defined_oil(myinput);</span><span class="unchanged-line">  	}</span><span class="removed-line">- 	else if(myinput.data.oil.general.oiltype == 2){</span><span class="unchanged-line">  		Log &amp;lt;&amp;lt; "Using HLP32 Oil Model" &amp;lt;&amp;lt; "\n";</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 6 (around line 287)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	else if(myinput.data.oil.general.oiltype == 7){</span><span class="unchanged-line">  		Log &amp;lt;&amp;lt; "Using Exxon DTE Excel 32 Oil Model" &amp;lt;&amp;lt; "\n";</span><span class="unchanged-line">  		my_oil=new ExxonDTE10Excel32(myinput);</span><span class="removed-line">- 	}</span><span class="removed-line">- 	</span><span class="unchanged-line">  	else if(myinput.data.oil.general.oiltype == 8){</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 7 (around line 342)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  </span><span class="unchanged-line">  </span><span class="unchanged-line">  	//Gap flow variables</span><span class="removed-line">- 	dht.resize(N*M);					dht=0;	</span><span class="removed-line">- 	dht_total.resize(N*M);					dht_total=0;	</span><span class="unchanged-line">  	sigma.resize(N*M);					sigma=0;</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 8 (around line 368)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	dAy.resize(N*M*Q);					dAy=0;	</span><span class="unchanged-line">  	oilviscosity.resize(N*M*Q);			oilviscosity=0;	</span><span class="unchanged-line">  	oilviscosity_old.resize(N*M*Q);		oilviscosity_old=0;</span><span class="removed-line">- 	mu_n.resize(M*N);					mu_n=0;</span><span class="removed-line">- 	mu_s.resize(M*N);					mu_s=0;</span><span class="removed-line">- 	mu_e.resize(M*N);					mu_e=0;</span><span class="removed-line">- 	mu_w.resize(M*N);					mu_w=0;</span><span class="unchanged-line">  	oildensity.resize(N*M*Q);			oildensity=0;	</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 9 (around line 388)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	pold.resize(N*M);				pold=0;</span><span class="unchanged-line">  	pfluid.resize(N*M);				pfluid=0;</span><span class="unchanged-line">  	ploop.resize(N*M);				ploop=0;</span><span class="removed-line">- 	ploop_old.resize(N*M);				ploop_old=0;</span><span class="unchanged-line">  	if(EHDTestRig)</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 10 (around line 502)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		//---------------------Calculate temperature piston---------------------//</span><span class="unchanged-line">  		if(HeatTransfer)</span><span class="unchanged-line">  		{</span><span class="removed-line">- 			vector&amp;lt;Array&amp;lt;double,1&amp;gt;&amp;gt; wtd_h_K;</span><span class="removed-line">- 			wtd_h_K.push_back(tbodyK_DC);</span><span class="removed-line">- 			wtd_h_K.push_back(tbodyK_case);</span><span class="removed-line">- 			vector&amp;lt;double&amp;gt; Tb;</span><span class="removed-line">- 			Tb.push_back(50);</span><span class="removed-line">- 			Tb.push_back(50);</span><span class="removed-line">- 			myThermal.ThermalSolve_Piston(qbi_piston,wtd_h_K,Tb,TK_body,TK_surf);</span><span class="removed-line">- 			//myThermal.ThermalSolve("piston",qbi_piston,TK_body,TK_surf);</span><span class="unchanged-line">  		};</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 11 (around line 536)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		//-------------------Calculate temperature cylinder------------------//</span><span class="unchanged-line">  		if(HeatTransfer)</span><span class="unchanged-line">  		{</span><span class="removed-line">- 			vector&amp;lt;Array&amp;lt;double,1&amp;gt;&amp;gt; wtd_h_B;</span><span class="removed-line">- 			wtd_h_B.push_back(tbodyB_DC);</span><span class="removed-line">- 			wtd_h_B.push_back(tbodyB_case);</span><span class="removed-line">- 			vector&amp;lt;double&amp;gt; Tb;</span><span class="removed-line">- 			Tb.push_back(50);</span><span class="removed-line">- 			Tb.push_back(50);</span><span class="removed-line">- 			myThermal.ThermalSolve_Cylinder(qbi_cylinder,wtd_h_B,Tb,TB_body,TB_surf);</span><span class="removed-line">- 			//myThermal.ThermalSolve("cylinder",qbi_cylinder,TB_body,TB_surf);</span><span class="unchanged-line">  		}</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 12 (around line 594)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		Log &amp;lt;&amp;lt; "done!" &amp;lt;&amp;lt; "\n";</span><span class="unchanged-line">  		Log &amp;lt;&amp;lt; " " &amp;lt;&amp;lt; "\n";</span><span class="unchanged-line">  	};</span><span class="removed-line">- </span><span class="unchanged-line">  	//Set displacement chamber pressure</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 13 (around line 603)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	PistonInitializeViscosity(1.0e8,120.0);</span><span class="unchanged-line">  	//Initialize density --- Lizhi 03/19/2015</span><span class="unchanged-line">  	PistonCalcDensity();</span><span class="removed-line">- 	oildensity_old = oildensity;</span><span class="removed-line">- 	density_expansion = 0;</span><span class="removed-line">- 	for(int i=0;i&amp;lt;Q;i++)</span><span class="removed-line">- 	{</span><span class="removed-line">- 		density_expansion(Range(0,N*M-1)) += oildensity(Range(i*N*M,(i+1)*N*M-1));</span><span class="removed-line">- 	};</span><span class="removed-line">- 	density_expansion /= Q;</span><span class="unchanged-line">  	//First revolution</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 14 (around line 622)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  </span><span class="unchanged-line">  }; </span><span class="unchanged-line">  //Solve piston gap</span><span class="removed-line">- void CPistonGap::PistonGap(vector&amp;lt;double&amp;gt; &amp;xp,vector&amp;lt;double&amp;gt; &amp;vp,double dt)</span><span class="unchanged-line">  {</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 15 (around line 646)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	}</span><span class="unchanged-line">  	//cout&amp;lt;&amp;lt;"Pistongroove()"&amp;lt;&amp;lt;"\n";</span><span class="unchanged-line">  	//FSI fixed-point iteration convergence loop</span><span class="removed-line">- 	levelrequest = 0;</span><span class="unchanged-line">  	do</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 16 (around line 697)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		//Calculate fluid viscosity</span><span class="unchanged-line">  		PistonCalcViscosity(1.0e8,120.0);</span><span class="unchanged-line">  		//Relax fluid viscosity</span><span class="removed-line">- 		//oilviscosity = oilviscosity_old + AlphaMu * (oilviscosity - oilviscosity_old);</span><span class="removed-line">- 		PistonCalcDensity();</span><span class="removed-line">- 		//oildensity = oildensity_old + AlphaMu * (oildensity - oildensity_old);</span><span class="unchanged-line">  		//Assign old pressure deformations</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 17 (around line 725)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		counter++;</span><span class="unchanged-line">  </span><span class="unchanged-line">  	}while(FLAG_P == 1 &amp;&amp; counter &amp;lt; nmax);</span><span class="removed-line">- </span><span class="removed-line">- 	if(hd_revs == -1){</span><span class="removed-line">- 		Log &amp;lt;&amp;lt; levelrequest &amp;lt;&amp;lt; " Grid Levels Requested.\n";</span><span class="removed-line">- 		if(levelrequest &amp;gt; hd_levels)</span><span class="removed-line">- 			Log &amp;lt;&amp;lt; "WARNING: Only " &amp;lt;&amp;lt; hd_levels &amp;lt;&amp;lt; " Levels Specified!\n";</span><span class="removed-line">- 	}</span><span class="unchanged-line">  	//Counter output</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 18 (around line 749)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  </span><span class="unchanged-line">  	//Assign pressure array to result</span><span class="unchanged-line">  	ploop = p;</span><span class="removed-line">- 	//Assign h to h_pre Lizhi</span><span class="removed-line">- 	h_pre = h;</span><span class="unchanged-line">  	//pgvold = pgvlizhi;</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 19 (around line 798)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  </span><span class="unchanged-line">  </span><span class="unchanged-line">  	//Calculate heat fluxes coming from the fluid film</span><span class="removed-line">- 	PistonCylinderCalcGapThermalFlux_new( );</span><span class="unchanged-line">  </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 20 (around line 973)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	double tempdouble = operatingpistongap.pDC*1.0e-5;</span><span class="unchanged-line">  	Log &amp;lt;&amp;lt; "pDC: " &amp;lt;&amp;lt; tempdouble &amp;lt;&amp;lt; " [bar]" &amp;lt;&amp;lt; "\n";</span><span class="unchanged-line">  </span><span class="removed-line">- 	//Calculate the piston stroke</span><span class="removed-line">- 	PistonCalcsK();</span><span class="removed-line">- </span><span class="removed-line">- 	//Calculate the piston velocity</span><span class="removed-line">- 	PistonCalcvK();</span><span class="removed-line">- </span><span class="removed-line">- 	geometrypistongap.z_A_old = geometrypistongap.z_A;</span><span class="removed-line">- 	geometrypistongap.z_B_old = geometrypistongap.z_B;</span><span class="removed-line">- </span><span class="unchanged-line">  	//Calculate the variable gap length</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 21 (around line 1034)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  //Initialize fluid fields: pressure, temperature and viscosity</span><span class="unchanged-line">  void CPistonGap::PistonInitializePressure(void)</span><span class="unchanged-line">  {</span><span class="removed-line">- 	</span><span class="removed-line">- 	//Numerical field with pressure gradient</span><span class="removed-line">- 	double dp_1;</span><span class="removed-line">- 	dp_1 = (operatingpistongap.pCase - operatingpistongap.pDC)/M;</span><span class="removed-line">- 	p(Range(0,M-1)) = operatingpistongap.pDC + tensor::i*dp_1;</span><span class="removed-line">- 	for(int i=0;i&amp;lt;N;i++)</span><span class="removed-line">- 	{</span><span class="removed-line">- 		p(Range(i*M,(i+1)*M-1)) = p(Range(0,M-1));</span><span class="unchanged-line">  	};</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 22 (around line 1085)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	TCase = temperaturepistongap.TCase;</span><span class="unchanged-line">  	Tmax = temperaturepistongap.Tmax;</span><span class="unchanged-line">    </span><span class="removed-line">- 	</span><span class="unchanged-line">  	//Numerical field with temperature gradient</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 23 (around line 1103)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	b = Tmax - dt_2*st;</span><span class="unchanged-line">  	//Temperature</span><span class="unchanged-line">  	T(Range(0,st)) = TDC + tensor::i*dt_1;</span><span class="removed-line">- 	T(Range(st+1,M-1)) = b + (tensor::i+(st+1))*dt_2;*/</span><span class="removed-line">- </span><span class="removed-line">- </span><span class="removed-line">- </span><span class="removed-line">- </span><span class="unchanged-line">  	for(int i=0;i&amp;lt;N*Q;i++)</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 24 (around line 1247)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  </span><span class="unchanged-line">  	//Old value</span><span class="unchanged-line">  	oilviscosity_old = oilviscosity;</span><span class="removed-line">- 	oildensity_old = oildensity;</span><span class="removed-line">- </span><span class="removed-line">- 	for(int i=0;i&amp;lt;N*M;i++)</span><span class="removed-line">- 	{</span><span class="removed-line">- 		//North</span><span class="removed-line">- 		if(i%M==(M-1))</span><span class="removed-line">- 		{</span><span class="removed-line">- 			mu_n(i) = my_oil -&amp;gt; get_mu(p(i),T_2d(i));</span><span class="removed-line">- 		}</span><span class="removed-line">- 		else</span><span class="removed-line">- 		{</span><span class="removed-line">- 			mu_n(i) = my_oil -&amp;gt; get_mu(0.5*(p(i)+p(i+1)),0.5*(T_2d(i)+T_2d(i+1)));</span><span class="removed-line">- 		}</span><span class="removed-line">- 		//South</span><span class="removed-line">- 		if(i%M==0)</span><span class="removed-line">- 		{</span><span class="removed-line">- 			mu_s(i) = my_oil -&amp;gt; get_mu(p(i),T_2d(i));</span><span class="removed-line">- 		}</span><span class="removed-line">- 		else</span><span class="removed-line">- 		{</span><span class="removed-line">- 			mu_s(i) = my_oil -&amp;gt; get_mu(0.5*(p(i)+p(i-1)),0.5*(T_2d(i)+T_2d(i-1)));</span><span class="removed-line">- 		}</span><span class="removed-line">- 		//East</span><span class="removed-line">- 		if(i&amp;gt;=(N-1)*M)</span><span class="removed-line">- 		{</span><span class="removed-line">- 			mu_e(i) = my_oil -&amp;gt; get_mu(0.5*(p(i)+p(i-(N-1)*M)),0.5*(T_2d(i)+T_2d(i-(N-1)*M)));</span><span class="removed-line">- 		}</span><span class="removed-line">- 		else</span><span class="removed-line">- 		{</span><span class="removed-line">- 			mu_e(i) = my_oil -&amp;gt; get_mu(0.5*(p(i)+p(i+M)),0.5*(T_2d(i)+T_2d(i+M)));</span><span class="removed-line">- 		}</span><span class="removed-line">- 		//West</span><span class="removed-line">- 		if(i&amp;lt;M)</span><span class="removed-line">- 		{</span><span class="removed-line">- 			mu_w(i) = my_oil -&amp;gt; get_mu(0.5*(p(i)+p(i+(N-1)*M)),0.5*(T_2d(i)+T_2d(i+(N-1)*M)));</span><span class="removed-line">- 		}</span><span class="removed-line">- 		else</span><span class="removed-line">- 		{</span><span class="removed-line">- 			mu_w(i) = my_oil -&amp;gt; get_mu(0.5*(p(i)+p(i-M)),0.5*(T_2d(i)+T_2d(i-M)));</span><span class="removed-line">- 		}</span><span class="removed-line">- 	}</span><span class="unchanged-line">  };</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 25 (around line 1353)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	defB_p_gap = myGapUtils.InterpolateFields(NodeIdB_s2f_p,NodeDistB_s2f_p,defB_p);</span><span class="unchanged-line">  </span><span class="unchanged-line">  	//Smooth interpolated fields</span><span class="removed-line">- 	PistonCylinderSmoothField(defK_p_gap,2);</span><span class="removed-line">- 	PistonCylinderSmoothField(defB_p_gap,2);</span><span class="removed-line">- </span><span class="removed-line">- 	//Straighten interpolated fields</span><span class="removed-line">- 	//PistonCylinderStraightenField(defK_p_gap);</span><span class="removed-line">- 	//PistonCylinderStraightenField(defB_p_gap);</span><span class="unchanged-line">  </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 26 (around line 1479)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  </span><span class="unchanged-line">  </span><span class="unchanged-line">  };</span><span class="removed-line">- void CPistonGap::PistonCylinderStraightenField(Array&amp;lt;double,1&amp;gt; &amp;field)</span><span class="removed-line">- {</span><span class="removed-line">- 	Array&amp;lt;double,1&amp;gt; x_field;</span><span class="removed-line">- 	Array&amp;lt;double,1&amp;gt; y_field;</span><span class="removed-line">- 	x_field.resize(N*M);	x_field = 0;</span><span class="removed-line">- 	y_field.resize(N*M);	y_field = 0;</span><span class="removed-line">- 	double x_offset;	x_offset = 0;</span><span class="removed-line">- 	double y_offset;	y_offset = 0;</span><span class="removed-line">- 	// calculate the x and y of the field</span><span class="removed-line">- 	for(int n=0;n&amp;lt;N;n++)</span><span class="removed-line">- 	{</span><span class="removed-line">- 		for(int m=0;m&amp;lt;M;m++)</span><span class="removed-line">- 		{</span><span class="removed-line">- 			int i_2d = M*n + m;</span><span class="removed-line">- 			x_field(i_2d) = field(i_2d) * cos(m/M * 2 * PI);</span><span class="removed-line">- 			y_field(i_2d) = field(i_2d) * sin(m/M * 2 * PI);</span><span class="removed-line">- 			x_offset += x_field(i_2d);</span><span class="removed-line">- 			y_offset += y_field(i_2d);</span><span class="removed-line">- 		}</span><span class="removed-line">- 	}</span><span class="removed-line">- 	x_offset /= M*N;</span><span class="removed-line">- 	y_offset /= M*N;</span><span class="removed-line">- 	// calculate tilt angle on the field</span><span class="removed-line">- 	double x_tilt;	x_tilt = 0;</span><span class="removed-line">- 	double y_tilt;	y_tilt = 0;</span><span class="removed-line">- 	for(int m=0;m&amp;lt;M;m++)</span><span class="removed-line">- 	{</span><span class="removed-line">- 		x_tilt += x_field(M*N-M + m) - x_field(m);</span><span class="removed-line">- 		y_tilt += y_field(M*N-M + m) - y_field(m);</span><span class="removed-line">- 	}</span><span class="removed-line">- 	x_tilt /= M*N-M;</span><span class="removed-line">- 	y_tilt /= M*N-M;</span><span class="removed-line">- 	// straighten the field</span><span class="removed-line">- 	for(int n=0;n&amp;lt;N;n++)</span><span class="removed-line">- 	{</span><span class="removed-line">- 		for(int m=0;m&amp;lt;M;m++)</span><span class="removed-line">- 		{</span><span class="removed-line">- 			int i_2d = M*n + m;</span><span class="removed-line">- 			double x_straighten = -1.0 * ( x_offset + x_tilt * n );</span><span class="removed-line">- 			double y_straighten = -1.0 * ( y_offset + y_tilt * n );</span><span class="removed-line">- 			field(i_2d) += x_straighten * cos(m/M * 2 * PI) + y_straighten * sin(m/M * 2 * PI);</span><span class="removed-line">- 		}</span><span class="removed-line">- 	}</span><span class="removed-line">- </span><span class="removed-line">- }</span><span class="unchanged-line">  //Calculate piston velocity</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 27 (around line 1561)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	geometrypistongap.sK = sK_beta + sK_gamma - rB * ( tan(betamax) - tan(beta) )+delta_psi;</span><span class="unchanged-line">  	//geometrypistongap.sK = sK1 - rB * ( tan(betamax) - tan(beta) );</span><span class="unchanged-line">  </span><span class="removed-line">- }</span><span class="unchanged-line">  //Calculate variable gap length</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 28 (around line 1585)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	double T;					//Translation of piston due to J and K offsets.</span><span class="unchanged-line">  	double K = myinput.data.geometry.offset_K;</span><span class="unchanged-line">  	double J = myinput.data.geometry.offset_J;</span><span class="removed-line">- 	double lch = myinput.data.geometry.lch;</span><span class="unchanged-line">  </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 29 (around line 1606)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  </span><span class="unchanged-line">  </span><span class="unchanged-line">  	//Position of the back flat piston edge from beginning of bushing [m]</span><span class="removed-line">- 	temp_B = sK + delta_B - (lK - lKG - lch);</span><span class="unchanged-line">  	pos_B = - temp_B - le;</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 30 (around line 1672)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	geometrypistongap.z_B = ( lF - geometrypistongap.lB - geometrypistongap.lvar ) + le + geometrypistongap.delta_0 ;</span><span class="unchanged-line">  </span><span class="unchanged-line">  </span><span class="removed-line">- 	//Remove extra decimals - No idea why this ever happened.</span><span class="removed-line">- 	/*geometrypistongap.lA = floor(geometrypistongap.lA*1.0e6) / 1.0e6 ;</span><span class="unchanged-line">  	geometrypistongap.lB = floor(geometrypistongap.lB*1.0e6) / 1.0e6 ;</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 31 (around line 1759)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  </span><span class="unchanged-line">  </span><span class="unchanged-line">  	}*/</span><span class="removed-line">- </span><span class="removed-line">- 	double myp;</span><span class="removed-line">- </span><span class="unchanged-line">  	for(int b=0;b&amp;lt; Q ;b++){</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 32 (around line 1932)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  			oilviscosity(b*M*N+a) = my_oil -&amp;gt; get_mu(myp,T(b*M*N+a));</span><span class="unchanged-line">  		}</span><span class="unchanged-line">  	}</span><span class="removed-line">- </span><span class="removed-line">- 	for(int i=0;i&amp;lt;N*M;i++)</span><span class="removed-line">- 	{</span><span class="removed-line">- 		//North</span><span class="removed-line">- 		if(i%M==(M-1))</span><span class="removed-line">- 		{</span><span class="removed-line">- 			mu_n(i) = my_oil -&amp;gt; get_mu(p(i),T_2d(i));</span><span class="removed-line">- 		}</span><span class="removed-line">- 		else</span><span class="removed-line">- 		{</span><span class="removed-line">- 			mu_n(i) = my_oil -&amp;gt; get_mu(0.5*(p(i)+p(i+1)),0.5*(T_2d(i)+T_2d(i+1)));</span><span class="removed-line">- 		}</span><span class="removed-line">- 		//South</span><span class="removed-line">- 		if(i%M==0)</span><span class="removed-line">- 		{</span><span class="removed-line">- 			mu_s(i) = my_oil -&amp;gt; get_mu(p(i),T_2d(i));</span><span class="removed-line">- 		}</span><span class="removed-line">- 		else</span><span class="removed-line">- 		{</span><span class="removed-line">- 			mu_s(i) = my_oil -&amp;gt; get_mu(0.5*(p(i)+p(i-1)),0.5*(T_2d(i)+T_2d(i-1)));</span><span class="removed-line">- 		}</span><span class="removed-line">- 		//East</span><span class="removed-line">- 		if(i&amp;gt;=(N-1)*M)</span><span class="removed-line">- 		{</span><span class="removed-line">- 			mu_e(i) = my_oil -&amp;gt; get_mu(0.5*(p(i)+p(i-(N-1)*M)),0.5*(T_2d(i)+T_2d(i-(N-1)*M)));</span><span class="removed-line">- 		}</span><span class="removed-line">- 		else</span><span class="removed-line">- 		{</span><span class="removed-line">- 			mu_e(i) = my_oil -&amp;gt; get_mu(0.5*(p(i)+p(i+M)),0.5*(T_2d(i)+T_2d(i+M)));</span><span class="removed-line">- 		}</span><span class="removed-line">- 		//West</span><span class="removed-line">- 		if(i&amp;lt;M)</span><span class="removed-line">- 		{</span><span class="removed-line">- 			mu_w(i) = my_oil -&amp;gt; get_mu(0.5*(p(i)+p(i+(N-1)*M)),0.5*(T_2d(i)+T_2d(i+(N-1)*M)));</span><span class="removed-line">- 		}</span><span class="removed-line">- 		else</span><span class="removed-line">- 		{</span><span class="removed-line">- 			mu_w(i) = my_oil -&amp;gt; get_mu(0.5*(p(i)+p(i-M)),0.5*(T_2d(i)+T_2d(i-M)));</span><span class="removed-line">- 		}</span><span class="removed-line">- 	}</span><span class="removed-line">- </span><span class="removed-line">- </span><span class="unchanged-line">  };</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 33 (around line 2092)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	hK = sqrt( pow((rZ * cos(phi) - xm),2.0) + pow((rZ * sin(phi) - ym),2.0) ) - rK;</span><span class="unchanged-line">  </span><span class="unchanged-line">  };</span><span class="removed-line">- // shift h_pre for the current lavr</span><span class="removed-line">- void CPistonGap::PistonCalch_pre(void)</span><span class="removed-line">- {</span><span class="removed-line">- 	double dx_old = (geometrypistongap.z_A_old - geometrypistongap.z_B_old) / M;</span><span class="removed-line">- 	double A_shift = -1.0 * (geometrypistongap.z_A - geometrypistongap.z_A_old); //CAUTION positivez_A pointing from Case to DC, positive A_shift pointing from DC to case</span><span class="removed-line">- 	double B_shift = -1.0 * (geometrypistongap.z_B - geometrypistongap.z_B_old);</span><span class="removed-line">- 	Array&amp;lt;double,1&amp;gt; h_shift;</span><span class="removed-line">- 	Array&amp;lt;double,1&amp;gt; p_shift;</span><span class="removed-line">- 	Array&amp;lt;double,1&amp;gt; T_shift;</span><span class="removed-line">- 	h_shift.resize(M*N); h_shift = 0;</span><span class="removed-line">- 	p_shift.resize(M*N); p_shift = 0;</span><span class="removed-line">- 	T_shift.resize(M*N*Q); T_shift = 0;</span><span class="removed-line">- 	double phi,TDC,TCase;</span><span class="removed-line">- 	phi = operatingpistongap.phi_rad * 180.0/PI;</span><span class="removed-line">- 	if(phi &amp;lt; 180.0)</span><span class="removed-line">- 	{</span><span class="removed-line">- 		TDC = temperaturepistongap.THP;</span><span class="removed-line">- 	}</span><span class="removed-line">- 	else</span><span class="removed-line">- 	{</span><span class="removed-line">- 		TDC = temperaturepistongap.TLP;</span><span class="removed-line">- 	}</span><span class="removed-line">- 	TCase = temperaturepistongap.TCase;</span><span class="removed-line">- </span><span class="removed-line">- 	for(int m=0;m&amp;lt;M;m++)</span><span class="removed-line">- 	{</span><span class="removed-line">- 		for(int n=0;n&amp;lt;N;n++)</span><span class="removed-line">- 		{</span><span class="removed-line">- 			int i_2d = M*n + m;</span><span class="removed-line">- 			double x_shift = (m + 0.5) / M * (B_shift - A_shift) + A_shift;</span><span class="removed-line">- 			double dhdx_old;</span><span class="removed-line">- 			double dpdx_old;</span><span class="removed-line">- 			if(m==0)</span><span class="removed-line">- 			{</span><span class="removed-line">- 				dhdx_old = (h_pre(i_2d + 1) - h_pre(i_2d)) / dx_old;</span><span class="removed-line">- 				dpdx_old = (ploop_old(i_2d + 1) - operatingpistongap.pDC) / dx_old / 2;</span><span class="removed-line">- 			}</span><span class="removed-line">- 			else if(m==M-1)</span><span class="removed-line">- 			{</span><span class="removed-line">- 				dhdx_old = (h_pre(i_2d) - h_pre(i_2d - 1)) / dx_old;</span><span class="removed-line">- 				dpdx_old = (operatingpistongap.pCase - ploop_old(i_2d - 1)) / dx_old / 2;</span><span class="removed-line">- 			}</span><span class="removed-line">- 			else</span><span class="removed-line">- 			{</span><span class="removed-line">- 				dhdx_old = (h_pre(i_2d + 1) - h_pre(i_2d - 1)) / dx_old / 2;</span><span class="removed-line">- 				dpdx_old = (ploop_old(i_2d + 1) - ploop_old(i_2d - 1)) / dx_old / 2;</span><span class="removed-line">- 			}</span><span class="removed-line">- 			h_shift(i_2d) = dhdx_old * x_shift;</span><span class="removed-line">- 			p_shift(i_2d) = dpdx_old * x_shift;</span><span class="removed-line">- 			for(int q=0;q&amp;lt;Q;q++)</span><span class="removed-line">- 			{</span><span class="removed-line">- 				int i_3d = M*N*q + M*n + m;</span><span class="removed-line">- 				double dTdx_old;</span><span class="removed-line">- 				if(m==0)</span><span class="removed-line">- 				{</span><span class="removed-line">- 					dTdx_old = (T_old(i_2d + 1) - TDC) / dx_old / 2;</span><span class="removed-line">- 				}</span><span class="removed-line">- 				else if(m==M-1)</span><span class="removed-line">- 				{</span><span class="removed-line">- 					dTdx_old = (TCase - T_old(i_2d - 1)) / dx_old / 2;</span><span class="removed-line">- 				}</span><span class="removed-line">- 				else</span><span class="removed-line">- 				{</span><span class="removed-line">- 					dTdx_old = (T_old(i_2d + 1) - T_old(i_2d - 1)) / dx_old / 2;</span><span class="removed-line">- 				}</span><span class="removed-line">- 				T_shift(i_3d) = dTdx_old * x_shift;</span><span class="removed-line">- 			}</span><span class="removed-line">- 		}</span><span class="removed-line">- 	}</span><span class="removed-line">- 	h_pre += h_shift;</span><span class="removed-line">- 	h_pre = max(geometrypistongap.hmin, h_pre);</span><span class="removed-line">- 	ploop_old += p_shift;</span><span class="removed-line">- 	T_old += T_shift;</span><span class="removed-line">- }</span><span class="removed-line">- // calculate gap height in FSI loop using current piston position</span><span class="removed-line">- void CPistonGap::PistonCalch_FSI(vector&amp;lt;double&amp;gt; &amp;xp,vector&amp;lt;double&amp;gt; &amp;vp)</span><span class="removed-line">- {</span><span class="removed-line">- 	vector&amp;lt;double&amp;gt; myxp; myxp.resize(4);</span><span class="removed-line">- 	myxp = xp;</span><span class="removed-line">- </span><span class="removed-line">- 	//Calculate rigid film thickness</span><span class="removed-line">- 	PistonCalcRigidh(myxp);</span><span class="removed-line">- </span><span class="removed-line">- 	//Calculate piston surface total gap deformation</span><span class="removed-line">- 	defK_gap = defK_p_gap + defK_th_gap;</span><span class="removed-line">- </span><span class="removed-line">- 	//Calculate cylinder surface total gap deformation</span><span class="removed-line">- 	defB_gap = defB_p_gap + defB_th_gap;</span><span class="removed-line">- </span><span class="removed-line">- 	//Calculate piston macro-geometry</span><span class="removed-line">- 	PistonCalcMcrK( );</span><span class="removed-line">- </span><span class="removed-line">- 	//Calculate cylinder macro-geometry</span><span class="removed-line">- 	PistonCalcMcrB( );</span><span class="removed-line">- </span><span class="removed-line">- 	//Relative deformed &amp; macro-geometric film thickness (sliding surface)</span><span class="removed-line">- 	hK += - defK_th_gap - McrK;</span><span class="removed-line">- </span><span class="removed-line">- 	//Total deformed &amp; macro-geometric film thickness</span><span class="removed-line">- 	h = hK + defB_gap - defK_p_gap - McrB;</span><span class="removed-line">- 	</span><span class="removed-line">- 	//Uncut gap</span><span class="removed-line">- 	h1 = 0.0;</span><span class="removed-line">- 	h1 = h;</span><span class="removed-line">- 	</span><span class="removed-line">- 	//Add step profile on gap height - Lizhi</span><span class="removed-line">- 	if(myinput.data.options_piston.numeric.stploc &amp;gt; 0)</span><span class="removed-line">- 	{</span><span class="removed-line">- 		h += stepfield;</span><span class="removed-line">- 	}</span><span class="removed-line">- </span><span class="removed-line">- 	//Minimum gap</span><span class="removed-line">- 	double hmin = geometrypistongap.hmin;	</span><span class="removed-line">- 	h = where(h&amp;lt;hmin, hmin, h);</span><span class="removed-line">- 	//hK = where(hK&amp;lt;hmin, hmin, hK);</span><span class="removed-line">- </span><span class="removed-line">- };</span><span class="unchanged-line">  //Calculate total film thickness considering macrogeometry and/or deformations</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 34 (around line 2238)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	PistonCalcMcrB( );</span><span class="unchanged-line">  </span><span class="unchanged-line">  	//Relative deformed &amp; macro-geometric film thickness (sliding surface)</span><span class="removed-line">- 	hK += - defK_th_gap - McrK;</span><span class="unchanged-line">  </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 35 (around line 2256)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	//Minimum gap</span><span class="unchanged-line">  	double hmin = geometrypistongap.hmin;	</span><span class="unchanged-line">  	h = where(h&amp;lt;hmin, hmin, h);</span><span class="removed-line">- 	//hK = where(hK&amp;lt;hmin, hmin, hK);</span><span class="unchanged-line">  </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 36 (around line 2280)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	};</span><span class="unchanged-line">  	muT /= (1.0*Q) ;</span><span class="unchanged-line">  	//Under-relax viscosity to avoid force oscillation</span><span class="removed-line">- 	//muT = muT_old + 0.1 * (muT - muT_old) ;</span><span class="removed-line">- 	muT = muT_old + 1.0 * (muT - muT_old) ;</span><span class="unchanged-line">  </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 37 (around line 2609)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  </span><span class="unchanged-line">  };</span><span class="unchanged-line">  //Calculate squeeze motion from control points</span><span class="removed-line">- void CPistonGap::PistonCalcdht(vector&amp;lt;double&amp;gt; xp,vector&amp;lt;double&amp;gt; &amp;vp)</span><span class="removed-line">- {</span><span class="removed-line">- 	double dvxm,dvym,vp0,vp1,vp2,vp3,lvar,lB,lF,vK,dxdz,dydz;</span><span class="unchanged-line">  	lvar = geometrypistongap.lvar;</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 38 (around line 2656)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	dht = vxm * cos(phi) + vym * sin(phi);</span><span class="unchanged-line">  </span><span class="unchanged-line">  };</span><span class="removed-line">- //Calculate gap axial and circumferential fluid velocity at fluid grid boundary</span><span class="removed-line">- void CPistonGap::PistonCalcVedge(void)</span><span class="removed-line">- {</span><span class="removed-line">- 	double vK,speedK,omega,pDC,pCase,hmin;</span><span class="removed-line">- 	Range all = Range::all( );</span><span class="removed-line">- </span><span class="removed-line">- </span><span class="removed-line">- 	//Variables</span><span class="removed-line">- 	vK = operatingpistongap.vK;				</span><span class="removed-line">- 	omega = operatingpistongap.omega;		</span><span class="removed-line">- 	speedK = operatingpistongap.speedK;</span><span class="removed-line">- 	pDC = operatingpistongap.pDC;</span><span class="removed-line">- 	pCase = operatingpistongap.pCase;</span><span class="removed-line">- 	hmin = geometrypistongap.hmin;</span><span class="removed-line">- </span><span class="removed-line">- 	vx_edge = 0;</span><span class="removed-line">- 	vy_edge = 0;</span><span class="removed-line">- 	vy_edge_case = 0;</span><span class="removed-line">- </span><span class="removed-line">- 	for(int q=0;q&amp;lt;Q;q++)</span><span class="removed-line">- 	{</span><span class="removed-line">- 		for(int n=0;n&amp;lt;N;n++)</span><span class="removed-line">- 		{</span><span class="removed-line">- 			for(int m=0;m&amp;lt;M;m++)</span><span class="removed-line">- 			{</span><span class="removed-line">- 				double dpy_edge = 0;</span><span class="removed-line">- 				double dpx_edge = 0;</span><span class="removed-line">- 				double mux_edge = 0;</span><span class="removed-line">- 				double hx_edge = 0;</span><span class="removed-line">- 				double muy_edge = 0;</span><span class="removed-line">- 				double hy_edge = 0;</span><span class="removed-line">- 				int i_3d = M*N*q + M*n + m;</span><span class="removed-line">- 				int i_2d = M*n + m;</span><span class="removed-line">- 				if(m==0)</span><span class="removed-line">- 				{</span><span class="removed-line">- 					dpy_edge = ( pnew(i_2d) - pDC ) / dy * 2;</span><span class="removed-line">- 					//muy_edge = muT(i_2d);</span><span class="removed-line">- 					muy_edge = mu_s(i_2d);</span><span class="removed-line">- 					hy_edge = hT(i_2d);</span><span class="removed-line">- 				}</span><span class="removed-line">- 				else</span><span class="removed-line">- 				{</span><span class="removed-line">- 					dpy_edge = ( pnew(i_2d) - pnew(i_2d - 1) ) / dy;</span><span class="removed-line">- 					//muy_edge = (muT(i_2d) + muT(i_2d - 1)) / 2;</span><span class="removed-line">- 					muy_edge = mu_s(i_2d);</span><span class="removed-line">- 					hy_edge = (hT(i_2d) + hT(i_2d - 1)) / 2;</span><span class="removed-line">- 				}</span><span class="removed-line">- 				if(n==0)</span><span class="removed-line">- 				{</span><span class="removed-line">- 					dpx_edge = ( pnew(i_2d) - pnew(i_2d + (N-1)*M) ) / dx;</span><span class="removed-line">- 					//mux_edge = (muT(i_2d) + muT(i_2d + (N-1)*M) ) / 2;</span><span class="removed-line">- 					mux_edge = mu_w(i_2d);</span><span class="removed-line">- 					hx_edge = (hT(i_2d) + hT(i_2d + (N-1)*M) ) / 2;</span><span class="removed-line">- 				}</span><span class="removed-line">- 				else</span><span class="removed-line">- 				{</span><span class="removed-line">- 					dpx_edge = ( pnew(i_2d) - pnew(i_2d - M) ) / dx;</span><span class="removed-line">- 					//mux_edge = (muT(i_2d) + muT(i_2d - M)) / 2;</span><span class="removed-line">- 					mux_edge = mu_w(i_2d);</span><span class="removed-line">- 					hx_edge = (hT(i_2d) + hT(i_2d - M)) / 2;</span><span class="removed-line">- 				}</span><span class="removed-line">- 				vx_edge(i_3d) = 0.5 / mux_edge * dpx_edge * ( pow(hx_edge/Q*(q+0.5), 2) - hx_edge/Q*(q+0.5) * hx_edge);</span><span class="removed-line">- 				vx_edge(i_3d) += omega * rK * speedK * (q+0.5) / Q;</span><span class="removed-line">- 				vy_edge(i_3d) = 0.5 / muy_edge * dpy_edge * ( pow(hy_edge/Q*(q+0.5), 2) - hy_edge/Q*(q+0.5) * hy_edge);</span><span class="removed-line">- 				vy_edge(i_3d) += vK * (q+0.5) / Q;</span><span class="removed-line">- 				//for the case end</span><span class="removed-line">- 				if(m==M-1)</span><span class="removed-line">- 				{</span><span class="removed-line">- 					dpy_edge = ( pCase - pnew(i_2d) ) / dy * 2;</span><span class="removed-line">- 					//muy_edge = muT(i_2d);</span><span class="removed-line">- 					muy_edge = mu_n(i_2d);;</span><span class="removed-line">- 					hy_edge = hT(i_2d);</span><span class="removed-line">- 					vy_edge_case(i_3d) = 0.5 / muy_edge * dpy_edge * ( pow(hy_edge/Q*(q+0.5), 2) - hy_edge/Q*(q+0.5) * hy_edge);</span><span class="removed-line">- 					vy_edge_case(i_3d) += vK * (q+0.5) / Q;</span><span class="removed-line">- 				}</span><span class="removed-line">- </span><span class="removed-line">- 			}</span><span class="removed-line">- 		}</span><span class="removed-line">- 	}</span><span class="removed-line">- }</span><span class="unchanged-line">  //Calculate gap axial and circumferential fluid velocity</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 39 (around line 2851)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  {</span><span class="unchanged-line">  	Array&amp;lt;int,1&amp;gt; zerotemp;</span><span class="unchanged-line">  	zerotemp.resize(N*M*Q);</span><span class="removed-line">- 	vector&amp;lt;double&amp;gt; Poiseuille;</span><span class="removed-line">- 	vector&amp;lt;double&amp;gt; Couette;</span><span class="removed-line">- 	int mycounter,numberdeleted;</span><span class="removed-line">- 	</span><span class="removed-line">- </span><span class="unchanged-line">  </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 40 (around line 2876)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		}</span><span class="unchanged-line">  	}</span><span class="unchanged-line">  </span><span class="removed-line">- 	</span><span class="removed-line">- 	Poiseuille.resize(M,0.0);</span><span class="removed-line">- 	Couette.resize(M,0.0);</span><span class="removed-line">- 	mycounter = 0;</span><span class="removed-line">- </span><span class="removed-line">- 	for(int myQ = 0;myQ&amp;lt;Q;myQ++)</span><span class="removed-line">- 		for(int myN = 0;myN&amp;lt;N;myN++)</span><span class="removed-line">- 			for(int myM = 0;myM&amp;lt;M;myM++){</span><span class="removed-line">- 				Poiseuille[myM] += vy_p(myQ*M*N + myN*M +myM) * dAy(myQ*M*N + myN*M +myM) * zerotemp(myQ*M*N + myN*M +myM);</span><span class="removed-line">- 				Couette[myM] += vy_c(myQ*M*N + myN*M +myM) * dAy(myQ*M*N + myN*M +myM) * zerotemp(myQ*M*N + myN*M +myM);</span><span class="removed-line">- 			}</span><span class="removed-line">- </span><span class="removed-line">- 	//Remove grooves from leakage calculation.</span><span class="removed-line">- 	numberdeleted = 0;</span><span class="removed-line">- 	for(int i = 0;i&amp;lt;M;i++){</span><span class="removed-line">- 		if(zerolizhi(i) == 0){</span><span class="removed-line">- 			Poiseuille.erase(Poiseuille.begin()+i-numberdeleted);</span><span class="removed-line">- 			Couette.erase(Couette.begin()+i-numberdeleted);</span><span class="removed-line">- 			numberdeleted++;</span><span class="removed-line">- 		}</span><span class="removed-line">- 	}</span><span class="removed-line">- </span><span class="removed-line">- 	sort(Poiseuille.begin(),Poiseuille.end());</span><span class="removed-line">- 	sort(Couette.begin(),Couette.end());</span><span class="removed-line">- </span><span class="unchanged-line">  	//Poiseuille</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 41 (around line 3059)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	pold = p;</span><span class="unchanged-line">  	//Assign old fluid viscosity</span><span class="unchanged-line">  	oilviscosity_old = oilviscosity;</span><span class="removed-line">- 	oildensity_old = oildensity;</span><span class="unchanged-line">  </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 42 (around line 3108)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		//gap surface temperature</span><span class="unchanged-line">  		TK_surf.resize(n);</span><span class="unchanged-line">  		//gap heat flux</span><span class="removed-line">- 		EbodyK.resize(n); EbodyK=1.0e-9;</span><span class="removed-line">- 		tbodyK_DC.resize(n); tbodyK_DC=0;</span><span class="removed-line">- 		tbodyK_case.resize(n); tbodyK_case=0;</span><span class="removed-line">- 		EbodyK_old.resize(n); EbodyK_old=EbodyK;</span><span class="unchanged-line">  		//heat flux vector</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 43 (around line 3120)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  			qbi.resize((int) myThermal.faceid_qb[i].size());	qbi = 1.0e-9;</span><span class="unchanged-line">  			qbi_piston.push_back(qbi);</span><span class="unchanged-line">  		}</span><span class="removed-line">- 		//Heatfluxrecovering(1);</span><span class="removed-line">- 		Mid_B2K.resize(n);</span><span class="removed-line">- 		Mwt_B2K.resize(n);</span><span class="unchanged-line">  	}</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 44 (around line 3173)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		//gap surface temperature</span><span class="unchanged-line">  		TB_surf.resize(n);</span><span class="unchanged-line">  		//heat flux</span><span class="removed-line">- 		EbodyB.resize(n); EbodyB=1.0e-9;</span><span class="removed-line">- 		tbodyB_DC.resize(n); tbodyB_DC=0;</span><span class="removed-line">- 		tbodyB_case.resize(n); tbodyB_case=0;</span><span class="removed-line">- 		EbodyB_old.resize(n); EbodyB_old=EbodyB;</span><span class="unchanged-line">  		//gap heat flux vector</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 45 (around line 3185)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  			qbi.resize((int) myThermal.faceid_qb[i].size());	qbi = 1.0e-9;</span><span class="unchanged-line">  			qbi_cylinder.push_back(qbi);</span><span class="unchanged-line">  		}</span><span class="removed-line">- 		//Heatfluxrecovering(0);</span><span class="removed-line">- 		Mid_K2B.resize(n);</span><span class="removed-line">- 		Mwt_K2B.resize(n);</span><span class="unchanged-line">  	};</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 46 (around line 3219)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  void CPistonGap::PistonCylinderSearchNodesNeighbours(int nb)</span><span class="unchanged-line">  {</span><span class="unchanged-line">  </span><span class="removed-line">- 	double lA,lB,lch,speedK,phi_rad;</span><span class="unchanged-line">  	Range all=Range::all();</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 47 (around line 3297)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		}</span><span class="unchanged-line">  	}</span><span class="unchanged-line">  	</span><span class="removed-line">- 	//---------------------------------PISTON to CYLINDER THERMAL MESH-----------------------------------//</span><span class="removed-line">- 	if(HeatTransfer || ThermalDeformation)</span><span class="removed-line">- 	{</span><span class="removed-line">- 		Array&amp;lt;double,2&amp;gt; xyz_r;	</span><span class="removed-line">- 		xyz_r.resize(myGapInput.xyzfK_th.extent(0),3);				xyz_r = 0.0;</span><span class="removed-line">- 		double phioffset = phi_rad * speedK;</span><span class="removed-line">- 		double zoffset = lB - lA - lch;</span><span class="removed-line">- 		//rotate and shift the piston to current location according to cylinder block coordinate system</span><span class="removed-line">- 		xyz_r(all,0) = myGapInput.xyzfK_th(all,0)*cos(phioffset) - 1.0 * myGapInput.xyzfK_th(all,1)*sin(phioffset);</span><span class="removed-line">- 		xyz_r(all,1) = myGapInput.xyzfK_th(all,0)*sin(phioffset) + myGapInput.xyzfK_th(all,1)*cos(phioffset);</span><span class="removed-line">- 		xyz_r(all,2) = myGapInput.xyzfK_th(all,2) + zoffset;</span><span class="removed-line">- 		//Shift reference ccordinate system from block center to cylinder bore center</span><span class="removed-line">- 		if(EHDTestRig==0 &amp;&amp; TriboTestRig==0)</span><span class="removed-line">- 		{</span><span class="removed-line">- 			myGapInput.xyzfB_th(all,1) -= rB;</span><span class="removed-line">- 			myGapInput.xyznB_th(all,1) -= rB;</span><span class="removed-line">- 		}</span><span class="removed-line">- 		//Search piston structure to cylinder structure</span><span class="removed-line">- 		myGapUtils.SearchNeighbours(xyz_r,myGapInput.xyzfB_th,FaceId_K2B_th,FaceDist_K2B_th,nb);</span><span class="removed-line">- 		//Reset structure coordinates</span><span class="removed-line">- 		if(EHDTestRig==0 &amp;&amp; TriboTestRig==0)</span><span class="removed-line">- 		{</span><span class="removed-line">- 			myGapInput.xyzfB_th(all,1) += rB;</span><span class="removed-line">- 			myGapInput.xyznB_th(all,1) += rB;</span><span class="removed-line">- 		}</span><span class="removed-line">- 	}</span><span class="removed-line">- </span><span class="removed-line">- 	//---------------------------------CYLINDER to PISTON THERMAL MESH-----------------------------------//</span><span class="removed-line">- 	if(HeatTransfer || ThermalDeformation)</span><span class="removed-line">- 	{</span><span class="removed-line">- 		//Shift reference ccordinate system from block center to cylinder bore center</span><span class="removed-line">- 		if(EHDTestRig==0 &amp;&amp; TriboTestRig==0)</span><span class="removed-line">- 		{</span><span class="removed-line">- 			myGapInput.xyzfB_th(all,1) -= rB;</span><span class="removed-line">- 			myGapInput.xyznB_th(all,1) -= rB;</span><span class="removed-line">- 		}</span><span class="removed-line">- 		//rotate and shift the cylinder block to current location according to piston coordinate system</span><span class="removed-line">- 		Array&amp;lt;double,2&amp;gt; xyz_r;	</span><span class="removed-line">- 		xyz_r.resize(myGapInput.xyzfB_th.extent(0),3);				xyz_r = 0.0;</span><span class="removed-line">- 		double phioffset = -1.0 * phi_rad * speedK;</span><span class="removed-line">- 		double zoffset = -1.0 * (lB - lA - lch);</span><span class="removed-line">- 		xyz_r(all,0) = myGapInput.xyzfB_th(all,0)*cos(phioffset) - 1.0 * myGapInput.xyzfB_th(all,1)*sin(phioffset);</span><span class="removed-line">- 		xyz_r(all,1) = myGapInput.xyzfB_th(all,0)*sin(phioffset) + myGapInput.xyzfB_th(all,1)*cos(phioffset);</span><span class="removed-line">- 		xyz_r(all,2) = myGapInput.xyzfB_th(all,2) + zoffset;</span><span class="removed-line">- 		//Search cylinder structure to piston structure</span><span class="removed-line">- 		myGapUtils.SearchNeighbours(xyz_r,myGapInput.xyzfK_th,FaceId_B2K_th,FaceDist_B2K_th,nb);</span><span class="removed-line">- 		//Reset structure coordinates</span><span class="removed-line">- 		if(EHDTestRig==0 &amp;&amp; TriboTestRig==0)</span><span class="removed-line">- 		{</span><span class="removed-line">- 			myGapInput.xyzfB_th(all,1) += rB;</span><span class="removed-line">- 			myGapInput.xyznB_th(all,1) += rB;</span><span class="removed-line">- 		}</span><span class="removed-line">- 	}</span><span class="removed-line">- 	</span><span class="unchanged-line">  };</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><h5>‚ú® Added Code Sections:</h5><div class="function-container"><div class="function-header">‚úÖ Added Section 1 (around line 229)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  </span><span class="unchanged-line">  </span><span class="unchanged-line">  	//If EHD Test Rig is simulated, no relative piston rotation is considered</span><span class="added-line">+ 	if(EHDTestRig)</span><span class="unchanged-line">  	{</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 2 (around line 242)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	//oilpistongap.oilbetaP = myinput.data.oil.oilbetaP;</span><span class="unchanged-line">  	//oilpistongap.oilbetaT = myinput.data.oil.oilbetaT;</span><span class="unchanged-line">  	//oilpistongap.oilPc1 = myinput.data.oil.oilPc1;</span><span class="added-line">+ 	///oilpistongap.oilPc2 = myinput.data.oil.oilPc2;</span><span class="unchanged-line">  	//oilpistongap.oilTc1 = myinput.data.oil.oilTc1;</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 3 (around line 261)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		Log &amp;lt;&amp;lt; "Using User Defined Oil Model" &amp;lt;&amp;lt; "\n";</span><span class="unchanged-line">  		my_oil=new user_defined_oil(myinput);</span><span class="unchanged-line">  	}</span><span class="added-line">+ 	/*else if(myinput.data.oil.general.oiltype == 2){</span><span class="unchanged-line">  		Log &amp;lt;&amp;lt; "Using HLP32 Oil Model" &amp;lt;&amp;lt; "\n";</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 4 (around line 273)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		Log &amp;lt;&amp;lt; "Using Red Oil Model" &amp;lt;&amp;lt; "\n";</span><span class="unchanged-line">  		my_oil=new red_oil(myinput);</span><span class="unchanged-line">  	}</span><span class="added-line">+ 	else if(myinput.data.oil.general.oiltype == 5){</span><span class="added-line">+ 		Log &amp;lt;&amp;lt; "Using SAE 10 Oil Model" &amp;lt;&amp;lt; "\n";</span><span class="added-line">+ 		my_oil=new SAE10W(myinput);</span><span class="added-line">+ 	}</span><span class="unchanged-line">  	else if(myinput.data.oil.general.oiltype == 6){</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 5 (around line 284)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	else if(myinput.data.oil.general.oiltype == 7){</span><span class="unchanged-line">  		Log &amp;lt;&amp;lt; "Using Exxon DTE Excel 32 Oil Model" &amp;lt;&amp;lt; "\n";</span><span class="unchanged-line">  		my_oil=new ExxonDTE10Excel32(myinput);</span><span class="added-line">+ 	}*/</span><span class="unchanged-line">  	else if(myinput.data.oil.general.oiltype == 8){</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 6 (around line 333)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  </span><span class="unchanged-line">  </span><span class="unchanged-line">  	//Gap flow variables</span><span class="added-line">+ 	dht.resize(N*M);					dht=0;			</span><span class="unchanged-line">  	sigma.resize(N*M);					sigma=0;</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 7 (around line 450)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		ResumeFile = ResumeData.cFileName;</span><span class="unchanged-line">  	}*/</span><span class="unchanged-line">  </span><span class="added-line">+ </span><span class="unchanged-line">  	//-------------------Read piston mesh and size fields-----------------//</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 8 (around line 474)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		//---------------------Calculate temperature piston---------------------//</span><span class="unchanged-line">  		if(HeatTransfer)</span><span class="unchanged-line">  		{</span><span class="added-line">+ 			myThermal.ThermalSolve("piston",qbi_piston,TK_body,TK_surf);</span><span class="unchanged-line">  		};</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 9 (around line 501)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		//-------------------Calculate temperature cylinder------------------//</span><span class="unchanged-line">  		if(HeatTransfer)</span><span class="unchanged-line">  		{</span><span class="added-line">+ 			myThermal.ThermalSolve("cylinder",qbi_cylinder,TB_body,TB_surf);</span><span class="unchanged-line">  		}</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 10 (around line 523)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		Log &amp;lt;&amp;lt; "done!" &amp;lt;&amp;lt; "\n";</span><span class="unchanged-line">  		Log &amp;lt;&amp;lt; " " &amp;lt;&amp;lt; "\n";</span><span class="unchanged-line">  	};</span><span class="added-line">+ 	</span><span class="unchanged-line">  	//Set displacement chamber pressure</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 11 (around line 532)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	PistonInitializeViscosity(1.0e8,120.0);</span><span class="unchanged-line">  	//Initialize density --- Lizhi 03/19/2015</span><span class="unchanged-line">  	PistonCalcDensity();</span><span class="added-line">+ </span><span class="unchanged-line">  	//First revolution</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 12 (around line 545)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  </span><span class="unchanged-line">  }; </span><span class="unchanged-line">  //Solve piston gap</span><span class="added-line">+ void CPistonGap::PistonGap(vector&amp;lt;double&amp;gt; &amp;xp,vector&amp;lt;double&amp;gt; &amp;vp)</span><span class="unchanged-line">  {</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 13 (around line 610)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		//Calculate fluid viscosity</span><span class="unchanged-line">  		PistonCalcViscosity(1.0e8,120.0);</span><span class="unchanged-line">  		//Relax fluid viscosity</span><span class="added-line">+ 		oilviscosity = oilviscosity_old + AlphaMu * (oilviscosity - oilviscosity_old);</span><span class="added-line">+ </span><span class="unchanged-line">  		//Assign old pressure deformations</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 14 (around line 695)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  </span><span class="unchanged-line">  </span><span class="unchanged-line">  	//Calculate heat fluxes coming from the fluid film</span><span class="added-line">+ 	PistonCylinderCalcGapThermalFlux( );</span><span class="added-line">+ </span><span class="unchanged-line">  </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 15 (around line 859)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	double tempdouble = operatingpistongap.pDC*1.0e-5;</span><span class="unchanged-line">  	Log &amp;lt;&amp;lt; "pDC: " &amp;lt;&amp;lt; tempdouble &amp;lt;&amp;lt; " [bar]" &amp;lt;&amp;lt; "\n";</span><span class="unchanged-line">  </span><span class="added-line">+ 	if(myinput.data.options_piston.general.inclined_piston)</span><span class="added-line">+ 	{</span><span class="added-line">+ 		//Calculate the piston stroke</span><span class="added-line">+ 		PistonCalcsK_inclined();</span><span class="added-line">+ </span><span class="added-line">+ 		//Calculate the piston velocity</span><span class="added-line">+ 		PistonCalcvK_inclined();</span><span class="added-line">+ 	}</span><span class="added-line">+ 	else</span><span class="added-line">+ 	{</span><span class="added-line">+ 		//Calculate the piston stroke</span><span class="added-line">+ 		PistonCalcsK();</span><span class="added-line">+ </span><span class="added-line">+ 		//Calculate the piston velocity</span><span class="added-line">+ 		PistonCalcvK();</span><span class="added-line">+ 	}</span><span class="unchanged-line">  	//Calculate the variable gap length</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 16 (around line 925)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  //Initialize fluid fields: pressure, temperature and viscosity</span><span class="unchanged-line">  void CPistonGap::PistonInitializePressure(void)</span><span class="unchanged-line">  {</span><span class="added-line">+ </span><span class="added-line">+ 	for(int i=0;i&amp;lt;N*M;i++)</span><span class="added-line">+ 	{</span><span class="added-line">+ 		if(i%M==(M-1))</span><span class="added-line">+ 		{</span><span class="added-line">+ 			p(i) = operatingpistongap.pCase;</span><span class="added-line">+ 		}</span><span class="added-line">+ 		else if(i%M==0)</span><span class="added-line">+ 		{</span><span class="added-line">+ 			p(i) = operatingpistongap.pDC;</span><span class="added-line">+ 		}</span><span class="added-line">+ 		else</span><span class="added-line">+ 		{</span><span class="added-line">+ 			p(i) = (operatingpistongap.pDC + operatingpistongap.pCase)*0.5;</span><span class="added-line">+ 		};</span><span class="unchanged-line">  	};</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 17 (around line 966)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	TCase = temperaturepistongap.TCase;</span><span class="unchanged-line">  	Tmax = temperaturepistongap.Tmax;</span><span class="unchanged-line">    </span><span class="added-line">+ </span><span class="unchanged-line">  	//Numerical field with temperature gradient</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 18 (around line 977)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	b = Tmax - dt_2*st;</span><span class="unchanged-line">  	//Temperature</span><span class="unchanged-line">  	T(Range(0,st)) = TDC + tensor::i*dt_1;</span><span class="added-line">+ 	T(Range(st+1,M-1)) = b + (tensor::i+(st+1))*dt_2;</span><span class="unchanged-line">  	for(int i=0;i&amp;lt;N*Q;i++)</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 19 (around line 1173)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	defB_p_gap = myGapUtils.InterpolateFields(NodeIdB_s2f_p,NodeDistB_s2f_p,defB_p);</span><span class="unchanged-line">  </span><span class="unchanged-line">  	//Smooth interpolated fields</span><span class="added-line">+ 	PistonCylinderSmoothField(defK_p_gap,10);</span><span class="added-line">+ 	PistonCylinderSmoothField(defB_p_gap,10);</span><span class="unchanged-line">  </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 20 (around line 1295)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  </span><span class="unchanged-line">  </span><span class="unchanged-line">  };</span><span class="added-line">+ </span><span class="added-line">+ </span><span class="added-line">+ void CPistonGap::PistonCalcvK_inclined(void){</span><span class="added-line">+ 	</span><span class="added-line">+ 	double omega, beta, phi,zeta;</span><span class="added-line">+ 	omega = operatingpistongap.omega;</span><span class="added-line">+ 	beta = operatingpistongap.beta_rad;</span><span class="added-line">+ 	phi = operatingpistongap.phi_rad;</span><span class="added-line">+ 	zeta = myinput.data.options_piston.general.zeta * PI / 180;</span><span class="added-line">+ 	double r_temp= rB - (2*rB*tan(beta)*tan(zeta)*sin(phi/2)*sin(phi/2));</span><span class="added-line">+ 	//Center of mass inertia force z directions</span><span class="added-line">+ 	</span><span class="added-line">+ </span><span class="added-line">+ 	operatingpistongap.vK = -1.0 * operatingpistongap.omega * r_temp *tan(beta)/cos(zeta) * sin(phi);</span><span class="added-line">+ };</span><span class="added-line">+ //Calculate piston stroke	</span><span class="added-line">+ void CPistonGap::PistonCalcsK_inclined(void){</span><span class="added-line">+ 	double beta, betamax, phi, sK_beta, sK_gamma, delta_psi, phi_odp, zeta;</span><span class="added-line">+ </span><span class="added-line">+ 	beta = operatingpistongap.beta_rad;</span><span class="added-line">+ 	betamax = operatingpistongap.betamax_rad;</span><span class="added-line">+ 	</span><span class="added-line">+ 	phi = operatingpistongap.phi_rad;</span><span class="added-line">+ 	zeta = myinput.data.options_piston.general.zeta * PI / 180;</span><span class="added-line">+ </span><span class="added-line">+ 	sK_beta = - rB * tan(beta)/cos(zeta)*( 1 - cos(phi));</span><span class="added-line">+ 	geometrypistongap.sK = sK_beta - rB * (tan(betamax) - tan(beta));</span><span class="added-line">+ </span><span class="added-line">+ };</span><span class="unchanged-line">  //Calculate piston velocity</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 21 (around line 1361)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	geometrypistongap.sK = sK_beta + sK_gamma - rB * ( tan(betamax) - tan(beta) )+delta_psi;</span><span class="unchanged-line">  	//geometrypistongap.sK = sK1 - rB * ( tan(betamax) - tan(beta) );</span><span class="unchanged-line">  </span><span class="added-line">+ };</span><span class="unchanged-line">  //Calculate variable gap length</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 22 (around line 1405)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  </span><span class="unchanged-line">  </span><span class="unchanged-line">  	//Position of the back flat piston edge from beginning of bushing [m]</span><span class="added-line">+ 	temp_B = sK + delta_B - (lK - lKG);</span><span class="unchanged-line">  	pos_B = - temp_B - le;</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 23 (around line 1471)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	geometrypistongap.z_B = ( lF - geometrypistongap.lB - geometrypistongap.lvar ) + le + geometrypistongap.delta_0 ;</span><span class="unchanged-line">  </span><span class="unchanged-line">  </span><span class="added-line">+ 	//Remove extra decimals</span><span class="added-line">+ 	geometrypistongap.lA = floor(geometrypistongap.lA*1.0e6) / 1.0e6 ;</span><span class="unchanged-line">  	geometrypistongap.lB = floor(geometrypistongap.lB*1.0e6) / 1.0e6 ;</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 24 (around line 1833)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	PistonCalcMcrB( );</span><span class="unchanged-line">  </span><span class="unchanged-line">  	//Relative deformed &amp; macro-geometric film thickness (sliding surface)</span><span class="added-line">+ 	hK += - defK_gap - McrK;</span><span class="unchanged-line">  </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 25 (around line 1851)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	//Minimum gap</span><span class="unchanged-line">  	double hmin = geometrypistongap.hmin;	</span><span class="unchanged-line">  	h = where(h&amp;lt;hmin, hmin, h);</span><span class="added-line">+ 	hK = where(hK&amp;lt;hmin, hmin, hK);</span><span class="unchanged-line">  </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 26 (around line 1875)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	};</span><span class="unchanged-line">  	muT /= (1.0*Q) ;</span><span class="unchanged-line">  	//Under-relax viscosity to avoid force oscillation</span><span class="added-line">+ 	muT = muT_old + 0.1 * (muT - muT_old) ;</span><span class="unchanged-line">  </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 27 (around line 2202)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  </span><span class="unchanged-line">  };</span><span class="unchanged-line">  //Calculate squeeze motion from control points</span><span class="added-line">+ void CPistonGap::PistonCalcdht(vector&amp;lt;double&amp;gt; &amp;vp)</span><span class="added-line">+ {</span><span class="added-line">+ 	double dvxm,dvym,vp0,vp1,vp2,vp3,lvar,hmin;</span><span class="unchanged-line">  	lvar = geometrypistongap.lvar;</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 28 (around line 2571)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		//gap surface temperature</span><span class="unchanged-line">  		TK_surf.resize(n);</span><span class="unchanged-line">  		//gap heat flux</span><span class="added-line">+ 		EbodyK.resize(n); EbodyK=0.0;</span><span class="added-line">+ 		EbodyK_old.resize(n); EbodyK_old=0.0;</span><span class="unchanged-line">  		//heat flux vector</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 29 (around line 2631)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		//gap surface temperature</span><span class="unchanged-line">  		TB_surf.resize(n);</span><span class="unchanged-line">  		//heat flux</span><span class="added-line">+ 		EbodyB.resize(n); EbodyB=0.0;</span><span class="added-line">+ 		EbodyB_old.resize(n); EbodyB_old=0.0;</span><span class="unchanged-line">  		//gap heat flux vector</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 30 (around line 2672)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  void CPistonGap::PistonCylinderSearchNodesNeighbours(int nb)</span><span class="unchanged-line">  {</span><span class="unchanged-line">  </span><span class="added-line">+ 	double lA,lB,lch;</span><span class="unchanged-line">  	Range all=Range::all();</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 31 (around line 2748)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		}</span><span class="unchanged-line">  	}</span><span class="unchanged-line">  	</span><span class="added-line">+ </span><span class="unchanged-line">  };</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div></div><div class="section"><h3 class="file-title">üìÑ CPistonGap.h</h3><p><strong>Status:</strong> üîµ 23 additions and 94 deletions (net reduction of 71 lines)</p><p><strong>Size:</strong> 30,655 ‚Üí 26,804 bytes (-3,851 bytes)</p><p><strong>Changes:</strong> +23 lines added, -94 lines removed</p><p><strong>Types of Changes:</strong> Functions, Comments</p><h4>üîß Code Changes (Separated by Type):</h4><h5>üóëÔ∏è Removed Code Sections:</h5><div class="function-container"><div class="function-header">‚ùå Removed Section 1 (around line 69)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	Array&amp;lt;double,1&amp;gt; p;					//Pressure 2D vector</span><span class="unchanged-line">  	Array&amp;lt;double,1&amp;gt; r_p;				//Pressure 2D vector</span><span class="unchanged-line">  	Array&amp;lt;double,1&amp;gt; h;					//Height 2D vector</span><span class="removed-line">- 	Array&amp;lt;double,1&amp;gt; h_pre;					//Height 2D vector</span><span class="unchanged-line">  	Array&amp;lt;double,1&amp;gt; hT;					//Height 2D vector</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 2 (around line 77)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	Array&amp;lt;double,1&amp;gt; h1;					//Height 2D vector</span><span class="unchanged-line">  	Array&amp;lt;double,1&amp;gt; hK;					//Height 2D vector piston</span><span class="unchanged-line">  	Array&amp;lt;double,1&amp;gt; dht;				//Squeeze motion</span><span class="removed-line">- 	Array&amp;lt;double,1&amp;gt; dht_total;				//Squeeze motion</span><span class="unchanged-line">  	Array&amp;lt;double,1&amp;gt; sigma;				//Conatct stress</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 3 (around line 100)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	Array&amp;lt;double,1&amp;gt; dz2;				//Height incrment 2D vector</span><span class="unchanged-line">  	Array&amp;lt;double,1&amp;gt; oilviscosity;		//Viscoity field</span><span class="unchanged-line">  	Array&amp;lt;double,1&amp;gt; oilviscosity_old;	//Viscoity field previous step</span><span class="removed-line">- 	Array&amp;lt;double,1&amp;gt; mu_n;</span><span class="removed-line">- 	Array&amp;lt;double,1&amp;gt; mu_s;</span><span class="removed-line">- 	Array&amp;lt;double,1&amp;gt; mu_e;</span><span class="removed-line">- 	Array&amp;lt;double,1&amp;gt; mu_w;</span><span class="unchanged-line">  	Array&amp;lt;double,1&amp;gt; oildensity;			//Density field</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 4 (around line 123)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	Array&amp;lt;double,1&amp;gt; pEHD;		//EHD Test rig pressure</span><span class="unchanged-line">  	Array&amp;lt;double,1&amp;gt; mu;			//2D viscosity field</span><span class="unchanged-line">  	Array&amp;lt;double,1&amp;gt; rho2d;		//2D density field --- Lizhi 03/17/2015</span><span class="removed-line">- 	Array&amp;lt;double,1&amp;gt; density_expansion;</span><span class="unchanged-line">  	Array&amp;lt;double,1&amp;gt; muT;		//2D viscosity field from friction forces</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 5 (around line 195)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	vector&amp;lt;Array&amp;lt;double,1&amp;gt;&amp;gt; qbi_piston;</span><span class="unchanged-line">  	vector&amp;lt;Array&amp;lt;double,1&amp;gt;&amp;gt; qbi_cylinder;</span><span class="unchanged-line">  	Array&amp;lt;double,1&amp;gt; EbodyK;			//energy flux to piston body [J/m2]</span><span class="removed-line">- 	Array&amp;lt;double,1&amp;gt; tbodyK_DC;		//length of the period when gap surface is in DC or case volume</span><span class="removed-line">- 	Array&amp;lt;double,1&amp;gt; tbodyK_case;	</span><span class="removed-line">- 	Array&amp;lt;double,1&amp;gt; tbodyB_DC;		</span><span class="removed-line">- 	Array&amp;lt;double,1&amp;gt; tbodyB_case;	</span><span class="unchanged-line">  	Array&amp;lt;double,1&amp;gt; EbodyB;			//energy flux to cylinder body [J/m2]</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 6 (around line 269)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	Array&amp;lt;int,2&amp;gt; FaceIdB_f2s_th;</span><span class="unchanged-line">  	Array&amp;lt;double,2&amp;gt; FaceDistK_f2s_th;</span><span class="unchanged-line">  	Array&amp;lt;double,2&amp;gt; FaceDistB_f2s_th;</span><span class="removed-line">- 	//face ids structure to structure</span><span class="removed-line">- 	Array&amp;lt;int,2&amp;gt; FaceId_K2B_th;</span><span class="removed-line">- 	Array&amp;lt;int,2&amp;gt; FaceId_B2K_th;</span><span class="removed-line">- 	Array&amp;lt;double,2&amp;gt; FaceDist_K2B_th;</span><span class="removed-line">- 	Array&amp;lt;double,2&amp;gt; FaceDist_B2K_th;</span><span class="removed-line">- 	//</span><span class="removed-line">- 	vector&amp;lt;vector&amp;lt;int&amp;gt;&amp;gt; Mid_K2B;</span><span class="removed-line">- 	vector&amp;lt;vector&amp;lt;int&amp;gt;&amp;gt; Mid_B2K;</span><span class="removed-line">- 	vector&amp;lt;vector&amp;lt;double&amp;gt;&amp;gt; Mwt_K2B;</span><span class="removed-line">- 	vector&amp;lt;vector&amp;lt;double&amp;gt;&amp;gt; Mwt_B2K;</span><span class="removed-line">- </span><span class="unchanged-line">  </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 7 (around line 339)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		//-------Moment arms for cylinder block balance---//</span><span class="unchanged-line">  		double z_A;						//Distance from piston DC coordinate system origin to cylinder block origin [m]</span><span class="unchanged-line">  		double z_B;						//Distance from piston Case coordinate system origin to cylinder block origin [m]</span><span class="removed-line">- 		double z_A_old;						//Distance from piston DC coordinate system origin to cylinder block origin [m]</span><span class="removed-line">- 		double z_B_old;						//Distance from piston Case coordinate system origin to cylinder block origin [m]</span><span class="unchanged-line">  	};</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 8 (around line 488)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		Array&amp;lt;double,1&amp;gt; h;</span><span class="unchanged-line">  		//Fluid viscosity</span><span class="unchanged-line">  		Array&amp;lt;double,1&amp;gt; mu;</span><span class="removed-line">- 		//Fluid density</span><span class="removed-line">- 		Array&amp;lt;double,1&amp;gt; rho;</span><span class="unchanged-line">  		//FaceId prolongation</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 9 (around line 500)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	vector&amp;lt;LEVEL&amp;gt; levels;</span><span class="unchanged-line">  	Array&amp;lt;double,1&amp;gt; xold;</span><span class="unchanged-line">  </span><span class="removed-line">- 	//------------------HD Pressure Calculation-------------------------------//</span><span class="removed-line">- 	typedef struct</span><span class="removed-line">- 	{</span><span class="removed-line">- 		vector&amp;lt;double&amp;gt; GridD;	//FSTI fluid density [kg/m3]</span><span class="removed-line">- 		vector&amp;lt;double&amp;gt; GridH;	//FSTI film thickness of each grid point [m]</span><span class="removed-line">- 		vector&amp;lt;double&amp;gt; GridP;	//FSTI fluid pressure of each grid point [Pa]</span><span class="removed-line">- 		vector&amp;lt;double&amp;gt; GridV;	//FSTI fluid viscosity [Pa-s]</span><span class="removed-line">- 		vector&amp;lt;double&amp;gt; GridX;	//X coordinate of each grid point. Axial from DC [m]</span><span class="removed-line">- 		vector&amp;lt;double&amp;gt; GridY;	//Y coordinate of each grid point. Circumferentially around bushing, same direction as FSTI Phi_k [m]</span><span class="removed-line">- 		vector&amp;lt;double&amp;gt; GridQ;	//Squeeze [m/s]</span><span class="removed-line">- 		vector&amp;lt;double&amp;gt; GridA;	//Expansion</span><span class="removed-line">- 		vector&amp;lt;int&amp;gt; GridE;		//Number of the grid point neighboring to the East (axially positive)</span><span class="removed-line">- 		vector&amp;lt;int&amp;gt; GridN;		//Number of the grid point neighboring to the North (circumferentially positive)</span><span class="removed-line">- 		vector&amp;lt;int&amp;gt; GridS;		//Number of the grid point neighboring to the South (circumferentially negative)</span><span class="removed-line">- 		vector&amp;lt;int&amp;gt; GridW;		//Number of the grid point neighboring to the West (axially negative)</span><span class="removed-line">- 		//vector&amp;lt;int&amp;gt; GridC;		//Section ID number</span><span class="removed-line">- 		//vector&amp;lt;vector&amp;lt;int &amp;gt; &amp;gt; GridT; //Sections under each section</span><span class="removed-line">- 	} HDLEVEL;</span><span class="removed-line">- 	vector&amp;lt;HDLEVEL&amp;gt; HDlevels;</span><span class="removed-line">- 	vector&amp;lt;int&amp;gt; reshere;			//integer for each grid point indicating which level contains pressure values (coarser points in same location contain residual values).</span><span class="removed-line">- 	vector&amp;lt;double&amp;gt; updatepress;		//intermediate storage for new pressure values during calculations</span><span class="removed-line">- </span><span class="removed-line">- </span><span class="unchanged-line">  	//------------------DECLARATION OF MULTIGRID FUNCTIONS--------------------//</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 10 (around line 531)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	Array&amp;lt;double,1&amp;gt; PistonProlongationBilinearMG(int l_c,Array&amp;lt;double,1&amp;gt; field_c,Array&amp;lt;int,2&amp;gt; FaceId_c2f);</span><span class="unchanged-line">  	void PistonVcycleMG(void);</span><span class="unchanged-line">  	void PistonWcycleMG(void);</span><span class="removed-line">- 	void PistonReynoldsCalcCoefficientsMG(double dt);</span><span class="unchanged-line">  	void PistonReynoldsMG(void);</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 11 (around line 569)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	//Guess a fluid viscosity for initialization and slipper approximated friction force</span><span class="unchanged-line">  	void PistonGuessViscosity(double &amp;oilviscosityguess);</span><span class="unchanged-line">  	//Calculate fluid velocity in x direction</span><span class="removed-line">- 	void PistonCalcVedge(void);	</span><span class="unchanged-line">  	void PistonCalcV(void);	</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 12 (around line 604)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	void CPistonGap::Pistongroove(void);</span><span class="unchanged-line">  	//Calculate step location</span><span class="unchanged-line">  	void CPistonGap::Pistonsteplocation(void);</span><span class="removed-line">- 	//Refine the HD Pressure Grid</span><span class="removed-line">- 	bool CPistonGap::RefineMesh(int gridref,bool forcebalance);</span><span class="removed-line">- 	//Check for duplicate HD mesh points</span><span class="removed-line">- 	int CPistonGap::CheckPoint(double nX,double nY, double tol, int gridref);</span><span class="removed-line">- 	//Updates the pressure field using the Reynolds Equation</span><span class="removed-line">- 	void CPistonGap::SolveReynoldsHD(int gridref,int maxlev,double alphapress,double dt);</span><span class="removed-line">- 	void CPistonGap::ReynoldsResidualHD(int gridref, int maxlev,double dt);</span><span class="removed-line">- 	double CPistonGap::CalcRes(vector&amp;lt;double&amp;gt; pold,vector&amp;lt;double&amp;gt; pnew);</span><span class="removed-line">- 	void CPistonGap::Recursion(int gridref, int maxlev, double dt,int section,bool updown,double relax);</span><span class="removed-line">- 	void CPistonGap::CalcPressureHD(double dt,bool forcebalance);</span><span class="removed-line">- </span><span class="unchanged-line">  </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 13 (around line 641)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	//----------------------DECLARATION OF THERMAL FUNCTIONS-------------------------//</span><span class="unchanged-line">  	void PistonCylinderCalcGapThermalFlux(void);						//Gap Thermal heat fluxes</span><span class="unchanged-line">  	void PistonCylinderCalcBodyThermalFlux(void);						//Gap Thermal heat fluxes calculation to solid bodies</span><span class="removed-line">- 	void PistonCylinderCalcGapThermalFlux_new(void);						//Gap Thermal heat fluxes</span><span class="removed-line">- 	void PistonCylinderCalcBodyThermalFlux_new(void);						//Gap Thermal heat fluxes calculation to solid bodies</span><span class="removed-line">- 	void PistonCylinderConstructWeightedMatrix(void);</span><span class="unchanged-line">  	void PistonCylinderBlockFlux(vector&amp;lt;Array&amp;lt;double,1&amp;gt;&amp;gt; &amp;qbi);			//Cylinder block bore fluxes</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><h5>‚ú® Added Code Sections:</h5><div class="function-container"><div class="function-header">‚úÖ Added Section 1 (around line 404)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		double MKy;				//Moment from external force piston around y axis</span><span class="unchanged-line">  		double MK;				//Total moment from external force piston</span><span class="unchanged-line">  		double Fsk;				//Piston normal force with swashplate</span><span class="added-line">+ </span><span class="added-line">+ </span><span class="added-line">+ 		// custom</span><span class="added-line">+ 		</span><span class="added-line">+ 		double FSKx;            // Reaction forcee on X</span><span class="added-line">+ 		double FSKy;            // Reaction force on Y</span><span class="added-line">+ 		double FAKz;            // Total apllied force on piston</span><span class="added-line">+ 		double FaK;             // inertia force</span><span class="added-line">+ 		double Fwk;             // Centrifugal force </span><span class="added-line">+ 		double FDK;            // Pressure force</span><span class="added-line">+ 		</span><span class="added-line">+ 		// inclined</span><span class="added-line">+ 		double FAKy;        	</span><span class="added-line">+ 		double Fwkz;</span><span class="added-line">+ 		double Fwky;</span><span class="added-line">+ 		double FAK_inclined;</span><span class="added-line">+ </span><span class="added-line">+ </span><span class="unchanged-line">  		vector&amp;lt;double&amp;gt; F_external;</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 2 (around line 433)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		vector&amp;lt;double&amp;gt; F_contact;</span><span class="unchanged-line">  		//----------Force Balance----------//</span><span class="unchanged-line">  		vector&amp;lt;double&amp;gt; dF;</span><span class="added-line">+ </span><span class="unchanged-line">  	};</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 3 (around line 482)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	Array&amp;lt;double,1&amp;gt; PistonProlongationBilinearMG(int l_c,Array&amp;lt;double,1&amp;gt; field_c,Array&amp;lt;int,2&amp;gt; FaceId_c2f);</span><span class="unchanged-line">  	void PistonVcycleMG(void);</span><span class="unchanged-line">  	void PistonWcycleMG(void);</span><span class="added-line">+ 	void PistonReynoldsCalcCoefficientsMG(void);</span><span class="unchanged-line">  	void PistonReynoldsMG(void);</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 4 (around line 505)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	void PistonCalcvK(void);</span><span class="unchanged-line">  	//Calculate piston stroke	</span><span class="unchanged-line">  	void PistonCalcsK(void);</span><span class="added-line">+ </span><span class="added-line">+ 	void PistonCalcvK_inclined(void);</span><span class="added-line">+ 	//Calculate piston stroke	</span><span class="added-line">+ 	void PistonCalcsK_inclined(void);</span><span class="unchanged-line">  	//Initialize a 2D pressure vector</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 5 (around line 568)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	void PistonGuessFTG(void);					//Calculate an approximated friction force from the slipper						</span><span class="unchanged-line">  	void PistonReadFTG(void);</span><span class="unchanged-line">  	void PistonCalcExternalForces(void);		//Calculate piston external forces	</span><span class="added-line">+ </span><span class="added-line">+ 	void PistonCalcExternalForces_inclined_piston(void);		//Calculate piston external forces	for inclined piston</span><span class="unchanged-line">  	void PistonCalcdF(vector&amp;lt;double&amp;gt; &amp;dF);		//Calculate piston force balance considering all the forces</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div></div><div class="section"><h3 class="file-title">üìÑ CPistonGapFEM.cpp</h3><p><strong>Status:</strong> üîµ 8 additions and 12 deletions (net reduction of 4 lines)</p><p><strong>Size:</strong> 11,714 ‚Üí 11,489 bytes (-225 bytes)</p><p><strong>Changes:</strong> +8 lines added, -12 lines removed</p><p><strong>Types of Changes:</strong> Functions, Comments, Variable assignments</p><h4>üîß Code Changes (Separated by Type):</h4><h5>üóëÔ∏è Removed Code Sections:</h5><div class="function-container"><div class="function-header">‚ùå Removed Section 1 (around line 16)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  {	</span><span class="unchanged-line">  	int nfK,nnK;//,phioffset;</span><span class="unchanged-line">  	double pref,lKG,lch,lA,lvar,pDC,pCase,scale;//,phi_rad;//,beta,betamax;</span><span class="removed-line">- 	double beta = operatingpistongap.beta_rad;</span><span class="removed-line">- 	double betamax = operatingpistongap.betamax_rad;</span><span class="unchanged-line">  </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 2 (around line 34)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	pref = 100.0e5;</span><span class="unchanged-line">  	pDC = operatingpistongap.pDC;</span><span class="unchanged-line">  	pCase = operatingpistongap.pCase;</span><span class="removed-line">- 	//double psocket = forcespistongap.Fsk/(myinput.data.geometry.aSock);//[Pa]</span><span class="removed-line">- 	double psocket_0 = forcespistongap.Fsk*(1-(beta/betamax))/(myinput.data.geometry.aSock);//[Pa]</span><span class="removed-line">- 	double psocket_1 = forcespistongap.Fsk*(beta/betamax)/(myinput.data.geometry.aSock);</span><span class="unchanged-line">  	//Saturate socket pressure to 2x DC pressure for stability</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 3 (around line 204)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	defK_p += scale * myGapInput.IM_piston(Range((nfK+1)*nnK,(nfK+1)*nnK+nnK-1));</span><span class="unchanged-line">  	pref = 100.0e5;</span><span class="unchanged-line">  </span><span class="removed-line">- 	//Deformation due to socket pressure</span><span class="removed-line">- 	//scale = psocket/pref;</span><span class="unchanged-line">  	//defK_p += scale * myGapInput.IM_piston(Range((nfK+2)*nnK,(nfK+2)*nnK+nnK-1));</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><h5>‚ú® Added Code Sections:</h5><div class="function-container"><div class="function-header">‚úÖ Added Section 1 (around line 16)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  {	</span><span class="unchanged-line">  	int nfK,nnK;//,phioffset;</span><span class="unchanged-line">  	double pref,lKG,lch,lA,lvar,pDC,pCase,scale;//,phi_rad;//,beta,betamax;</span><span class="added-line">+ //	beta = operatingpistongap.beta_rad;</span><span class="added-line">+ //	betamax = operatingpistongap.betamax_rad;</span><span class="unchanged-line">  </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 2 (around line 34)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	pref = 100.0e5;</span><span class="unchanged-line">  	pDC = operatingpistongap.pDC;</span><span class="unchanged-line">  	pCase = operatingpistongap.pCase;</span><span class="added-line">+ 	//double psocket_0 = forcespistongap.Fsk*(1-(beta/betamax))/(myinput.data.geometry.aSock);//[Pa]</span><span class="added-line">+ 	//double psocket_1 = forcespistongap.Fsk*(beta/betamax)/(myinput.data.geometry.aSock);</span><span class="unchanged-line">  	//Saturate socket pressure to 2x DC pressure for stability</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 3 (around line 203)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	defK_p += scale * myGapInput.IM_piston(Range((nfK+1)*nnK,(nfK+1)*nnK+nnK-1));</span><span class="unchanged-line">  	pref = 100.0e5;</span><span class="unchanged-line">  </span><span class="added-line">+ 	//Deformation due to socket_0 pressure</span><span class="added-line">+ 	//scale = psocket_0/pref;</span><span class="unchanged-line">  	//defK_p += scale * myGapInput.IM_piston(Range((nfK+2)*nnK,(nfK+2)*nnK+nnK-1));</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div></div><div class="section"><h3 class="file-title">üìÑ CPistonGapGS.cpp</h3><p><strong>Status:</strong> üîµ 22 additions and 660 deletions (net reduction of 638 lines)</p><p><strong>Size:</strong> 36,039 ‚Üí 17,306 bytes (-18,733 bytes)</p><p><strong>Changes:</strong> +22 lines added, -660 lines removed</p><p><strong>Types of Changes:</strong> Functions, Comments, Control flow</p><h4>üîß Code Changes (Separated by Type):</h4><h5>üóëÔ∏è Removed Code Sections:</h5><div class="function-container"><div class="function-header">‚ùå Removed Section 1 (around line 208)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		fout.clear();</span><span class="unchanged-line">  	}</span><span class="unchanged-line">  </span><span class="removed-line">- 	Averagepressure();</span><span class="removed-line">- </span><span class="unchanged-line">  	//Limit pressure</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 2 (around line 241)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  };</span><span class="unchanged-line">  </span><span class="unchanged-line">  //Calculate Reynolds diffusive coeffcients and source term</span><span class="removed-line">- void CPistonGap::PistonReynoldsCalcCoefficientsGS(double dt)</span><span class="unchanged-line">  {</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 3 (around line 258)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	mu = 0;</span><span class="unchanged-line">  	rho2d.resize(N*M);</span><span class="unchanged-line">  	rho2d = 0;</span><span class="removed-line">- </span><span class="unchanged-line">  	for(int i=0;i&amp;lt;Q;i++)</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 4 (around line 267)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	mu/=Q;</span><span class="unchanged-line">  	rho2d/=Q;</span><span class="unchanged-line">  	//Face diffusivity values</span><span class="removed-line">- 	double mun,mus,mue,muw,hKn,hKs,hKe,hKw,hn,hs,he,hw,hp,dhKx,dhKy,defsqueezeK,defsqueezeB,expansion,rhon,rhos,rhoe,rhow,rhop,hn_old,hs_old,he_old,hw_old;</span><span class="unchanged-line">  	if(numgvlizhi &amp;gt; 0)</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 5 (around line 289)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	b = 0.0;</span><span class="unchanged-line">  	for(int i=0;i&amp;lt;N*M;i++)</span><span class="unchanged-line">  	{</span><span class="removed-line">- </span><span class="removed-line">- 		rhop = rho2d(i);</span><span class="removed-line">- 		mun = mu_n(i);</span><span class="removed-line">- 		rhon = rho_n(i);</span><span class="removed-line">- 		mus = mu_s(i);</span><span class="removed-line">- 		rhos = rho_s(i);</span><span class="removed-line">- 		mue = mu_e(i);</span><span class="removed-line">- 		rhoe = rho_e(i);</span><span class="removed-line">- 		muw = mu_w(i);</span><span class="removed-line">- 		rhow = rho_w(i);</span><span class="removed-line">- 		//hp = h(i);</span><span class="unchanged-line">  		//North</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 6 (around line 386)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		}*/</span><span class="unchanged-line">  </span><span class="unchanged-line">  		//North</span><span class="removed-line">- 		an(i) = rhon*pow(hn,3.0)*dx / (dy*6.0*mun);</span><span class="unchanged-line">  		//Dirichlet boundary</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 7 (around line 395)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		};</span><span class="unchanged-line">  </span><span class="unchanged-line">  		//South</span><span class="removed-line">- 		as(i) = rhos*pow(hs,3.0)*dx / (dy*6.0*mus);</span><span class="unchanged-line">  		//Dirichlet boundary</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 8 (around line 404)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		};</span><span class="unchanged-line">  </span><span class="unchanged-line">  		//East</span><span class="removed-line">- 		ae(i) = rhoe*pow(he,3.0)*dy / (dx*6.0*mue);</span><span class="unchanged-line">  		//West</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 9 (around line 589)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  </span><span class="unchanged-line">  }</span><span class="unchanged-line">  //Solve Energy equation using GS SOR method</span><span class="removed-line">- void CPistonGap::PistonEnergyGS(double dt) </span><span class="unchanged-line">  {</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 10 (around line 642)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	int iter_max = 10000;</span><span class="unchanged-line">  	double R = 1.0;</span><span class="unchanged-line">  	double Tn,Ts,Te,Tw,Tt,Tb;</span><span class="removed-line">- 	double Pn,Ps,Pe,Pw;</span><span class="unchanged-line">  	do</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 11 (around line 658)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  			if(i%M==(M-1) &amp;&amp; i&amp;gt;0)</span><span class="unchanged-line">  			{</span><span class="unchanged-line">  				Tn = TCase;</span><span class="removed-line">- 				Pn = operatingpistongap.pCase;</span><span class="unchanged-line">  			}</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 12 (around line 718)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  			{</span><span class="unchanged-line">  				Tb = Tnew(i-N*M);</span><span class="unchanged-line">  			}</span><span class="removed-line">- 			//bE(i) += ((Pn - Ps)/dy/2 * vy(i) + (Pe - Pw)/dx/2 * vx(i)) * dx * dy * dz2(i);</span><span class="removed-line">- 			//bE(i) += (ploop(i%(N*M)) - ploop_old(i%(N*M))) / dt * dx * dy * dz2(i);</span><span class="removed-line">- </span><span class="unchanged-line">  			//SOR</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 13 (around line 750)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	//Assign temperature</span><span class="unchanged-line">  	T = Tnew;</span><span class="unchanged-line">  </span><span class="removed-line">- 	// generate 2d temperature field Lizhi</span><span class="removed-line">- 	T_2d = 0;</span><span class="removed-line">- 	phiD_2d = 0;</span><span class="removed-line">- 	for(int i=0;i&amp;lt;Q;i++)</span><span class="removed-line">- 	{</span><span class="removed-line">- 		T_2d(Range(0,N*M-1)) += T(Range(i*N*M,(i+1)*N*M-1));</span><span class="removed-line">- 		phiD_2d(Range(0,N*M-1)) += phiD(Range(i*N*M,(i+1)*N*M-1));</span><span class="removed-line">- 	};</span><span class="removed-line">- </span><span class="removed-line">- 	</span><span class="removed-line">- 	T_2d/=Q;</span><span class="removed-line">- 	phiD_2d/=Q;</span><span class="removed-line">- </span><span class="removed-line">- };</span><span class="removed-line">- //Solve Energy equation using the film property on the edge of the fluid grid GS SOR method</span><span class="removed-line">- void CPistonGap::PistonEnergyGSedge(double dt) </span><span class="removed-line">- {</span><span class="removed-line">- 	double cp,alpha,lambda,TDC,TCase,phi,cT;</span><span class="removed-line">- </span><span class="removed-line">- 	//Fluid properties</span><span class="removed-line">- 	lambda = my_oil -&amp;gt; get_lambda();//oilpistongap.oillambda;</span><span class="removed-line">- 	cp = my_oil -&amp;gt; get_C();//oilpistongap.oilC;</span><span class="removed-line">- 	//cT = my_oil -&amp;gt; get_CT();</span><span class="removed-line">- </span><span class="removed-line">- 	//cp = 2.0414e3; cp used when develop</span><span class="removed-line">- </span><span class="removed-line">- 	//Boundaries</span><span class="removed-line">- 	phi = operatingpistongap.phi_rad * 180.0/PI;</span><span class="removed-line">- 	if(phi &amp;lt; 180.0)</span><span class="removed-line">- 	{</span><span class="removed-line">- 		TDC = temperaturepistongap.THP;</span><span class="removed-line">- 	}</span><span class="removed-line">- 	else</span><span class="removed-line">- 	{</span><span class="removed-line">- 		TDC = temperaturepistongap.TLP;</span><span class="removed-line">- 	}</span><span class="removed-line">- 	TCase = temperaturepistongap.TCase;</span><span class="removed-line">- </span><span class="removed-line">- 	//Source term</span><span class="removed-line">- 	//&amp;CPistonGap::Pistonenergydissipation;</span><span class="removed-line">- 	Pistonenergydissipation();//dz is included in phid, so phiD here and below is acturally phiD * dz</span><span class="removed-line">- 	bE = oilviscosity * phiD * dx * dy; // * dz2;</span><span class="removed-line">- 	//bE = oilviscosity * ( pow(dvxz,2.0) + pow(dvyz,2.0) ) * dx * dy * dz2;</span><span class="removed-line">- 	//Diffusive coefficients</span><span class="removed-line">- 	/*Dx = lambda*dy*dz2 / dx;</span><span class="removed-line">- 	Dy = lambda*dx*dz2 / dy;</span><span class="removed-line">- 	Dz = lambda*dx*dy / dz2;</span><span class="removed-line">- 	//Convective coefficients</span><span class="removed-line">- 	Fx = oildensity * cp * vx * dy * dz2;</span><span class="removed-line">- 	Fy = oildensity * cp * vy * dx * dz2;</span><span class="removed-line">- 	//Peclet number</span><span class="removed-line">- 	Px = Fx / Dx;</span><span class="removed-line">- 	Py = Fy / Dy;</span><span class="removed-line">- 	//Power Law Scheme (Patankar Book)</span><span class="removed-line">- 	Ax = pow((1 - 0.1*fabs(Px)),5.0);</span><span class="removed-line">- 	Ax = max(Ax,0.0);</span><span class="removed-line">- 	Ay = pow((1 - 0.1*fabs(Py)),5.0);</span><span class="removed-line">- 	Ay = max(Ay,0.0);</span><span class="removed-line">- 	//Spatial coefficients</span><span class="removed-line">- 	anE = Ay * Dy + max(-1.0 * Fy,0.0); </span><span class="removed-line">-     asE = Ay * Dy + max(Fy,0.0);</span><span class="removed-line">-     aeE = Ax * Dx + max(-1.0 * Fx,0.0); </span><span class="removed-line">-     awE = Ax * Dx + max(Fx,0.0); </span><span class="removed-line">- 	atE = lambda*dx*dy / dz2;</span><span class="removed-line">- 	abE = lambda*dx*dy / dz2;</span><span class="removed-line">- 	apE = anE + asE + aeE + awE + atE + abE;*/</span><span class="removed-line">- </span><span class="removed-line">- 	//coefficents</span><span class="removed-line">- 	for(int q=0;q&amp;lt;Q;q++)</span><span class="removed-line">- 	{</span><span class="removed-line">- 		for(int n=0;n&amp;lt;N;n++)</span><span class="removed-line">- 		{</span><span class="removed-line">- 			for(int m=0;m&amp;lt;M;m++)</span><span class="removed-line">- 			{</span><span class="removed-line">- 				double rho_n = 0;</span><span class="removed-line">- 				double rho_s = 0;</span><span class="removed-line">- 				double rho_e = 0;</span><span class="removed-line">- 				double rho_w = 0;</span><span class="removed-line">- 				double z_n = 0;</span><span class="removed-line">- 				double z_s = 0;</span><span class="removed-line">- 				double z_e = 0;</span><span class="removed-line">- 				double z_w = 0;</span><span class="removed-line">- 				double v_n = 0;</span><span class="removed-line">- 				double v_s = 0;</span><span class="removed-line">- 				double v_e = 0;</span><span class="removed-line">- 				double v_w = 0;</span><span class="removed-line">- 				double D_n, D_s, D_e, D_w, F_n, F_s, F_e, F_w, A_n, A_s, A_e, A_w;</span><span class="removed-line">- 				double p_n, p_s, p_e, p_w;</span><span class="removed-line">- 				int i_3d = M*N*q + M*n + m;</span><span class="removed-line">- 				int i_2d = M*n + m;</span><span class="removed-line">- 				v_s = vy_edge(i_3d);</span><span class="removed-line">- 				v_w = vx_edge(i_3d);</span><span class="removed-line">- 				if(m==0)//south bound</span><span class="removed-line">- 				{</span><span class="removed-line">- 					rho_s = oildensity(i_3d);</span><span class="removed-line">- 					z_s = dz2(i_3d);</span><span class="removed-line">- 					p_s = operatingpistongap.pDC;</span><span class="removed-line">- 				}</span><span class="removed-line">- 				else</span><span class="removed-line">- 				{</span><span class="removed-line">- 					rho_s = (oildensity(i_3d) + oildensity(i_3d - 1)) / 2;</span><span class="removed-line">- 					z_s = (dz2(i_3d) + dz2(i_3d - 1)) / 2;</span><span class="removed-line">- 					p_s = (pnew(i_2d) + pnew(i_2d - 1)) / 2;</span><span class="removed-line">- 				}</span><span class="removed-line">- 				if(m==M-1)//north bound</span><span class="removed-line">- 				{</span><span class="removed-line">- 					rho_n = oildensity(i_3d);</span><span class="removed-line">- 					z_n = dz2(i_3d);</span><span class="removed-line">- 					v_n = vy_edge_case(i_3d);</span><span class="removed-line">- 					p_n = operatingpistongap.pCase;</span><span class="removed-line">- 				}</span><span class="removed-line">- 				else</span><span class="removed-line">- 				{</span><span class="removed-line">- 					rho_n = (oildensity(i_3d) + oildensity(i_3d + 1)) / 2;</span><span class="removed-line">- 					z_n = (dz2(i_3d) + dz2(i_3d + 1)) / 2;</span><span class="removed-line">- 					v_n = vy_edge(i_3d + 1);</span><span class="removed-line">- 					p_n = (pnew(i_2d) + pnew(i_2d + 1)) / 2;</span><span class="removed-line">- 				}</span><span class="removed-line">- 				if(n==0)//west bound</span><span class="removed-line">- 				{</span><span class="removed-line">- 					rho_w = (oildensity(i_3d) + oildensity(i_3d + (N-1)*M)) / 2;</span><span class="removed-line">- 					z_w = (dz2(i_3d) + dz2(i_3d + (N-1)*M)) / 2;</span><span class="removed-line">- 					p_w = (pnew(i_2d) + pnew(i_2d + (N-1)*M)) / 2;</span><span class="removed-line">- 				}</span><span class="removed-line">- 				else</span><span class="removed-line">- 				{</span><span class="removed-line">- 					rho_w = (oildensity(i_3d) + oildensity(i_3d - M)) / 2;</span><span class="removed-line">- 					z_w = (dz2(i_3d) + dz2(i_3d - M)) / 2;</span><span class="removed-line">- 					p_w = (pnew(i_2d) + pnew(i_2d - M)) / 2;</span><span class="removed-line">- 				}</span><span class="removed-line">- 				if(n==N-1)//east bound</span><span class="removed-line">- 				{</span><span class="removed-line">- 					rho_e = (oildensity(i_3d) + oildensity(i_3d - (N-1)*M)) / 2;</span><span class="removed-line">- 					z_e = (dz2(i_3d) + dz2(i_3d - (N-1)*M)) / 2;</span><span class="removed-line">- 					v_e = vx_edge(i_3d - (N-1)*M);</span><span class="removed-line">- 					p_e = (pnew(i_2d) + pnew(i_2d - (N-1)*M)) / 2;</span><span class="removed-line">- 				}</span><span class="removed-line">- 				else</span><span class="removed-line">- 				{</span><span class="removed-line">- 					rho_e = (oildensity(i_3d) + oildensity(i_3d + M)) / 2;</span><span class="removed-line">- 					z_e = (dz2(i_3d) + dz2(i_3d + M)) / 2;</span><span class="removed-line">- 					v_e = vx_edge(i_3d + M);</span><span class="removed-line">- 					p_e = (pnew(i_2d) + pnew(i_2d + M)) / 2;</span><span class="removed-line">- 				}</span><span class="removed-line">- </span><span class="removed-line">- 				double dz_mean;</span><span class="removed-line">- 				dz_mean = (z_e + z_w + z_n + z_s) / 4;</span><span class="removed-line">- </span><span class="removed-line">- 				</span><span class="removed-line">- 				double dmdt;</span><span class="removed-line">- 				//dmdt = dht_total(i_2d) / Q * dx *dy * oildensity(i_3d);</span><span class="removed-line">- 				dmdt = rho_e * v_e * dy * z_e </span><span class="removed-line">- 					- rho_w * v_w * dy * z_w </span><span class="removed-line">- 					+ rho_n * v_n * dx * z_n </span><span class="removed-line">- 					- rho_s * v_s * dx * z_s;</span><span class="removed-line">- </span><span class="removed-line">- 				//when pressure is lower than 0.1bar, the mass conservation is not fulfilled in Reynolds. Fix dmdt = 0 at p&amp;lt;0.1bar</span><span class="removed-line">- 				if(p_e &amp;lt; 1e4 || p_w &amp;lt; 1e4 || p_n &amp;lt; 1e4 || p_s &amp;lt; 1e4 || pnew(i_2d) &amp;lt; 1e4 || ploop(i_2d) &amp;lt; 1e4 || ploop_old(i_2d) &amp;lt; 1e4)</span><span class="removed-line">- 				{</span><span class="removed-line">- 					</span><span class="removed-line">- 					double temp;</span><span class="removed-line">- </span><span class="removed-line">- 					temp = (v_e * z_e * rho_e + v_w * z_w * rho_w) / 2;</span><span class="removed-line">- 					v_e = temp / z_e / rho_e; v_w = temp / z_w / rho_w;</span><span class="removed-line">- 					temp = (v_n * z_n * rho_n + v_s * z_s * rho_s) / 2;</span><span class="removed-line">- 					v_n = temp / z_n / rho_n; v_s = temp / z_s / rho_s;</span><span class="removed-line">- </span><span class="removed-line">- 					dmdt = 0;</span><span class="removed-line">- 	</span><span class="removed-line">- 				}</span><span class="removed-line">- </span><span class="removed-line">- 				//double temp;</span><span class="removed-line">- </span><span class="removed-line">- 				//temp = (v_e * z_e + v_w * z_w) / 2;</span><span class="removed-line">- 				//v_e = temp / z_e; v_w = temp / z_w;</span><span class="removed-line">- 				//temp = (v_n * z_n + v_s * z_s) / 2;</span><span class="removed-line">- 				//v_n = temp / z_n; v_s = temp / z_s;</span><span class="removed-line">- </span><span class="removed-line">- 				//rho_e = oildensity(i_3d);</span><span class="removed-line">- 				//rho_w = oildensity(i_3d);</span><span class="removed-line">- 				//rho_n = oildensity(i_3d);</span><span class="removed-line">- 				//rho_s = oildensity(i_3d);</span><span class="removed-line">- </span><span class="removed-line">- </span><span class="removed-line">- 				//convection</span><span class="removed-line">- 				F_e = rho_e * cp * v_e * dy * z_e;</span><span class="removed-line">- 				F_w = rho_w * cp * v_w * dy * z_w;</span><span class="removed-line">- 				F_n = rho_n * cp * v_n * dx * z_n;</span><span class="removed-line">- 				F_s = rho_s * cp * v_s * dx * z_s;</span><span class="removed-line">- 				//conduction</span><span class="removed-line">- 				D_e = lambda * dy * z_e / dx;</span><span class="removed-line">- 				D_w = lambda * dy * z_w / dx;</span><span class="removed-line">- 				D_n = lambda * dx * z_n / dy;</span><span class="removed-line">- 				D_s = lambda * dx * z_s / dy;</span><span class="removed-line">- 				//Power Law Scheme (Patankar Book)</span><span class="removed-line">- 				A_e = max(0.0,pow((1-0.1*fabs(F_e/D_e)),5));</span><span class="removed-line">- 				A_w = max(0.0,pow((1-0.1*fabs(F_w/D_w)),5));</span><span class="removed-line">- 				A_n = max(0.0,pow((1-0.1*fabs(F_n/D_n)),5));</span><span class="removed-line">- 				A_s = max(0.0,pow((1-0.1*fabs(F_s/D_s)),5));</span><span class="removed-line">- 				//Spatial coefficients at w e n s</span><span class="removed-line">- 				aeE(i_3d) = D_e * A_e + max(0.0,-1*F_e);</span><span class="removed-line">- 				awE(i_3d) = D_w * A_w + max(0.0,F_w);</span><span class="removed-line">- 				anE(i_3d) = D_n * A_n + max(0.0,-1*F_n);</span><span class="removed-line">- 				asE(i_3d) = D_s * A_s + max(0.0,F_s);</span><span class="removed-line">- 				cT = 9.0447e-4; // temporarily hard coded ReneChacon 11/21/17</span><span class="removed-line">- </span><span class="removed-line">- 				//double h_0 = 3.6159e5; was not used in this version</span><span class="removed-line">- 				double specific_v = 1 / oildensity(i_3d);</span><span class="removed-line">- 				//enthalpy change due to convection on the cell wall (pressure only, temperature is already considered)</span><span class="removed-line">- 				bE(i_3d) -= rho_e * cT * v_e * dy * z_e * p_e;</span><span class="removed-line">- 				bE(i_3d) -= -1 * rho_w * cT * v_w * dy * z_w * p_w;</span><span class="removed-line">- 				bE(i_3d) -= rho_n * cT * v_n * dx * z_n * p_n;</span><span class="removed-line">- 				bE(i_3d) -= -1 * rho_s * cT * v_s * dx * z_s * p_s;</span><span class="removed-line">- 				//enthalpy change due to flow through pressure gradient</span><span class="removed-line">- 				bE(i_3d) -= rho_e * v_e * dy * z_e * (pnew(i_2d) - p_e) * specific_v;</span><span class="removed-line">- 				bE(i_3d) -= -1 * rho_w * v_w * dy * z_w * (pnew(i_2d) - p_w) * specific_v;</span><span class="removed-line">- 				bE(i_3d) -= rho_n * v_n * dx * z_n * (pnew(i_2d) - p_n) * specific_v;</span><span class="removed-line">- 				bE(i_3d) -= -1 * rho_s * v_s * dx * z_s * (pnew(i_2d) - p_s) * specific_v;</span><span class="removed-line">- 				//Spatial coefficients at t and b</span><span class="removed-line">- 				atE(i_3d) = lambda*dx*dy / dz_mean;</span><span class="removed-line">- 				abE(i_3d) = lambda*dx*dy / dz_mean;</span><span class="removed-line">- 				// 1/2 of the conduction on top and bottom layer of the fluid considered since the solid surface temperature is considered, which is not located at the center of the neighbor but the wall</span><span class="removed-line">- 				if(q==(Q-1))</span><span class="removed-line">- 				{</span><span class="removed-line">- 					atE(i_3d) *= 2;</span><span class="removed-line">- 				}</span><span class="removed-line">- </span><span class="removed-line">- 				if(q==0)</span><span class="removed-line">- 				{</span><span class="removed-line">- 					abE(i_3d) *= 2;</span><span class="removed-line">- 				}</span><span class="removed-line">- 				// enthalpy change due to compression and expansion from previous time step to current</span><span class="removed-line">- 				bE(i_3d) += ((dx * dy * dz_mean) * oildensity(i_3d) + dmdt * dt) * specific_v * (ploop(i_2d) - ploop_old(i_2d)) / dt;</span><span class="removed-line">- 				// total presure related enthalpy at current time step</span><span class="removed-line">- 				bE(i_3d) -= ((dx * dy * dz_mean) * oildensity(i_3d) + dmdt * dt) * (cT * ploop(i_2d)) / dt;</span><span class="removed-line">- 				// total enthalpy at previuos time step</span><span class="removed-line">- 				bE(i_3d) += ((dx * dy * dz_mean) * oildensity(i_3d) + dmdt * dt) * (cp * T_old(i_3d) + cT * ploop_old(i_2d)) / dt;</span><span class="removed-line">- 				// total temperture related enthalpy at current time step divided by current temperature</span><span class="removed-line">- 				double sp = -1 * ( dx * dy * dz_mean * oildensity(i_3d) * cp / dt);</span><span class="removed-line">- 				// Spatial coefficients at cell</span><span class="removed-line">- 				apE(i_3d) = anE(i_3d) + asE(i_3d) + aeE(i_3d) + awE(i_3d) + atE(i_3d) + abE(i_3d) - sp + (F_e - F_w + F_n - F_s);</span><span class="removed-line">- 			}</span><span class="removed-line">- 		}</span><span class="removed-line">- 	}</span><span class="removed-line">- 	</span><span class="removed-line">- 	//SOR Loop</span><span class="removed-line">- 	Tnew = T;</span><span class="removed-line">- 	alpha = 1.3;</span><span class="removed-line">- 	int iterations = 0;</span><span class="removed-line">- 	int iter_max = 10000;</span><span class="removed-line">- 	double R = 1.0;</span><span class="removed-line">- 	double Tn,Ts,Te,Tw,Tt,Tb;</span><span class="removed-line">- 	do</span><span class="removed-line">- 	{</span><span class="removed-line">- </span><span class="removed-line">- 		int q=0;</span><span class="removed-line">- 		//SOR</span><span class="removed-line">- 		for(int i=0;i&amp;lt;N*M*Q;i++)</span><span class="removed-line">- 		{</span><span class="removed-line">- 			if(i%(N*M)==0)</span><span class="removed-line">- 			{</span><span class="removed-line">- 				q++;</span><span class="removed-line">- 			}</span><span class="removed-line">- 			//North</span><span class="removed-line">- 			if(i%M==(M-1) &amp;&amp; i&amp;gt;0)</span><span class="removed-line">- 			{</span><span class="removed-line">- 				Tn = TCase;</span><span class="removed-line">- 			}</span><span class="removed-line">- 			else</span><span class="removed-line">- 			{</span><span class="removed-line">- 				Tn = Tnew(i+1);</span><span class="removed-line">- 			}</span><span class="removed-line">- 			//South</span><span class="removed-line">- 			if(i%M==0)</span><span class="removed-line">- 			{</span><span class="removed-line">- 				Ts = TDC;</span><span class="removed-line">- 			}</span><span class="removed-line">- 			else</span><span class="removed-line">- 			{</span><span class="removed-line">- 				Ts = Tnew(i-1);</span><span class="removed-line">- 			}</span><span class="removed-line">- </span><span class="removed-line">- 			//East</span><span class="removed-line">- 			if(i&amp;gt;=q*(N-1)*M)</span><span class="removed-line">- 			{</span><span class="removed-line">- 				Te = Tnew(i-(N-1)*M);</span><span class="removed-line">- 			}</span><span class="removed-line">- 			else</span><span class="removed-line">- 			{</span><span class="removed-line">- 				Te = Tnew(i+M);</span><span class="removed-line">- 			}</span><span class="removed-line">- 			//West</span><span class="removed-line">- 			if(i&amp;lt;M+(q-1)*N*M)</span><span class="removed-line">- 			{</span><span class="removed-line">- 				Tw = Tnew(i+(N-1)*M);</span><span class="removed-line">- 			}</span><span class="removed-line">- 			else</span><span class="removed-line">- 			{</span><span class="removed-line">- 				Tw = Tnew(i-M);</span><span class="removed-line">- 			}</span><span class="removed-line">- </span><span class="removed-line">- 			//Top</span><span class="removed-line">- 			if(i&amp;gt;=N*M*(Q-1))</span><span class="removed-line">- 			{</span><span class="removed-line">- 				Tt = TK_surf_gap(i-N*M*(Q-1));</span><span class="removed-line">- 			}</span><span class="removed-line">- 			else</span><span class="removed-line">- 			{</span><span class="removed-line">- 				Tt = Tnew(i+N*M);</span><span class="removed-line">- 			}</span><span class="removed-line">- 			//Bottom</span><span class="removed-line">- 			if(i&amp;lt;N*M)</span><span class="removed-line">- 			{</span><span class="removed-line">- 				Tb = TB_surf_gap(i);</span><span class="removed-line">- 			}</span><span class="removed-line">- 			else</span><span class="removed-line">- 			{</span><span class="removed-line">- 				Tb = Tnew(i-N*M);</span><span class="removed-line">- 			}</span><span class="removed-line">- 			//bE(i) += ((Pn - Ps)/dy/2 * vy(i) + (Pe - Pw)/dx/2 * vx(i)) * dx * dy * dz2(i);</span><span class="removed-line">- 			//bE(i) += (ploop(i%(N*M)) - ploop_old(i%(N*M))) / dt * dx * dy * dz2(i);</span><span class="removed-line">- </span><span class="removed-line">- 			//SOR</span><span class="removed-line">- 			Tnew(i) += alpha * ( ( ( anE(i) * Tn + asE(i) * Ts + aeE(i) * Te + awE(i) * Tw + atE(i) * Tt + abE(i) * Tb + bE(i) ) / apE(i) ) - Tnew(i) );</span><span class="removed-line">- 			//cout&amp;lt;&amp;lt;"bE("&amp;lt;&amp;lt;i&amp;lt;&amp;lt;") "&amp;lt;&amp;lt;bE(i)&amp;lt;&amp;lt;"   Tnew("&amp;lt;&amp;lt;i&amp;lt;&amp;lt;") "&amp;lt;&amp;lt;Tnew(i)&amp;lt;&amp;lt;"\n";</span><span class="removed-line">- 		};</span><span class="removed-line">- </span><span class="removed-line">- 		//Counter</span><span class="removed-line">- 		iterations++;</span><span class="removed-line">- </span><span class="removed-line">- 		//Residual GS</span><span class="removed-line">- 		PistonEnergyCalcResidualGS(R);</span><span class="removed-line">- </span><span class="removed-line">- 	}while(R &amp;gt; Rmin_E &amp;&amp; iterations &amp;lt; iter_max);</span><span class="removed-line">- </span><span class="removed-line">- </span><span class="removed-line">- 	//Log</span><span class="removed-line">- 	if(iterations&amp;gt;=iter_max)</span><span class="removed-line">- 	{</span><span class="removed-line">- 		fout.open("./output/piston/matlab/PistonGapLoopLog.txt",ios::app);</span><span class="removed-line">- 		fout &amp;lt;&amp;lt; "Max Number of Iterations Reached in Energy Equation Loop" &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 		fout &amp;lt;&amp;lt; "Shaft Angle: " &amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; operatingpistongap.phi_rad*180/PI &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 		fout &amp;lt;&amp;lt; "Residual: " &amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; R &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 		fout &amp;lt;&amp;lt; " " &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 		fout.close();</span><span class="removed-line">- 		fout.clear();</span><span class="removed-line">- 	};</span><span class="removed-line">- </span><span class="removed-line">- 	//Assign temperature</span><span class="removed-line">- 	T = Tnew;</span><span class="removed-line">- </span><span class="removed-line">- 	// generate 2d temperature field Lizhi</span><span class="removed-line">- 	T_2d = 0;</span><span class="removed-line">- 	phiD_2d = 0;</span><span class="removed-line">- 	for(int i=0;i&amp;lt;Q;i++)</span><span class="removed-line">- 	{</span><span class="removed-line">- 		T_2d(Range(0,N*M-1)) += T(Range(i*N*M,(i+1)*N*M-1));</span><span class="removed-line">- 		phiD_2d(Range(0,N*M-1)) += phiD(Range(i*N*M,(i+1)*N*M-1));</span><span class="removed-line">- 	};</span><span class="removed-line">- </span><span class="removed-line">- 	</span><span class="removed-line">- 	T_2d/=Q;</span><span class="removed-line">- 	phiD_2d/=Q;</span><span class="unchanged-line">  };</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 14 (around line 1209)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	R = n/d;</span><span class="unchanged-line">  </span><span class="unchanged-line">  };</span><span class="removed-line">- </span><span class="removed-line">- </span><span class="removed-line">- void CPistonGap::Averagepressure(void)</span><span class="removed-line">- {	</span><span class="removed-line">- 	double pDC;</span><span class="removed-line">- 	pDC = operatingpistongap.pDC;</span><span class="removed-line">- 	double pCase;</span><span class="removed-line">- 	pCase = operatingpistongap.pCase;</span><span class="removed-line">- 	double pn, ps, pw, pe;</span><span class="removed-line">- 	for(int n=0;n&amp;lt;N;n++)</span><span class="removed-line">- 	{</span><span class="removed-line">- 		for(int m=0;m&amp;lt;M;m++)</span><span class="removed-line">- 		{</span><span class="removed-line">- 			int i_2d = M*n + m;</span><span class="removed-line">- 			if(m == M-1)</span><span class="removed-line">- 			{</span><span class="removed-line">- 				pn = (pCase - pnew(i_2d)) * 2 + pnew(i_2d);</span><span class="removed-line">- 			}</span><span class="removed-line">- 			else</span><span class="removed-line">- 			{</span><span class="removed-line">- 				pn = pnew(i_2d+1);</span><span class="removed-line">- 			}</span><span class="removed-line">- 			if(m == 0)</span><span class="removed-line">- 			{</span><span class="removed-line">- 				ps = (pDC - pnew(i_2d)) * 2 + pnew(i_2d);;</span><span class="removed-line">- 			}</span><span class="removed-line">- 			else</span><span class="removed-line">- 			{</span><span class="removed-line">- 				ps = pnew(i_2d-1);</span><span class="removed-line">- 			}</span><span class="removed-line">- 			if(n == N-1)</span><span class="removed-line">- 			{</span><span class="removed-line">- 				pe = pnew(i_2d-(N-1)*M);</span><span class="removed-line">- 			}</span><span class="removed-line">- 			else</span><span class="removed-line">- 			{</span><span class="removed-line">- 				pe = pnew(i_2d+M);</span><span class="removed-line">- 			}</span><span class="removed-line">- 			if(n == 0)</span><span class="removed-line">- 			{</span><span class="removed-line">- 				pw = pnew(i_2d+(N-1)*M);</span><span class="removed-line">- 			}</span><span class="removed-line">- 			else</span><span class="removed-line">- 			{</span><span class="removed-line">- 				pw = pnew(i_2d-M);</span><span class="removed-line">- 			}</span><span class="removed-line">- 			p(i_2d) = pnew(i_2d);</span><span class="removed-line">- 			p(i_2d) += (pn - pnew(i_2d)) / 8;</span><span class="removed-line">- 			p(i_2d) += (ps - pnew(i_2d)) / 8;</span><span class="removed-line">- 			p(i_2d) += (pe - pnew(i_2d)) / 8;</span><span class="removed-line">- 			p(i_2d) += (pw - pnew(i_2d)) / 8;</span><span class="removed-line">- 			if (p(i_2d) &amp;gt; 1.0e9)</span><span class="removed-line">- 				p(i_2d) = 1.0e9;</span><span class="removed-line">- </span><span class="removed-line">- 		}</span><span class="removed-line">- 	}</span><span class="removed-line">- }</span><span class="removed-line">- </span><span class="removed-line">- </span><span class="removed-line">- void CPistonGap::Pistonenergydissipation(void)</span><span class="removed-line">- {</span><span class="removed-line">- 	double vK = operatingpistongap.vK;				</span><span class="removed-line">- 	double omega = operatingpistongap.omega;		</span><span class="removed-line">- 	double speedK = operatingpistongap.speedK;</span><span class="removed-line">- 	phiD = 0;</span><span class="removed-line">- 	for(int q=0;q&amp;lt;Q;q++)</span><span class="removed-line">- 	{</span><span class="removed-line">- 		for(int n=0;n&amp;lt;N;n++)</span><span class="removed-line">- 		{</span><span class="removed-line">- 			for(int m=0;m&amp;lt;M;m++)</span><span class="removed-line">- 			{</span><span class="removed-line">- 				double dvz_e = 0;</span><span class="removed-line">- 				double dvz_w = 0;</span><span class="removed-line">- 				double dvz_n = 0;</span><span class="removed-line">- 				double dvz_s = 0;</span><span class="removed-line">- 				double dz_e = 0;</span><span class="removed-line">- 				double dz_w = 0;</span><span class="removed-line">- 				double dz_n = 0;</span><span class="removed-line">- 				double dz_s = 0;</span><span class="removed-line">- 				int i_3d = M*N*q + M*n + m;</span><span class="removed-line">- 				if(m==0)//south bound</span><span class="removed-line">- 				{</span><span class="removed-line">- 					dz_s = dz2(i_3d);</span><span class="removed-line">- 				}</span><span class="removed-line">- 				else</span><span class="removed-line">- 				{</span><span class="removed-line">- 					dz_s = (dz2(i_3d) + dz2(i_3d-1)) / 2;</span><span class="removed-line">- 				}</span><span class="removed-line">- 				if(m==M-1)//north bound</span><span class="removed-line">- 				{</span><span class="removed-line">- 					dz_n = dz2(i_3d);</span><span class="removed-line">- 				}</span><span class="removed-line">- 				else</span><span class="removed-line">- 				{</span><span class="removed-line">- 					dz_n = (dz2(i_3d) + dz2(i_3d+1)) / 2;</span><span class="removed-line">- 				}</span><span class="removed-line">- 				if(n==0)</span><span class="removed-line">- 				{</span><span class="removed-line">- 					dz_w = (dz2(i_3d) + dz2(i_3d + (N-1)*M)) / 2;</span><span class="removed-line">- 				}</span><span class="removed-line">- 				else</span><span class="removed-line">- 				{</span><span class="removed-line">- 					dz_w = (dz2(i_3d) + dz2(i_3d - M)) / 2;</span><span class="removed-line">- 				}</span><span class="removed-line">- 				if(n==N-1)//east bound</span><span class="removed-line">- 				{</span><span class="removed-line">- 					dz_e = (dz2(i_3d) + dz2(i_3d - (N-1)*M)) / 2;</span><span class="removed-line">- 				}</span><span class="removed-line">- 				else</span><span class="removed-line">- 				{</span><span class="removed-line">- 					dz_e = (dz2(i_3d) + dz2(i_3d + M)) / 2;</span><span class="removed-line">- 				}</span><span class="removed-line">- 				if(q==0)</span><span class="removed-line">- 				{</span><span class="removed-line">- 					int i_3d_up = M*N*(q+1) + M*n + m;</span><span class="removed-line">- 					dvz_s = (vy_edge(i_3d_up) - 0.0) / dz_s / 1.5;</span><span class="removed-line">- 					dvz_w = (vx_edge(i_3d_up) - 0.0) / dz_w / 1.5;</span><span class="removed-line">- 					if(m==M-1)//north bound</span><span class="removed-line">- 					{</span><span class="removed-line">- 						dvz_n = (vy_edge_case(i_3d_up) - 0.0) / dz_n / 1.5;</span><span class="removed-line">- 					}</span><span class="removed-line">- 					else</span><span class="removed-line">- 					{</span><span class="removed-line">- 						dvz_n = (vy_edge(i_3d_up + 1) - 0.0) / dz_n / 1.5;</span><span class="removed-line">- 					}</span><span class="removed-line">- 					if(n==N-1)//east bound</span><span class="removed-line">- 					{</span><span class="removed-line">- 						dvz_e = (vx_edge(i_3d_up - (N-1)*M) - 0.0) / dz_e / 1.5;</span><span class="removed-line">- 					}</span><span class="removed-line">- 					else</span><span class="removed-line">- 					{</span><span class="removed-line">- 						dvz_e = (vx_edge(i_3d_up + M) - 0.0) / dz_e / 1.5;</span><span class="removed-line">- 					}</span><span class="removed-line">- 				}</span><span class="removed-line">- 				else if(q==Q-1)</span><span class="removed-line">- 				{</span><span class="removed-line">- 					int i_3d_down = M*N*(q-1) + M*n + m;</span><span class="removed-line">- 					double vx_up = omega * rK * speedK;</span><span class="removed-line">- 					double vy_up = vK;</span><span class="removed-line">- 					dvz_s = (vy_up - vy_edge(i_3d_down)) / dz_s / 1.5;</span><span class="removed-line">- 					dvz_w = (vx_up - vx_edge(i_3d_down)) / dz_w / 1.5;</span><span class="removed-line">- 					if(m==M-1)//north bound</span><span class="removed-line">- 					{</span><span class="removed-line">- 						dvz_n = (vy_up - vy_edge_case(i_3d_down)) / dz_n / 1.5;</span><span class="removed-line">- 					}</span><span class="removed-line">- 					else</span><span class="removed-line">- 					{</span><span class="removed-line">- 						dvz_n = (vy_up - vy_edge(i_3d_down + 1)) / dz_n / 1.5;</span><span class="removed-line">- 					}</span><span class="removed-line">- 					if(n==N-1)//east bound</span><span class="removed-line">- 					{</span><span class="removed-line">- 						dvz_e = (vx_up - vx_edge(i_3d_down - (N-1)*M)) / dz_e / 1.5;</span><span class="removed-line">- 					}</span><span class="removed-line">- 					else</span><span class="removed-line">- 					{</span><span class="removed-line">- 						dvz_e = (vx_up - vx_edge(i_3d_down + M)) / dz_e / 1.5;</span><span class="removed-line">- 					}</span><span class="removed-line">- 					/*</span><span class="removed-line">- 					if(m==0)//south bound</span><span class="removed-line">- 					{</span><span class="removed-line">- 						dvz_s = (vy_up - vy_edge(i_3d_down)) / dz2(i_3d) / 1.5;</span><span class="removed-line">- 					}</span><span class="removed-line">- 					else</span><span class="removed-line">- 					{</span><span class="removed-line">- 						dvz_s = (vy_up - vy_edge(i_3d_down)) / (dz2(i_3d) + dz2(i_3d-1))*2 / 1.5;</span><span class="removed-line">- 					}</span><span class="removed-line">- 					if(m==M-1)//north bound</span><span class="removed-line">- 					{</span><span class="removed-line">- 						dvz_n = (vy_up - vy_edge_case(i_3d_down)) / dz2(i_3d) / 1.5;</span><span class="removed-line">- 					}</span><span class="removed-line">- 					else</span><span class="removed-line">- 					{</span><span class="removed-line">- 						dvz_n = (vy_up - vy_edge(i_3d_down + 1)) / (dz2(i_3d) + dz2(i_3d+1))*2 / 1.5;</span><span class="removed-line">- 					}</span><span class="removed-line">- 					if(n==0)</span><span class="removed-line">- 					{</span><span class="removed-line">- 						dvz_w = (vx_up - vx_edge(i_3d_down)) / (dz2(i_3d) + dz2(i_3d + (N-1)*M))*2 / 1.5;</span><span class="removed-line">- 					}</span><span class="removed-line">- 					else</span><span class="removed-line">- 					{</span><span class="removed-line">- 						dvz_w = (vx_up - vx_edge(i_3d_down)) / (dz2(i_3d) + dz2(i_3d - M))*2 / 1.5;</span><span class="removed-line">- 					}</span><span class="removed-line">- 					if(n==N-1)//east bound</span><span class="removed-line">- 					{</span><span class="removed-line">- 						dvz_e = (vx_up - vx_edge(i_3d_down - (N-1)*M)) / (dz2(i_3d) + dz2(i_3d - (N-1)*M))*2 / 1.5;</span><span class="removed-line">- 					}</span><span class="removed-line">- 					else</span><span class="removed-line">- 					{</span><span class="removed-line">- 						dvz_e = (vx_up - vx_edge(i_3d_down + M)) / (dz2(i_3d) + dz2(i_3d + M))*2 / 1.5;</span><span class="removed-line">- 					}*/</span><span class="removed-line">- 				}</span><span class="removed-line">- 				else</span><span class="removed-line">- 				{</span><span class="removed-line">- 					int i_3d_up = M*N*(q+1) + M*n + m;</span><span class="removed-line">- 					int i_3d_down = M*N*(q-1) + M*n + m;</span><span class="removed-line">- 					dvz_s = (vy_edge(i_3d_up) - vy_edge(i_3d_down)) / dz_s / 2;</span><span class="removed-line">- 					dvz_w = (vx_edge(i_3d_up) - vx_edge(i_3d_down)) / dz_w / 2;</span><span class="removed-line">- 					if(m==M-1)//north bound</span><span class="removed-line">- 					{</span><span class="removed-line">- 						dvz_n = (vy_edge_case(i_3d_up) - vy_edge_case(i_3d_down)) / dz_n / 2;</span><span class="removed-line">- 					}</span><span class="removed-line">- 					else</span><span class="removed-line">- 					{</span><span class="removed-line">- 						dvz_n = (vy_edge(i_3d_up + 1) - vy_edge(i_3d_down + 1)) / dz_n / 2;</span><span class="removed-line">- 					}</span><span class="removed-line">- 					if(n==N-1)//east bound</span><span class="removed-line">- 					{</span><span class="removed-line">- 						dvz_e = (vx_edge(i_3d_up - (N-1)*M) - vx_edge(i_3d_down - (N-1)*M)) / dz_e / 2;</span><span class="removed-line">- 					}</span><span class="removed-line">- 					else</span><span class="removed-line">- 					{</span><span class="removed-line">- 						dvz_e = (vx_edge(i_3d_up + M) - vx_edge(i_3d_down + M)) / dz_e / 2;</span><span class="removed-line">- 					}</span><span class="removed-line">- 					/*</span><span class="removed-line">- 					if(m==0)//south bound</span><span class="removed-line">- 					{</span><span class="removed-line">- 						dvz_s = (vy_edge(i_3d_up) - vy_edge(i_3d_down)) / dz2(i_3d) / 2;</span><span class="removed-line">- 					}</span><span class="removed-line">- 					else</span><span class="removed-line">- 					{</span><span class="removed-line">- 						dvz_s = (vy_edge(i_3d_up) - vy_edge(i_3d_down)) / (dz2(i_3d) + dz2(i_3d-1))*2 / 2;</span><span class="removed-line">- 					}</span><span class="removed-line">- 					if(m==M-1)//north bound</span><span class="removed-line">- 					{</span><span class="removed-line">- 						dvz_n = (vy_edge_case(i_3d_up) - vy_edge_case(i_3d_down)) / dz2(i_3d) / 2;</span><span class="removed-line">- 					}</span><span class="removed-line">- 					else</span><span class="removed-line">- 					{</span><span class="removed-line">- 						dvz_n = (vy_edge(i_3d_up + 1) - vy_edge(i_3d_down + 1)) / (dz2(i_3d) + dz2(i_3d+1))*2 / 2;</span><span class="removed-line">- 					}</span><span class="removed-line">- 					if(n==0)</span><span class="removed-line">- 					{</span><span class="removed-line">- 						dvz_w = (vx_edge(i_3d_up) - vx_edge(i_3d_down)) / (dz2(i_3d) + dz2(i_3d + (N-1)*M))*2 / 2;</span><span class="removed-line">- 					}</span><span class="removed-line">- 					else</span><span class="removed-line">- 					{</span><span class="removed-line">- 						dvz_w = (vx_edge(i_3d_up) - vx_edge(i_3d_down)) / (dz2(i_3d) + dz2(i_3d - M))*2 / 2;</span><span class="removed-line">- 					}</span><span class="removed-line">- 					if(n==N-1)//east bound</span><span class="removed-line">- 					{</span><span class="removed-line">- 						dvz_e = (vx_edge(i_3d_up - (N-1)*M) - vx_edge(i_3d_down - (N-1)*M)) / (dz2(i_3d) + dz2(i_3d - (N-1)*M))*2 / 2;</span><span class="removed-line">- 					}</span><span class="removed-line">- 					else</span><span class="removed-line">- 					{</span><span class="removed-line">- 						dvz_e = (vx_edge(i_3d_up + M) - vx_edge(i_3d_down + M)) / (dz2(i_3d) + dz2(i_3d + M))*2 / 2;</span><span class="removed-line">- 					}*/</span><span class="removed-line">- 				}</span><span class="removed-line">- 				phiD(i_3d) += (dvz_e - dvz_w) * (dvz_e - dvz_w) / 3 + (dvz_e - dvz_w) * dvz_w + dvz_w * dvz_w;</span><span class="removed-line">- 				phiD(i_3d) += (dvz_n - dvz_s) * (dvz_n - dvz_s) / 3 + (dvz_n - dvz_s) * dvz_s + dvz_s * dvz_s;</span><span class="removed-line">- 				phiD(i_3d) *= (dz_s + dz_n + dz_w + dz_e) / 4;</span><span class="removed-line">- 			}</span><span class="removed-line">- 		}</span><span class="removed-line">- 	}</span><span class="removed-line">- </span><span class="removed-line">- 	//cout&amp;lt;&amp;lt;"A--L--O--H--A--!!!!!!"&amp;lt;&amp;lt;endl;</span><span class="removed-line">- </span><span class="removed-line">- 	//phiD = 0;</span><span class="removed-line">- 	//phiD = (pow(dvxz,2.0) + pow(dvyz,2.0)) * dz2;</span><span class="removed-line">- }</span></div></div><h5>‚ú® Added Code Sections:</h5><div class="function-container"><div class="function-header">‚úÖ Added Section 1 (around line 237)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  };</span><span class="unchanged-line">  </span><span class="unchanged-line">  //Calculate Reynolds diffusive coeffcients and source term</span><span class="added-line">+ void CPistonGap::PistonReynoldsCalcCoefficientsGS(void)</span><span class="unchanged-line">  {</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 2 (around line 262)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	mu/=Q;</span><span class="unchanged-line">  	rho2d/=Q;</span><span class="unchanged-line">  	//Face diffusivity values</span><span class="added-line">+ 	double mun,mus,mue,muw,hKn,hKs,hKe,hKw,hn,hs,he,hw,dhKx,dhKy,defsqueezeK,defsqueezeB;</span><span class="unchanged-line">  	if(numgvlizhi &amp;gt; 0)</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 3 (around line 352)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		}*/</span><span class="unchanged-line">  </span><span class="unchanged-line">  		//North</span><span class="added-line">+ 		an(i) = pow(hn,3.0)*dx / (dy*6.0*mun);</span><span class="unchanged-line">  		//Dirichlet boundary</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 4 (around line 361)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		};</span><span class="unchanged-line">  </span><span class="unchanged-line">  		//South</span><span class="added-line">+ 		as(i) = pow(hs,3.0)*dx / (dy*6.0*mus);</span><span class="unchanged-line">  		//Dirichlet boundary</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 5 (around line 370)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		};</span><span class="unchanged-line">  </span><span class="unchanged-line">  		//East</span><span class="added-line">+ 		ae(i) = pow(he,3.0)*dy / (dx*6.0*mue);</span><span class="unchanged-line">  		//West</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 6 (around line 536)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  </span><span class="unchanged-line">  }</span><span class="unchanged-line">  //Solve Energy equation using GS SOR method</span><span class="added-line">+ void CPistonGap::PistonEnergyGS(void) </span><span class="unchanged-line">  {</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div></div><div class="section"><h3 class="file-title">üìÑ CPistonGapMG.cpp</h3><p><strong>Status:</strong> üîµ 10 additions and 32 deletions (net reduction of 22 lines)</p><p><strong>Size:</strong> 26,072 ‚Üí 24,947 bytes (-1,125 bytes)</p><p><strong>Changes:</strong> +10 lines added, -32 lines removed</p><p><strong>Types of Changes:</strong> Functions, Control flow, Variable assignments</p><h4>üîß Code Changes (Separated by Type):</h4><h5>üóëÔ∏è Removed Code Sections:</h5><div class="function-container"><div class="function-header">‚ùå Removed Section 1 (around line 216)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  </span><span class="unchanged-line">  };</span><span class="unchanged-line">  //Initilaize Reynolds diffusive coefficients for MG levels</span><span class="removed-line">- void CPistonGap::PistonReynoldsCalcCoefficientsMG(double dt)</span><span class="unchanged-line">  {</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 2 (around line 233)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  </span><span class="unchanged-line">  	//Fluid average viscosity</span><span class="unchanged-line">  	mu = 0;</span><span class="removed-line">- 	rho2d.resize(M*N);</span><span class="removed-line">- 	rho2d = 0;</span><span class="unchanged-line">  	for(int i=0;i&amp;lt;Q;i++)</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 3 (around line 268)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		{</span><span class="unchanged-line">  			//Viscosity</span><span class="unchanged-line">  			levels[l+1].mu = PistonRestrictionMG(levels[l].mu,levels[l+1].FaceId_f2c,levels[l+1].FaceDist_f2c);</span><span class="removed-line">- 			levels[l+1].rho = PistonRestrictionMG(levels[l].rho,levels[l+1].FaceId_f2c,levels[l+1].FaceDist_f2c);</span><span class="unchanged-line">  			//Film thickness</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 4 (around line 288)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		//Face diffusivity values</span><span class="unchanged-line">  		for(int i=0;i&amp;lt;N*M;i++)</span><span class="unchanged-line">  		{</span><span class="removed-line">- </span><span class="removed-line">- 			rhop = levels[l].rho(i);</span><span class="removed-line">- 			hp = levels[l].h(i);</span><span class="unchanged-line">  			//North</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 5 (around line 305)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  			{</span><span class="unchanged-line">  				mun = 0.5*( levels[l].mu(i) + levels[l].mu(i+1) );</span><span class="unchanged-line">  				hn = 0.5*( levels[l].h(i) + levels[l].h(i+1) );</span><span class="removed-line">- 				rhon = 0.5*( levels[l].rho(i) + levels[l].rho(i+1) );</span><span class="unchanged-line">  				if(l==0){</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 6 (around line 315)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  			{</span><span class="unchanged-line">  				mus = levels[l].mu(i);</span><span class="unchanged-line">  				hs = levels[l].h(i);</span><span class="removed-line">- 				rhos = levels[l].rho(i);</span><span class="unchanged-line">  				if(l==0){</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 7 (around line 324)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  			{</span><span class="unchanged-line">  				mus = 0.5*( levels[l].mu(i) + levels[l].mu(i-1) );</span><span class="unchanged-line">  				hs = 0.5*( levels[l].h(i) + levels[l].h(i-1) );</span><span class="removed-line">- 				rhos = 0.5*( levels[l].rho(i) + levels[l].rho(i-1) );</span><span class="unchanged-line">  				if(l==0){</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 8 (around line 334)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  			{</span><span class="unchanged-line">  				mue = 0.5*( levels[l].mu(i) + levels[l].mu(i-(N-1)*M) );</span><span class="unchanged-line">  				he = 0.5*( levels[l].h(i) + levels[l].h(i-(N-1)*M) );</span><span class="removed-line">- 				rhoe = 0.5*( levels[l].rho(i) + levels[l].rho(i-(N-1)*M) );</span><span class="unchanged-line">  				if(l==0){</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 9 (around line 343)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  			{</span><span class="unchanged-line">  				mue = 0.5*( levels[l].mu(i) + levels[l].mu(i+M) );</span><span class="unchanged-line">  				he = 0.5*( levels[l].h(i) + levels[l].h(i+M) );</span><span class="removed-line">- 				rhoe = 0.5*( levels[l].rho(i) + levels[l].rho(i+M) );</span><span class="unchanged-line">  				if(l==0){</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 10 (around line 353)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  			{</span><span class="unchanged-line">  				muw = 0.5*( levels[l].mu(i) + levels[l].mu(i+(N-1)*M) );</span><span class="unchanged-line">  				hw = 0.5*( levels[l].h(i) + levels[l].h(i+(N-1)*M) );</span><span class="removed-line">- 				rhow = 0.5*( levels[l].rho(i) + levels[l].rho(i+(N-1)*M) );</span><span class="unchanged-line">  				if(l==0){</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 11 (around line 362)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  			{</span><span class="unchanged-line">  				muw = 0.5*( levels[l].mu(i) + levels[l].mu(i-M) );</span><span class="unchanged-line">  				hw = 0.5*( levels[l].h(i) + levels[l].h(i-M) );</span><span class="removed-line">- 				rhow = 0.5*( levels[l].rho(i) + levels[l].rho(i-M) );</span><span class="unchanged-line">  				if(l==0){</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 12 (around line 389)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  				double dhKx = (hKe - hKw)/dx;</span><span class="unchanged-line">  				double dhKy = (hKn - hKs)/dy;</span><span class="unchanged-line">  				//Squeeze due to deformation change</span><span class="removed-line">- 				defsqueezeK = (CPistonGap::defK_p_gap(i) - CPistonGap::defK_p_gap_squeeze(i))/dt;</span><span class="removed-line">- 				defsqueezeB = (CPistonGap::defB_p_gap(i) - CPistonGap::defB_p_gap_squeeze(i))/dt;</span><span class="removed-line">- 				expansion = (rho2d(i) - CPistonGap::density_expansion(i))/dt;</span><span class="unchanged-line">  				//Source</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><h5>‚ú® Added Code Sections:</h5><div class="function-container"><div class="function-header">‚úÖ Added Section 1 (around line 216)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  </span><span class="unchanged-line">  };</span><span class="unchanged-line">  //Initilaize Reynolds diffusive coefficients for MG levels</span><span class="added-line">+ void CPistonGap::PistonReynoldsCalcCoefficientsMG(void)</span><span class="unchanged-line">  {</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 2 (around line 371)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  				double dhKx = (hKe - hKw)/dx;</span><span class="unchanged-line">  				double dhKy = (hKn - hKs)/dy;</span><span class="unchanged-line">  				//Squeeze due to deformation change</span><span class="added-line">+ 				defsqueezeK = (CPistonGap::defK_p_gap(i) - CPistonGap::defK_p_gap_squeeze(i))/CPistonGap::dx;</span><span class="added-line">+ 				defsqueezeB = (CPistonGap::defB_p_gap(i) - CPistonGap::defB_p_gap_squeeze(i))/CPistonGap::dx;</span><span class="unchanged-line">  				//Source</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div></div><div class="section"><h3 class="file-title">üìÑ CPistonGapThermal.cpp</h3><p><strong>Status:</strong> üîµ 4 additions and 456 deletions (net reduction of 452 lines)</p><p><strong>Size:</strong> 27,340 ‚Üí 11,025 bytes (-16,315 bytes)</p><p><strong>Changes:</strong> +4 lines added, -456 lines removed</p><p><strong>Types of Changes:</strong> Functions, Comments, Control flow</p><h4>üîß Code Changes (Separated by Type):</h4><h5>üóëÔ∏è Removed Code Sections:</h5><div class="function-container"><div class="function-header">‚ùå Removed Section 1 (around line 38)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  </span><span class="unchanged-line">  </span><span class="unchanged-line">  };</span><span class="removed-line">- </span><span class="removed-line">- //Calculate istantaneous thermal flux generated from gap to piston and cylinder</span><span class="removed-line">- void CPistonGap::PistonCylinderCalcGapThermalFlux_new(void)</span><span class="removed-line">- {	</span><span class="removed-line">- 	double lambda;</span><span class="removed-line">- 	Range all = Range::all();</span><span class="removed-line">- </span><span class="removed-line">- </span><span class="removed-line">- 	//Heat fluxes clear</span><span class="removed-line">- 	QgapK = 0.0;</span><span class="removed-line">- 	QgapB = 0.0;</span><span class="removed-line">- </span><span class="removed-line">- 	//Oil conduction coefficient</span><span class="removed-line">- 	lambda = my_oil -&amp;gt;get_lambda();//oilpistongap.oillambda;</span><span class="removed-line">- </span><span class="removed-line">- 	//CONDUCTIVE HEAT FLUX TO SOLID PARTS FROM FLUID [W/m2]</span><span class="removed-line">- 	Array&amp;lt;double,1&amp;gt; To(N*M);</span><span class="removed-line">- 	//Cylinder</span><span class="removed-line">- 	To = T(Range(0,N*M-1));</span><span class="removed-line">- 	QgapB = lambda/(dz2/2) * (To - TB_surf_gap) - lambda/dz2/Q * (TK_surf_gap - TB_surf_gap);</span><span class="removed-line">- 	//Piston</span><span class="removed-line">- 	To = T(Range(N*M*(Q-1),N*M*Q-1));</span><span class="removed-line">- 	QgapK = lambda/(dz2/2) * (To - TK_surf_gap) - lambda/dz2/Q * (TB_surf_gap - TK_surf_gap);</span><span class="removed-line">- </span><span class="removed-line">- </span><span class="removed-line">- };</span><span class="removed-line">- </span><span class="unchanged-line">  //Calculate thermal flux to solid surfaces considering boundary flux over shaft revolution</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 2 (around line 524)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	};</span><span class="unchanged-line">  </span><span class="unchanged-line">  };</span><span class="removed-line">- </span><span class="removed-line">- //Calculate piston and cylinder body temperatures and thermal deformation</span><span class="removed-line">- void CPistonGap::PistonCylinderSolveBodyThermal_new(void)</span><span class="removed-line">- {</span><span class="removed-line">- </span><span class="removed-line">- 	myGapInput.IM_piston.free(); myGapInput.IM_cylinder.free();</span><span class="removed-line">- </span><span class="removed-line">- 	//shaft speed [rev/s]</span><span class="removed-line">- 	double speed = operatingpistongap.speed/60.0;</span><span class="removed-line">- 	double T_DC = 0.5 * (temperaturepistongap.THP + temperaturepistongap.TLP);</span><span class="removed-line">- 	double T_case = temperaturepistongap.TCase;</span><span class="removed-line">- 	vector&amp;lt;double&amp;gt; Tb;</span><span class="removed-line">- 	Tb.push_back(T_DC);</span><span class="removed-line">- 	Tb.push_back(T_case);</span><span class="removed-line">- </span><span class="removed-line">- 	//---------------Calculate temperature piston------------//</span><span class="removed-line">- 	qbi_piston[0] = 0.0;</span><span class="removed-line">- 	//[J/(m2 rev) * rev/s] = [W/m2] </span><span class="removed-line">- 	EbodyK *= speed;</span><span class="removed-line">- 	tbodyK_DC *= speed*oilpistongap.AlphaDC;</span><span class="removed-line">- 	tbodyK_case *= speed*oilpistongap.AlphaCase;</span><span class="removed-line">- 	//limit flux</span><span class="removed-line">- 	//EbodyK = where(EbodyK&amp;gt;=1.0e5,1.0e5,EbodyK);</span><span class="removed-line">- 	//EbodyK = where(EbodyK&amp;lt;=-1.0e3,-1.0e3,EbodyK);</span><span class="removed-line">- 	//EbodyK = where(EbodyK&amp;gt;=5.0e4,5.0e4,EbodyK);</span><span class="removed-line">- 	//EbodyK = where(EbodyK&amp;lt;=-5.0e4,-5.0e4,EbodyK);</span><span class="removed-line">- 	//damp flux</span><span class="removed-line">- 	EbodyK = EbodyK_old + AlphaTh * (EbodyK - EbodyK_old);</span><span class="removed-line">- 	//assign flux to flux vector - from faces heat flux to surface nodes</span><span class="removed-line">- 	qbi_piston[0] = EbodyK;</span><span class="removed-line">- 	vector&amp;lt;Array&amp;lt;double,1&amp;gt;&amp;gt; wtd_h_K;</span><span class="removed-line">- 	wtd_h_K.push_back(tbodyK_DC);</span><span class="removed-line">- 	wtd_h_K.push_back(tbodyK_case);</span><span class="removed-line">- 	/*Log &amp;lt;&amp;lt; "Boundary EbodyK " &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 	for(int b = 0; b &amp;lt; EbodyK.size(); b++){</span><span class="removed-line">- 		Log &amp;lt;&amp;lt; EbodyK(b) &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 	}*/</span><span class="removed-line">- 	for(int i = 0;i&amp;lt;myinput.data.thermal.piston.neumann_bc.size();i++){</span><span class="removed-line">- 		Array&amp;lt;double,1&amp;gt; temp ;</span><span class="removed-line">- 		temp.resize(myMesh.nCells,myinput.data.thermal.piston.neumann_bc[i].q[0]);</span><span class="removed-line">- 		temp[0]= myinput.data.thermal.piston.neumann_bc[i].q[0];</span><span class="removed-line">- 		qbi_piston.push_back(temp);</span><span class="removed-line">- 	};</span><span class="removed-line">- 	qbi_piston[0] = where(qbi_piston[0]==0.0,1.0e-9,qbi_piston[0]);</span><span class="removed-line">- 	//read mesh and solve thermal</span><span class="removed-line">- 	myThermal.readMeshThermal("piston");</span><span class="removed-line">- 	myThermal.ThermalSolve_Piston(qbi_piston,wtd_h_K,Tb,TK_body,TK_surf);</span><span class="removed-line">- 	//assign flux to old array</span><span class="removed-line">- 	EbodyK_old = EbodyK;</span><span class="removed-line">- 	//reset flux</span><span class="removed-line">- 	EbodyK = 0.0;</span><span class="removed-line">- 	tbodyK_DC = 0.0;</span><span class="removed-line">- 	tbodyK_case = 0.0;</span><span class="removed-line">- 	//free variables</span><span class="removed-line">- 	myMesh.xyz.free(); myMesh.conn.free(); myMesh.cxyz_th.free(); myMesh.E.free();</span><span class="removed-line">- 	myMesh.v.free(); myMesh.alpha.free(); myThermal.nodeid_qb.clear(); myThermal.phi.clear();</span><span class="removed-line">- 	wtd_h_K.clear();</span><span class="removed-line">- 	cout&amp;lt;&amp;lt;"Finish piston-piston matrix"&amp;lt;&amp;lt;endl;</span><span class="removed-line">- 	//---------------Calculate temperature cylinder------------//</span><span class="removed-line">- 	qbi_cylinder[0] = 0.0;</span><span class="removed-line">- 	//[J/(m2 rev) * rev/s] = [W/m2] </span><span class="removed-line">- 	EbodyB *= speed;</span><span class="removed-line">- 	tbodyB_DC *= speed*oilpistongap.AlphaDC;</span><span class="removed-line">- 	tbodyB_case *= speed*oilpistongap.AlphaCase;;</span><span class="removed-line">- 	//limit flux</span><span class="removed-line">- 	//EbodyB = where(EbodyB&amp;gt;=1.0e5,1.0e5,EbodyB);</span><span class="removed-line">- 	//EbodyB = where(EbodyB&amp;lt;=-1.0e4,-1.0e4,EbodyB);</span><span class="removed-line">- 	//EbodyB = where(EbodyB&amp;gt;=5.0e4,5.0e4,EbodyB);</span><span class="removed-line">- 	//EbodyB = where(EbodyB&amp;lt;=-5.0e4,-5.0e4,EbodyB);</span><span class="removed-line">- 	//damp flux</span><span class="removed-line">- 	EbodyB = EbodyB_old + AlphaTh * (EbodyB - EbodyB_old);</span><span class="removed-line">- 	//assign flux to flux vector</span><span class="removed-line">- 	qbi_cylinder[0] = EbodyB;</span><span class="removed-line">- 	vector&amp;lt;Array&amp;lt;double,1&amp;gt;&amp;gt; wtd_h_B;</span><span class="removed-line">- 	wtd_h_B.push_back(tbodyB_DC);</span><span class="removed-line">- 	wtd_h_B.push_back(tbodyB_case);</span><span class="removed-line">- 	/*Log &amp;lt;&amp;lt; "Boundary EbodyB " &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 	for(int b = 0; b &amp;lt; EbodyB.size(); b++){</span><span class="removed-line">- 		Log &amp;lt;&amp;lt; EbodyB(b) &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 	}*/</span><span class="removed-line">- 	qbi_cylinder[0] = where(qbi_cylinder[0]==0.0,1.0e-9,qbi_cylinder[0]);</span><span class="removed-line">- 	//read mesh</span><span class="removed-line">- 	myThermal.readMeshThermal("cylinder");</span><span class="removed-line">- 	//calculate other bores heat flux</span><span class="removed-line">- 	if(myinput.data.options_piston.general.EHDTestRig || myinput.data.options_piston.general.TriboTestRig)</span><span class="removed-line">- 		qbi_cylinder.resize(1);</span><span class="removed-line">- 	else</span><span class="removed-line">- 		qbi_cylinder.resize(myinput.data.operating_conditions.npistons);</span><span class="removed-line">- 	PistonCylinderBlockFlux(qbi_cylinder);</span><span class="removed-line">- 	//add other defined flux boundaries</span><span class="removed-line">- 	for(int i = 0;i&amp;lt;myinput.data.thermal.block.neumann_bc.size();i++){</span><span class="removed-line">- 		Array&amp;lt;double,1&amp;gt; temp; </span><span class="removed-line">- 		temp.resize(myMesh.nNodes);//should be more than plenty...</span><span class="removed-line">- 		temp = myinput.data.thermal.block.neumann_bc[i].q[0];</span><span class="removed-line">- 		//Log &amp;lt;&amp;lt; "defining qb " &amp;lt;&amp;lt; i &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 		qbi_cylinder.push_back(temp);</span><span class="removed-line">- 	};</span><span class="removed-line">- 	//solve thermal</span><span class="removed-line">- 	for(int a = 0; a &amp;lt; qbi_cylinder.size(); a++){</span><span class="removed-line">- 		//Log &amp;lt;&amp;lt; "Boundary qbi_cylinder " &amp;lt;&amp;lt; a &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 		for(int b = 0; b &amp;lt; qbi_cylinder[a].size(); b++){</span><span class="removed-line">- 			//Log &amp;lt;&amp;lt; qbi_cylinder[a](b) &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 		}</span><span class="removed-line">- 	}</span><span class="removed-line">- 	myThermal.ThermalSolve_Cylinder(qbi_cylinder,wtd_h_B,Tb,TB_body,TB_surf);</span><span class="removed-line">- 	//assign flux to old array</span><span class="removed-line">- 	EbodyB_old = EbodyB;</span><span class="removed-line">- 	//reset flux</span><span class="removed-line">- 	EbodyB = 0.0;</span><span class="removed-line">- 	tbodyB_DC = 0.0;</span><span class="removed-line">- 	tbodyB_case = 0.0;</span><span class="removed-line">- 	//free variables</span><span class="removed-line">- 	myMesh.xyz.free(); myMesh.conn.free(); myMesh.cxyz_th.free(); myMesh.E.free();</span><span class="removed-line">- 	myMesh.v.free(); myMesh.alpha.free(); myThermal.nodeid_qb.clear(); myThermal.phi.clear();</span><span class="removed-line">- 	wtd_h_B.clear();</span><span class="removed-line">- 	cout&amp;lt;&amp;lt;"Finish cylinder-cylinder matrix"&amp;lt;&amp;lt;endl;</span><span class="removed-line">- </span><span class="removed-line">- 	//---------------Solve interbody conduction------------//</span><span class="removed-line">- 	double lambda_oil = my_oil -&amp;gt; get_lambda();//oilpistongap.oillambda;</span><span class="removed-line">- 	double C = operatingpistongap.speed * lambda_oil / 60 / 9;</span><span class="removed-line">- 	myThermal.ThermalSolve_interbody_conduction(Mid_K2B, Mwt_K2B, Mid_B2K, Mwt_B2K, C);</span><span class="removed-line">- 	cout&amp;lt;&amp;lt;"Finish piston-cylinder and cylinder piston matrix"&amp;lt;&amp;lt;endl;</span><span class="removed-line">- </span><span class="removed-line">- 	//---------------Solve both body temperature distribution------------//</span><span class="removed-line">- 	myThermal.ThermalSolve_new();</span><span class="removed-line">- 	cout&amp;lt;&amp;lt;"Finish both body temperature distribution"&amp;lt;&amp;lt;endl;</span><span class="removed-line">- </span><span class="removed-line">- 	//read mesh </span><span class="removed-line">- 	myThermal.readMeshThermal("piston");</span><span class="removed-line">- 	//read surface coordinates piston body</span><span class="removed-line">- 	myGapInput.readBodySurfacexyzThermal("piston",myinput.data.thermal.piston.meshfile);</span><span class="removed-line">- 	myThermal.ThermalSolve_post("piston",qbi_piston,TK_body,TK_surf);</span><span class="removed-line">- 	if(ThermalDeformation)</span><span class="removed-line">- 	{</span><span class="removed-line">- 		myFEMThermal.FEMThermalSolve("piston",TK_body,defK_th,myMesh.piston_name);</span><span class="removed-line">- 	};</span><span class="removed-line">- 	myMesh.xyz.free(); myMesh.conn.free(); myMesh.E.free(); myMesh.v.free();</span><span class="removed-line">- 	myMesh.alpha.free(); myThermal.nodeid_qb.clear(); myThermal.phi.clear(); </span><span class="removed-line">- </span><span class="removed-line">- 	//read mesh </span><span class="removed-line">- 	myThermal.readMeshThermal("cylinder");</span><span class="removed-line">- 	//read surface coordinates cylinder body</span><span class="removed-line">- 	myGapInput.readBodySurfacexyzThermal("cylinder",myinput.data.thermal.block.meshfile);</span><span class="removed-line">- 	myThermal.ThermalSolve_post("cylinder",qbi_cylinder,TB_body,TB_surf);</span><span class="removed-line">- 	if(ThermalDeformation)</span><span class="removed-line">- 	{</span><span class="removed-line">- 		myFEMThermal.FEMThermalSolve("cylinder",TB_body,defB_th,myMesh.cylinder_name);</span><span class="removed-line">- 	}</span><span class="removed-line">- 	myMesh.xyz.free(); myMesh.conn.free(); myMesh.E.free(); myMesh.v.free();</span><span class="removed-line">- 	myMesh.alpha.free(); myThermal.nodeid_qb.clear(); myThermal.phi.clear(); </span><span class="removed-line">- </span><span class="removed-line">- </span><span class="removed-line">- </span><span class="removed-line">- </span><span class="removed-line">- </span><span class="removed-line">- </span><span class="removed-line">- </span><span class="removed-line">- </span><span class="removed-line">- </span><span class="removed-line">- </span><span class="removed-line">- </span><span class="removed-line">- </span><span class="removed-line">- 	/*//---------------Solve piston thermal deformation------------//</span><span class="removed-line">- 	if(ThermalDeformation)</span><span class="removed-line">- 	{</span><span class="removed-line">- 		myFEMThermal.FEMThermalSolve("piston",TK_body,defK_th,myMesh.piston_name);</span><span class="removed-line">- 	}</span><span class="removed-line">- 	//free variables</span><span class="removed-line">- 	myMesh.xyz.free(); myMesh.conn.free(); myMesh.cxyz_th.free(); myMesh.E.free();</span><span class="removed-line">- 	myMesh.v.free(); myMesh.alpha.free(); myThermal.nodeid_qb.clear(); myThermal.phi.clear();</span><span class="removed-line">- </span><span class="removed-line">- </span><span class="removed-line">- </span><span class="removed-line">- 	</span><span class="removed-line">- 	</span><span class="removed-line">- 	//---------------Solve cylinder thermal deformation------------//</span><span class="removed-line">- 	if(ThermalDeformation)</span><span class="removed-line">- 	{</span><span class="removed-line">- 		myFEMThermal.FEMThermalSolve("cylinder",TB_body,defB_th,myMesh.cylinder_name);</span><span class="removed-line">- 	}</span><span class="removed-line">- 	//free variables</span><span class="removed-line">- 	myMesh.xyz.free(); myMesh.conn.free(); myMesh.cxyz_th.free(); myMesh.E.free();</span><span class="removed-line">- 	myMesh.v.free(); myMesh.alpha.free(); myThermal.nodeid_qb.clear(); myThermal.phi.clear(); */</span><span class="removed-line">- </span><span class="removed-line">- 	//Load IM's dwm</span><span class="removed-line">- 	if(myinput.data.options_piston.general.PressureDeformation)</span><span class="removed-line">- 	{</span><span class="removed-line">- 		//read surface coordinates</span><span class="removed-line">- 		//Log &amp;lt;&amp;lt; "Reading pressure mesh coordinates file... " &amp;lt;&amp;lt; "\t";</span><span class="removed-line">- 		//myGapInput.readBodySurfacexyzPressure();</span><span class="removed-line">- 		//Log &amp;lt;&amp;lt; "done!" &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 		//Log &amp;lt;&amp;lt; " " &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 		//read matrices</span><span class="removed-line">- 		Log &amp;lt;&amp;lt; "Reading influence matrices... " &amp;lt;&amp;lt; "\t";</span><span class="removed-line">- 		myGapInput.readInfluenceMatricesPistonCylinder(myinput.data.options_piston.general.IM_piston_path,myinput.data.options_piston.general.IM_bushing_path);</span><span class="removed-line">- 		Log &amp;lt;&amp;lt; "done!" &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 		Log &amp;lt;&amp;lt; " " &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 	};</span><span class="removed-line">- </span><span class="removed-line">- };</span><span class="removed-line">- </span><span class="unchanged-line">  //Interpolate bore flux to other cylinder bores</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 3 (around line 746)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	Array&amp;lt;double,2&amp;gt; xyz_i;</span><span class="unchanged-line">  	//Angle between cylinder bores</span><span class="unchanged-line">  	double dtheta = 2.0*PI/(double) qbi.size();</span><span class="removed-line">- 	double theta = -1.0 * dtheta;</span><span class="unchanged-line">  	//Interpolate reference heat flux to other bores coordinates</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 4 (around line 773)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		Array&amp;lt;double,2&amp;gt; FaceDist; Array&amp;lt;int,2&amp;gt; FaceId;</span><span class="unchanged-line">  		myGapUtils.SearchNeighbours(xyz_r,xyz_i,FaceId,FaceDist,10);</span><span class="unchanged-line">  		//Interpolate reference heat flux to i-th heat flux</span><span class="removed-line">- 		qbi[i+1] = myGapUtils.InterpolateFields(FaceId,FaceDist,qbi[0]);			</span><span class="removed-line">- 	}</span><span class="removed-line">- };</span><span class="removed-line">- </span><span class="removed-line">- void CPistonGap::Heatfluxrecovering(int option)</span><span class="removed-line">- {</span><span class="removed-line">- 	string heatflux_file;</span><span class="removed-line">- 	string line;</span><span class="removed-line">- 	vector &amp;lt;double&amp;gt; readvalue;</span><span class="removed-line">- 	if (option == 1)</span><span class="removed-line">- 		heatflux_file = "./piston_flux.txt";</span><span class="removed-line">- 	else</span><span class="removed-line">- 		heatflux_file = "./block_flux.txt";</span><span class="removed-line">- 	ifstream fheatflux (heatflux_file);</span><span class="removed-line">- 	//cout&amp;lt;&amp;lt;"check1"&amp;lt;&amp;lt;endl;</span><span class="removed-line">- 	if (fheatflux.is_open())</span><span class="removed-line">- 	{</span><span class="removed-line">- 		//cout&amp;lt;&amp;lt;"check2"&amp;lt;&amp;lt;endl;</span><span class="removed-line">- 		while(fheatflux)</span><span class="removed-line">- 		{</span><span class="removed-line">- 			//cout&amp;lt;&amp;lt;"check3"&amp;lt;&amp;lt;endl;</span><span class="removed-line">- 			getline(fheatflux,line);</span><span class="removed-line">- 			istringstream iss(line);</span><span class="removed-line">- 			double temp;</span><span class="removed-line">- 			while (iss &amp;gt;&amp;gt; temp)</span><span class="removed-line">- 				readvalue.push_back(temp);</span><span class="removed-line">- 			iss.clear();</span><span class="removed-line">- 		}</span><span class="removed-line">- 		fheatflux.clear();</span><span class="removed-line">- 		fheatflux.close();</span><span class="removed-line">- </span><span class="removed-line">- 		if (option == 1)</span><span class="removed-line">- 		{</span><span class="removed-line">- 			for (int i=0;i&amp;lt;EbodyK.size();i++)</span><span class="removed-line">- 			{</span><span class="removed-line">- 				EbodyK(i) = readvalue[i];</span><span class="removed-line">- 				//cout&amp;lt;&amp;lt;readvalue[i]&amp;lt;&amp;lt;endl;</span><span class="removed-line">- 			}</span><span class="removed-line">- 			int i_revrow = 0;</span><span class="removed-line">- 			for (int i=0;i&amp;lt;qbi_piston.size();i++)</span><span class="removed-line">- 			{</span><span class="removed-line">- 				for (int j=0;j&amp;lt;qbi_piston[i].extent(0);j++)</span><span class="removed-line">- 				{</span><span class="removed-line">- 					qbi_piston[i](j) = readvalue[i_revrow];</span><span class="removed-line">- 					i_revrow++;</span><span class="removed-line">- 				}</span><span class="removed-line">- 			}</span><span class="removed-line">- 			EbodyK_old=EbodyK;</span><span class="removed-line">- 		}</span><span class="removed-line">- 		else</span><span class="removed-line">- 		{</span><span class="removed-line">- 			for (int i=0;i&amp;lt;EbodyB.size();i++)</span><span class="removed-line">- 			{</span><span class="removed-line">- 				EbodyB(i) = readvalue[i];</span><span class="removed-line">- 				//cout&amp;lt;&amp;lt;readvalue[i]&amp;lt;&amp;lt;endl;</span><span class="removed-line">- 			}</span><span class="removed-line">- 			int i_revrow = 0;</span><span class="removed-line">- 			for (int i=0;i&amp;lt;qbi_cylinder.size();i++)</span><span class="removed-line">- 			{</span><span class="removed-line">- 				for (int j=0;j&amp;lt;qbi_cylinder[i].extent(0);j++)</span><span class="removed-line">- 				{</span><span class="removed-line">- 					qbi_cylinder[i](j) = readvalue[i_revrow];</span><span class="removed-line">- 					i_revrow++;</span><span class="removed-line">- 				}</span><span class="removed-line">- 			}</span><span class="removed-line">- 			EbodyB_old=EbodyB;</span><span class="removed-line">- 		}</span><span class="removed-line">- 	}</span><span class="removed-line">- 	readvalue.clear();</span><span class="removed-line">- }</span></div></div><h5>‚ú® Added Code Sections:</h5><div class="function-container"><div class="function-header">‚úÖ Added Section 1 (around line 299)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	Array&amp;lt;double,2&amp;gt; xyz_i;</span><span class="unchanged-line">  	//Angle between cylinder bores</span><span class="unchanged-line">  	double dtheta = 2.0*PI/(double) qbi.size();</span><span class="added-line">+ 	double theta = dtheta;</span><span class="unchanged-line">  	//Interpolate reference heat flux to other bores coordinates</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 2 (around line 326)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		Array&amp;lt;double,2&amp;gt; FaceDist; Array&amp;lt;int,2&amp;gt; FaceId;</span><span class="unchanged-line">  		myGapUtils.SearchNeighbours(xyz_r,xyz_i,FaceId,FaceDist,10);</span><span class="unchanged-line">  		//Interpolate reference heat flux to i-th heat flux</span><span class="added-line">+ 		qbi[i+1] = myGapUtils.InterpolateFields(FaceId,FaceDist,qbi[0]);</span><span class="added-line">+ 			</span><span class="added-line">+ 	}</span><span class="added-line">+ </span><span class="added-line">+ };</span></div></div></div><div class="section"><h3 class="file-title">üìÑ CPistonGapdF.cpp</h3><p><strong>Status:</strong> üîµ 115 additions and 35 deletions (net growth of 80 lines)</p><p><strong>Size:</strong> 14,970 ‚Üí 18,323 bytes (+3,353 bytes)</p><p><strong>Changes:</strong> +115 lines added, -35 lines removed</p><p><strong>Types of Changes:</strong> Functions, Comments, Control flow, Variable assignments</p><h4>üîß Code Changes (Separated by Type):</h4><h5>üóëÔ∏è Removed Code Sections:</h5><div class="function-container"><div class="function-header">‚ùå Removed Section 1 (around line 292)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		};</span><span class="unchanged-line">  	};</span><span class="unchanged-line">  };</span><span class="removed-line">- //Calculate piston external forces</span><span class="removed-line">- void CPistonGap::PistonCalcExternalForces(void)</span><span class="removed-line">- {</span><span class="removed-line">- 	//Variable declaration</span><span class="unchanged-line">  	double mK,lSK,beta,betamax,phi,omega,pDC,pCase,</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 2 (around line 370)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	MKy = forcespistongap.MKy;</span><span class="unchanged-line">  	//Total external moment</span><span class="unchanged-line">  	forcespistongap.MK = sqrt( (MKx*MKx) + (MKy*MKy) );</span><span class="removed-line">- 	</span><span class="unchanged-line">  };</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><h5>‚ú® Added Code Sections:</h5><div class="function-container"><div class="function-header">‚úÖ Added Section 1 (around line 219)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	//---------------------------GENERAL-----------------------------//</span><span class="unchanged-line">  	double beta = operatingpistongap.beta_rad;</span><span class="unchanged-line">  	double phi = operatingpistongap.phi_rad;</span><span class="added-line">+ </span><span class="unchanged-line">  	//Friction forces moments</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 2 (around line 277)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		};</span><span class="unchanged-line">  	};</span><span class="unchanged-line">  };</span><span class="added-line">+ void CPistonGap::PistonCalcExternalForces_inclined_piston(void){</span><span class="added-line">+ 		//Variable declaration</span><span class="unchanged-line">  	double mK,lSK,beta,betamax,phi,omega,pDC,pCase,</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 3 (around line 295)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	pDC = operatingpistongap.pDC;				//Pressure displacemnt chamber</span><span class="unchanged-line">  	pCase = operatingpistongap.pCase;			//Case pressure</span><span class="unchanged-line">  	FTG = forcespistongap.FTG;					//Slipper friction force</span><span class="added-line">+ 	zeta = myinput.data.options_piston.general.zeta * PI / 180;</span><span class="unchanged-line">  </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 4 (around line 460)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	//FSKy = FAKz * tan(beta); //check dwm</span><span class="unchanged-line">  	//FSKx = - FAKz * tan(gamma)/cos(beta); //check dwm</span><span class="unchanged-line">  	</span><span class="added-line">+ 	forcespistongap.FSKx= FSKx;</span><span class="added-line">+ 	forcespistongap.FSKy= FSKy;</span><span class="added-line">+ 	forcespistongap.FAKz= FAKz;</span><span class="added-line">+ </span><span class="added-line">+ </span><span class="unchanged-line">  	//External force components x and y directions</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div></div><div class="section"><h3 class="file-title">üìÑ CPressure.cpp</h3><p><strong>Status:</strong> üîµ 1 additions and 1 deletions (no net change in line count)</p><p><strong>Size:</strong> 38,946 ‚Üí 38,951 bytes (+5 bytes)</p><p><strong>Changes:</strong> +1 lines added, -1 lines removed</p><p><strong>Types of Changes:</strong> Functions, Comments, Variable assignments</p><h4>üîß Code Changes (Separated by Type):</h4><h5>üóëÔ∏è Removed Code Sections:</h5><div class="function-container"><div class="function-header">‚ùå Removed Section 1 (around line 16)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  </span><span class="unchanged-line">  	Pump.mode = myinput.data.operating_conditions.mode;</span><span class="unchanged-line">  	Pump.npistons = myinput.data.operating_conditions.npistons;</span><span class="removed-line">- 	Pump.nrevolutions = myinput.data.lubrication_module.n_lubrication_revolutions;//ONLY FOR INTERNAL USE Coupled Caspar will have its own, separate pressure module!</span><span class="unchanged-line">  	Pump.speed = myinput.data.operating_conditions.speed * PI/30;</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><h5>‚ú® Added Code Sections:</h5><div class="function-container"><div class="function-header">‚úÖ Added Section 1 (around line 16)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  </span><span class="unchanged-line">  	Pump.mode = myinput.data.operating_conditions.mode;</span><span class="unchanged-line">  	Pump.npistons = myinput.data.operating_conditions.npistons;</span><span class="added-line">+ 	Pump.nrevolutions = abs(myinput.data.lubrication_module.n_lubrication_revolutions);//ONLY FOR INTERNAL USE Coupled Caspar will have its own, separate pressure module!</span><span class="unchanged-line">  	Pump.speed = myinput.data.operating_conditions.speed * PI/30;</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div></div><div class="section"><h3 class="file-title">üìÑ logger.h</h3><p><strong>Status:</strong> üî¥ 4 lines of code were removed</p><p><strong>Size:</strong> 3,459 ‚Üí 3,095 bytes (-364 bytes)</p><p><strong>Changes:</strong> +0 lines added, -4 lines removed</p><p><strong>Types of Changes:</strong> Comments</p><h4>üîß Code Changes (Separated by Type):</h4><h5>üóëÔ∏è Removed Code Sections:</h5><div class="function-container"><div class="function-header">‚ùå Removed Section 1 (around line 74)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  				logfile &amp;lt;&amp;lt; "*                          (_)    ) )                         *" &amp;lt;&amp;lt; "\n";</span><span class="unchanged-line">  				logfile &amp;lt;&amp;lt; "*                                (_)                          *" &amp;lt;&amp;lt; "\n";</span><span class="unchanged-line">  				logfile &amp;lt;&amp;lt; "*                                                             *" &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 				logfile &amp;lt;&amp;lt; "*                 Matteo Pelosi - Dan Mizell                  *" &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 				logfile &amp;lt;&amp;lt; "*              Maha Fluid Power Research Center               *" &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 				logfile &amp;lt;&amp;lt; "*                     Purdue University                       *" &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 				logfile &amp;lt;&amp;lt; "*             https://engineering.purdue.edu/Maha             *" &amp;lt;&amp;lt; "\n";</span><span class="unchanged-line">  				logfile &amp;lt;&amp;lt; "*                                                             *" &amp;lt;&amp;lt; "\n";</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div></div><div class="section"><h3 class="file-title">üìÑ main.cpp</h3><p><strong>Status:</strong> üîµ 28 additions and 21 deletions (net growth of 7 lines)</p><p><strong>Size:</strong> 17,427 ‚Üí 18,405 bytes (+978 bytes)</p><p><strong>Changes:</strong> +28 lines added, -21 lines removed</p><p><strong>Types of Changes:</strong> Functions, Include statements, Comments, Control flow, Variable assignments</p><h4>üîß Code Changes (Separated by Type):</h4><h5>üóëÔ∏è Removed Code Sections:</h5><div class="function-container"><div class="function-header">‚ùå Removed Section 1 (around line 20)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  int min_revs;</span><span class="unchanged-line">  bool force_balance_iterative;</span><span class="unchanged-line">  double mixed_friction;</span><span class="removed-line">- int hd_revs;</span><span class="removed-line">- int hd_levels;</span><span class="unchanged-line">  </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 2 (around line 45)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	min_revs = 0;</span><span class="unchanged-line">  	force_balance_iterative = 0;</span><span class="unchanged-line">  	mixed_friction = 0.0;</span><span class="removed-line">- 	hd_revs = 0;</span><span class="unchanged-line">  	int i = 1;</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 3 (around line 70)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  				a++;</span><span class="unchanged-line">  				mixed_friction = atof(argv[a]);</span><span class="unchanged-line">  			}</span><span class="removed-line">- 			else if(!strcmp(argv[a],"-d")){</span><span class="removed-line">- 				a++;</span><span class="removed-line">- 				hd_revs = atof(argv[a]);</span><span class="removed-line">- 				a++;</span><span class="removed-line">- 				hd_levels = atof(argv[a]);</span><span class="removed-line">- 				//cout &amp;lt;&amp;lt; hd_revs &amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; hd_levels &amp;lt;&amp;lt; endl;</span><span class="removed-line">- 			}</span><span class="unchanged-line">  			else{</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 4 (around line 199)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	Log &amp;lt;&amp;lt; "Success!" &amp;lt;&amp;lt; "\n";</span><span class="unchanged-line">  </span><span class="unchanged-line">  	//Output Internal Use Header</span><span class="removed-line">- 	/*</span><span class="removed-line">- 	Log &amp;lt;&amp;lt; "" &amp;lt;&amp;lt; "\n";</span><span class="unchanged-line">  	Log &amp;lt;&amp;lt; "" &amp;lt;&amp;lt; "\n";</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 5 (around line 225)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	Log &amp;lt;&amp;lt; "-Mixed Friction Option" &amp;lt;&amp;lt; "\n";</span><span class="unchanged-line">  	Log &amp;lt;&amp;lt; "-Reynolds boundary for pressure calculations." &amp;lt;&amp;lt; "\n";</span><span class="unchanged-line">  	Log &amp;lt;&amp;lt; "" &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 	Log &amp;lt;&amp;lt; "" &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 	*/</span><span class="unchanged-line">  	//Output Common Header</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 6 (around line 234)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	Log &amp;lt;&amp;lt; "Piston/Cylinder Lubrication Module" &amp;lt;&amp;lt; "\n";</span><span class="unchanged-line">  	Log &amp;lt;&amp;lt; "Version: See FSTI Gap Design Info" &amp;lt;&amp;lt; "\n";</span><span class="unchanged-line">  	Log &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 	Log &amp;lt;&amp;lt; "Purdue University" &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 	Log &amp;lt;&amp;lt; "Maha Fluid Power Research Center" &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 	Log &amp;lt;&amp;lt; "https://engineering.purdue.edu/Maha" &amp;lt;&amp;lt; "\n";</span><span class="unchanged-line">  	Log &amp;lt;&amp;lt; "\n";</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 7 (around line 448)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		&amp;lt;&amp;lt; "Poiseuille_Leakage\tCouette_Leakage\tMTK\tMTKtan\tAxial_Friction\tFTKy_p\tFTKy_c\tCircumferential_Friction\tFTKx_p\t" </span><span class="unchanged-line">  		&amp;lt;&amp;lt; "FTKx_c\tFTG\tpDC\tFTby\tFTby_p\tFTby_c\tFTbx\tFTbx_p\tFTbx_c\tHigh_Pressure\tLow_Pressure\tF_1\tF_2\tF_3\tF_4\t" </span><span class="unchanged-line">  		&amp;lt;&amp;lt; "F_Fluid_1\tF_Fluid_2\tF_Fluid_3\tF_Fluid_4\tF_Contact_1\tF_Contact_2\tF_Contact_3\tF_Contact_4\tdF_1\tdF_2\t" </span><span class="removed-line">- 		&amp;lt;&amp;lt; "dF_3\tdF_4\tTotal_Leakage\tTotal_Torque_Loss\tMFT\tTotal_Power_Loss\tTotal_Volumetric_Power_Loss\t" </span><span class="removed-line">- 		&amp;lt;&amp;lt; "Power_Loss\tVolumetric_Power_Loss" &amp;lt;&amp;lt; "\n";</span><span class="unchanged-line">  	fout.close();</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><h5>‚ú® Added Code Sections:</h5><div class="function-container"><div class="function-header">‚úÖ Added Section 1 (around line 33)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  void StartPressureModule(void);</span><span class="unchanged-line">  void StartGapModule(void);</span><span class="unchanged-line">  </span><span class="added-line">+ #include "version_define.h"</span><span class="added-line">+ #ifndef PROJECT_VERSION</span><span class="added-line">+     #define PROJECT_VERSION "Unknown"</span><span class="added-line">+ #endif</span><span class="unchanged-line">  </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 2 (around line 191)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	Log &amp;lt;&amp;lt; "Success!" &amp;lt;&amp;lt; "\n";</span><span class="unchanged-line">  </span><span class="unchanged-line">  	//Output Internal Use Header</span><span class="added-line">+ 	/*Log &amp;lt;&amp;lt; "" &amp;lt;&amp;lt; "\n";</span><span class="unchanged-line">  	Log &amp;lt;&amp;lt; "" &amp;lt;&amp;lt; "\n";</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 3 (around line 216)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	Log &amp;lt;&amp;lt; "-Mixed Friction Option" &amp;lt;&amp;lt; "\n";</span><span class="unchanged-line">  	Log &amp;lt;&amp;lt; "-Reynolds boundary for pressure calculations." &amp;lt;&amp;lt; "\n";</span><span class="unchanged-line">  	Log &amp;lt;&amp;lt; "" &amp;lt;&amp;lt; "\n";</span><span class="added-line">+ 	Log &amp;lt;&amp;lt; "" &amp;lt;&amp;lt; "\n";*/</span><span class="added-line">+ </span><span class="added-line">+ </span><span class="unchanged-line">  	//Output Common Header</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 4 (around line 226)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	Log &amp;lt;&amp;lt; "Piston/Cylinder Lubrication Module" &amp;lt;&amp;lt; "\n";</span><span class="unchanged-line">  	Log &amp;lt;&amp;lt; "Version: See FSTI Gap Design Info" &amp;lt;&amp;lt; "\n";</span><span class="unchanged-line">  	Log &amp;lt;&amp;lt; "\n";</span><span class="added-line">+ 	Log &amp;lt;&amp;lt; "SHS" &amp;lt;&amp;lt; "\n";</span><span class="added-line">+ 	Log &amp;lt;&amp;lt; "Smart Hydraulic Solutions" &amp;lt;&amp;lt; "\n";</span><span class="added-line">+ 	Log &amp;lt;&amp;lt; "* Version: " &amp;lt;&amp;lt; PROJECT_VERSION &amp;lt;&amp;lt; setw(50 - strlen(PROJECT_VERSION)) &amp;lt;&amp;lt; "*" &amp;lt;&amp;lt; endl;</span><span class="unchanged-line">  	Log &amp;lt;&amp;lt; "\n";</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 5 (around line 432)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	path = timeroot + "\\output\\piston\\";			CreateDirectory(path.c_str(),NULL);</span><span class="unchanged-line">  	path = timeroot + "\\output\\piston\\matlab\\";	CreateDirectory(path.c_str(),NULL);</span><span class="unchanged-line">  	path = timeroot + "\\output\\piston\\vtk\\";	CreateDirectory(path.c_str(),NULL);</span><span class="added-line">+ </span><span class="added-line">+ 	</span><span class="added-line">+ 	if(myinput.data.options_piston.general.inclined_piston){</span><span class="added-line">+ 		//create header for piston.txt file</span><span class="added-line">+ 		std::ofstream fout;</span><span class="added-line">+ 		fout.open("./output/piston/piston.txt",ios::app);</span><span class="added-line">+ 		fout &amp;lt;&amp;lt; "%time\trevolution\tshaft_angle\te_1\te_2\te_3\te_4\te_1_velocity\te_2_velocity\te_3_velocity\te_4_velocity\t" </span><span class="added-line">+ 			&amp;lt;&amp;lt; "variable_gap_length\tlout\tpos_A\tpos_B\tzRK\tStroke\tlA\tlB\tz_A\tz_B\tPiston_Velocity\tPiston_Leakage\t" </span><span class="added-line">+ 			&amp;lt;&amp;lt; "Poiseuille_Leakage\tCouette_Leakage\tMTK\tMTKtan\tAxial_Friction\tFTKy_p\tFTKy_c\tCircumferential_Friction\tFTKx_p\t" </span><span class="added-line">+ 			&amp;lt;&amp;lt; "FTKx_c\tFTG\tpDC\tFTby\tFTby_p\tFTby_c\tFTbx\tFTbx_p\tFTbx_c\tHigh_Pressure\tLow_Pressure\tF_1\tF_2\tF_3\tF_4\t" </span><span class="added-line">+ 			&amp;lt;&amp;lt; "F_Fluid_1\tF_Fluid_2\tF_Fluid_3\tF_Fluid_4\tF_Contact_1\tF_Contact_2\tF_Contact_3\tF_Contact_4\tdF_1\tdF_2\t" </span><span class="added-line">+ 			&amp;lt;&amp;lt; "dF_3\tdF_4\tTotal_Leakage\tTotal_Torque_Loss\tMFT\tTotal_Mechanical_Power_Loss\tTotal_Volumetric_Power_Loss\t" </span><span class="added-line">+ 			&amp;lt;&amp;lt; "Mechanical_Power_Loss\tVolumetric_Power_Loss\tFSKx\tFSKy\tFAKz\tFKx\tFKy\tFK\tFaK\tFDK\tFwK\tFAKy\tFwky\tFwkz\tFAK_inclined\tMKx\tMKy\tMK" &amp;lt;&amp;lt; "\n";</span><span class="added-line">+ 		fout.close();</span><span class="added-line">+ 		fout.clear();</span><span class="added-line">+ 	}</span><span class="added-line">+ 	</span><span class="added-line">+ 	else{</span><span class="unchanged-line">  	//create header for piston.txt file</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 6 (around line 458)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		&amp;lt;&amp;lt; "Poiseuille_Leakage\tCouette_Leakage\tMTK\tMTKtan\tAxial_Friction\tFTKy_p\tFTKy_c\tCircumferential_Friction\tFTKx_p\t" </span><span class="unchanged-line">  		&amp;lt;&amp;lt; "FTKx_c\tFTG\tpDC\tFTby\tFTby_p\tFTby_c\tFTbx\tFTbx_p\tFTbx_c\tHigh_Pressure\tLow_Pressure\tF_1\tF_2\tF_3\tF_4\t" </span><span class="unchanged-line">  		&amp;lt;&amp;lt; "F_Fluid_1\tF_Fluid_2\tF_Fluid_3\tF_Fluid_4\tF_Contact_1\tF_Contact_2\tF_Contact_3\tF_Contact_4\tdF_1\tdF_2\t" </span><span class="added-line">+ 		&amp;lt;&amp;lt; "dF_3\tdF_4\tTotal_Leakage\tTotal_Torque_Loss\tMFT\tTotal_Mechanical_Power_Loss\tTotal_Volumetric_Power_Loss\t" </span><span class="added-line">+ 		&amp;lt;&amp;lt; "Mechanical_Power_Loss\tVolumetric_Power_Loss\tFSKx\tFSKy\tFAKz\tFKx\tFKy\tFK\tFaK\tFDK\tFwK" &amp;lt;&amp;lt; "\n";</span><span class="unchanged-line">  	fout.close();</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div></div><div class="section"><h3 class="file-title">üìÑ main.h</h3><p><strong>Status:</strong> üü° 1 lines of code were added</p><p><strong>Size:</strong> 201 ‚Üí 221 bytes (+20 bytes)</p><p><strong>Changes:</strong> +1 lines added, -0 lines removed</p><p><strong>Types of Changes:</strong> Functions</p><h4>üîß Code Changes (Separated by Type):</h4><h5>‚ú® Added Code Sections:</h5><div class="function-container"><div class="function-header">‚úÖ Added Section 1 (around line 4)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  </span><span class="unchanged-line">  </span><span class="unchanged-line">  </span><span class="added-line">+ void CreateDirs();</span></div></div></div><div class="section"><h3 class="file-title">üìÑ oil.cpp</h3><p><strong>Status:</strong> üîµ 339 additions and 511 deletions (net reduction of 172 lines)</p><p><strong>Size:</strong> 33,293 ‚Üí 27,229 bytes (-6,064 bytes)</p><p><strong>Changes:</strong> +339 lines added, -511 lines removed</p><p><strong>Types of Changes:</strong> Functions, Comments, Control flow, Variable assignments</p><h4>üîß Code Changes (Separated by Type):</h4><h5>üóëÔ∏è Removed Code Sections:</h5><div class="function-container"><div class="function-header">‚ùå Removed Section 1 (around line 13)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	// read from caspar input</span><span class="unchanged-line">  	lambda = in.data.oil.general.oillambda;</span><span class="unchanged-line">  	C = in.data.oil.general.oilC;</span><span class="removed-line">- 	//CT = in.data.oil.general.oilCT;</span><span class="unchanged-line">  </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 2 (around line 141)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	</span><span class="unchanged-line">  }</span><span class="unchanged-line">  // ------------------------------------------------------------------------- //</span><span class="removed-line">- user_defined2_oil::user_defined2_oil(const input&amp; inp) : oil(inp)</span><span class="removed-line">- {</span><span class="removed-line">- 	</span><span class="removed-line">- 	// read from caspar input</span><span class="removed-line">- </span><span class="removed-line">- 	// copy the domain limits</span><span class="removed-line">- 	p_min_limit = in.data.oil.user_defined.pmin;</span><span class="removed-line">- 	p_max_limit = in.data.oil.user_defined.pmax;</span><span class="removed-line">- 	T_min_limit = in.data.oil.user_defined.Tmin;</span><span class="removed-line">- 	T_max_limit = in.data.oil.user_defined.Tmax;</span><span class="removed-line">- 		</span><span class="removed-line">- 	// copy the coefficients</span><span class="removed-line">- 	/*nuw = in.data.oil.user_defined.w;</span><span class="removed-line">- 	nupf = in.data.oil.user_defined.nupf;</span><span class="removed-line">- 	nup1 = in.data.oil.user_defined.nup1;</span><span class="removed-line">- 	nup2 = in.data.oil.user_defined.nup2;</span><span class="removed-line">- 	nuT1 = in.data.oil.user_defined.nuT1;</span><span class="removed-line">- 	nuT2 = in.data.oil.user_defined.nuT2;</span><span class="removed-line">- 	nuw = in.data.oil.user_defined.w;*/</span><span class="removed-line">- 	</span><span class="removed-line">- 	C_2 = in.data.oil.user_defined.c_2;</span><span class="removed-line">- 	D_2 = in.data.oil.user_defined.d_2;</span><span class="removed-line">- 	G_0 = in.data.oil.user_defined.g_0;</span><span class="removed-line">- 	S_0 = in.data.oil.user_defined.s_0;</span><span class="removed-line">- 	</span><span class="removed-line">- 	rhop1 = in.data.oil.user_defined.rhop1;</span><span class="removed-line">- 	rhop2 = in.data.oil.user_defined.rhop2;</span><span class="removed-line">- 	rhoT = in.data.oil.user_defined.rhoT;</span><span class="removed-line">- 	rhopT = in.data.oil.user_defined.rhopT;</span><span class="removed-line">- 	rhop2T = in.data.oil.user_defined.rhop2T;</span><span class="removed-line">- </span><span class="removed-line">- 	//</span><span class="removed-line">- </span><span class="removed-line">- 	// define the reference values</span><span class="removed-line">- 	p0 = 1.0e5;		// Pa</span><span class="removed-line">- 	T0 = 25;		// C</span><span class="removed-line">- 	rho0 = in.data.oil.user_defined.rho0;	// [kg/m3]</span><span class="removed-line">- </span><span class="removed-line">- </span><span class="removed-line">- }</span><span class="removed-line">- // ------------------------------------------------------------------------- //</span><span class="removed-line">- double user_defined2_oil::get_rho(double _p, double _T)</span><span class="removed-line">- {</span><span class="removed-line">- 	</span><span class="removed-line">- 	// IMPORTANT: T must be in C, p in Pa</span><span class="removed-line">- </span><span class="removed-line">- 	double p = _p, T = _T;</span><span class="removed-line">- </span><span class="removed-line">- 	limit(p, p_min_limit, p_max_limit);</span><span class="removed-line">- 	limit(T, T_min_limit, T_max_limit);</span><span class="removed-line">- </span><span class="removed-line">- 	</span><span class="removed-line">- 	double dp = p - p0;</span><span class="removed-line">- 	double dT = T  - T0;</span><span class="removed-line">- 	// added second degree term </span><span class="removed-line">- 	double rho = rho0*(1 + rhoT*dT + rhop1*dp + rhop2*dp*dp + rhopT*dp*dT+ rhop2T*dp*dp*dT);</span><span class="removed-line">- 		</span><span class="removed-line">- 	return rho;</span><span class="removed-line">- 	</span><span class="removed-line">- }</span><span class="removed-line">- // ------------------------------------------------------------------------- //</span><span class="removed-line">- double user_defined2_oil::get_mu(double _p, double _T)</span><span class="removed-line">- {</span><span class="removed-line">- </span><span class="removed-line">- 	// IMPORTANT: T must be in C, p in Pa</span><span class="removed-line">- 	// The coefficients of nu MUST be derived with mu expressed in cSt!</span><span class="removed-line">- </span><span class="removed-line">- 	double p = _p, T = _T;</span><span class="removed-line">- </span><span class="removed-line">- </span><span class="removed-line">- 	limit(p, p_min_limit, p_max_limit);</span><span class="removed-line">- 	limit(T, T_min_limit, T_max_limit);</span><span class="removed-line">- </span><span class="removed-line">- 	p = p/1.0e5;			// pa to bar</span><span class="removed-line">- 			</span><span class="removed-line">- 	double a = C_2*log10(1+(T/135.0))+D_2;</span><span class="removed-line">- 	double d = pow( (1.0+ (T/135.0) ) , S_0);</span><span class="removed-line">- 	double f = (G_0 * (pow( (1.0+(p/2000.0)) , a) / d) ) - 1.2 ;</span><span class="removed-line">- </span><span class="removed-line">- 	double mu = pow(10, f);	 // cSt</span><span class="removed-line">- 	</span><span class="removed-line">- 	mu = mu * 1.0e-3;		// cP to Pa s</span><span class="removed-line">- </span><span class="removed-line">- 	return mu;</span><span class="removed-line">- 	</span><span class="removed-line">- }</span><span class="removed-line">- // ------------------------------------------------------------------------- //</span><span class="removed-line">- double user_defined2_oil::get_K(double _p, double _T)</span><span class="removed-line">- {</span><span class="removed-line">- 	</span><span class="removed-line">- 	// IMPORTANT: T must be in C, p in Pa</span><span class="removed-line">- 	</span><span class="removed-line">- 	double p = _p, T = _T;</span><span class="removed-line">- </span><span class="removed-line">- 	limit(p, p_min_limit, p_max_limit);</span><span class="removed-line">- 	limit(T, T_min_limit, T_max_limit);</span><span class="removed-line">- </span><span class="removed-line">- 	double dp = p - p0;</span><span class="removed-line">- 	double dT = T - T0;</span><span class="removed-line">- </span><span class="removed-line">- 	double num = 1.0 + rhoT*dT + rhop1*dp + rhop2*dp*dp + rhopT*dp*dT + rhop2T*dp*dp*dT;</span><span class="removed-line">- 	double den = rhop1 + rhopT*dT + 2*rhop2*dp + 2*rhop2T*dp*dT;</span><span class="removed-line">- 	double K = num/den;</span><span class="removed-line">- </span><span class="removed-line">- 	return K;</span><span class="removed-line">- 	</span><span class="removed-line">- }</span><span class="removed-line">- </span><span class="removed-line">- // ------------------------------------------------------------------------- //</span><span class="removed-line">- HLP32_oil::HLP32_oil(const input&amp; inp) : oil(inp)</span><span class="unchanged-line">  {</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 3 (around line 282)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	limit(p, p_min_limit, p_max_limit);</span><span class="unchanged-line">  	limit(T, T_min_limit, T_max_limit);</span><span class="unchanged-line">  </span><span class="removed-line">- 	double TK = T + 273.15;</span><span class="unchanged-line">  	double rho_T = rs*(1 - als*TK); </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 4 (around line 307)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	double p = _p, T = _T;</span><span class="unchanged-line">  	limit(p, p_min_limit, p_max_limit);</span><span class="unchanged-line">  	limit(T, T_min_limit, T_max_limit);</span><span class="removed-line">- 	double TK = T + 273.15;</span><span class="unchanged-line">  	double rs = 1047.03;			// [kg/m3]</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 5 (around line 616)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  // ------------------------------------------------------------------------- //</span><span class="unchanged-line">  double ExxonDTE10Excel32::get_rho(double _p, double _T)</span><span class="unchanged-line">  {</span><span class="removed-line">- 	/*double rho = 0;</span><span class="unchanged-line">  </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 6 (around line 626)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	double p0 = 1e5, T0 = 25;</span><span class="unchanged-line">  	double dT = T - T0, dp = p - p0;</span><span class="unchanged-line">  </span><span class="removed-line">- 	return rho0*(1.0 + rho_T*dT + rho_p*dp + rho_p2*pow(dp,2) + rho_pT*dp*dT + rho_p2T*pow(dp,2)*dT); */</span><span class="removed-line">- </span><span class="removed-line">- 	double mrho,rho,frho,pnew;</span><span class="removed-line">- </span><span class="removed-line">- 	double p = _p, T = _T;</span><span class="removed-line">- 	limit(p, p_min_limit, p_max_limit);</span><span class="removed-line">- 	limit(T, T_min_limit, T_max_limit);</span><span class="removed-line">- </span><span class="removed-line">- 	// reference p and T</span><span class="removed-line">- 	double p0 = 1e5, T0 = 25;</span><span class="removed-line">- 	double dT = T - T0, dp = p - p0;</span><span class="removed-line">- </span><span class="removed-line">- 	mrho = rho0*(1.0 + rho_T*dT + rho_p*dp + rho_p2*pow(dp,2) + rho_pT*dp*dT + rho_p2T*pow(dp,2)*dT); </span><span class="removed-line">- 	</span><span class="removed-line">- 	pnew = p * 1e-9;</span><span class="removed-line">- 	rho = 843.3*(1.0+(0.6*pnew/(1+1.7*pnew)))-0.4742*(T-25);</span><span class="removed-line">- </span><span class="removed-line">- 	if(p &amp;lt; 1100e5)</span><span class="removed-line">- 		frho = mrho;</span><span class="removed-line">- 	else if(p &amp;lt; 1400e5)</span><span class="removed-line">- 		frho = ((p-1100e5)/300.0e5)*rho + (1.0-((p-1100e5)/300.0e5)) * mrho;</span><span class="removed-line">- 	else</span><span class="removed-line">- 		frho = rho;</span><span class="removed-line">- </span><span class="removed-line">- 	return frho; </span><span class="unchanged-line">  </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 7 (around line 677)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	double nu = nu_T + nu_p1*(p - p0) + nu_p2*pow((p - p0), 2.0);</span><span class="unchanged-line">  </span><span class="unchanged-line">  	// return the viscosity in Pas</span><span class="removed-line">- 	return 1e-6*nu*get_rho(p,T);*/</span><span class="removed-line">- </span><span class="removed-line">- 	double mmu,mu,fmu,den,num;</span><span class="removed-line">- </span><span class="removed-line">- 	// IMPORTANT: T must be in C, p in Pa</span><span class="removed-line">- 	// The coefficients of nu MUST be derived with mu expressed in cSt!</span><span class="removed-line">- </span><span class="removed-line">- 	double p = _p, T = _T;</span><span class="removed-line">- 	limit(p, p_min_limit, p_max_limit);</span><span class="removed-line">- 	limit(T, T_min_limit, T_max_limit);</span><span class="removed-line">- </span><span class="removed-line">- 	// reference p </span><span class="removed-line">- 	double p0 = 1e5;</span><span class="removed-line">- 	double Tlog = log10(T);</span><span class="removed-line">- </span><span class="removed-line">- 	double nu_T = pow(10.0, nu_T0 + nu_T1*Tlog);</span><span class="removed-line">- 	double nu_p1 = pow(10.0, nu_p10 + nu_p11*Tlog + nu_p12*pow(Tlog,2.0));</span><span class="removed-line">- 	double nu_p2 = pow(10.0, nu_p20 + nu_p21*Tlog + nu_p22*pow(Tlog,2.0));</span><span class="removed-line">- </span><span class="removed-line">- 	// this is nu in cSt</span><span class="removed-line">- 	double nu = nu_T + nu_p1*(p - p0) + nu_p2*pow((p - p0), 2.0);</span><span class="removed-line">- </span><span class="removed-line">- 	// return the viscosity in Pas</span><span class="removed-line">- 	mmu = 1e-6*nu*get_rho(p,T);</span><span class="removed-line">- 	</span><span class="removed-line">- 	num = pow(1.0+p/1.96133e8,0.6051);</span><span class="removed-line">- 	den = pow(1.0+T/135.0,1.038);</span><span class="removed-line">- 	mu = pow(10.0,3.421*(num/den)-4.2);</span><span class="removed-line">- </span><span class="removed-line">- 	if(p &amp;lt; 1100e5)</span><span class="removed-line">- 		fmu = mmu;</span><span class="removed-line">- 	else if(p &amp;lt; 1400e5)</span><span class="removed-line">- 		fmu = ((p-1100e5)/300.0e5)*mu + (1.0-((p-1100e5)/300.0e5)) * mmu;</span><span class="removed-line">- 	else</span><span class="removed-line">- 		fmu = mu;</span><span class="removed-line">- </span><span class="removed-line">- 	return fmu;</span><span class="removed-line">- </span><span class="unchanged-line">  }</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 8 (around line 732)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	double rho = get_rho(p,T);</span><span class="unchanged-line">  	double drho_dp = rho0*(rho_p + 2.0*rho_p2*dp + rho_pT*dT + 2.0*rho_p2T*dp*dT);</span><span class="unchanged-line">  </span><span class="removed-line">- 	return (rho/drho_dp);*/</span><span class="removed-line">- </span><span class="removed-line">- 	</span><span class="removed-line">- 	double K,pnew;</span><span class="removed-line">- </span><span class="removed-line">- 	double p = _p, T = _T;</span><span class="removed-line">- 	limit(p, p_min_limit, p_max_limit);</span><span class="removed-line">- 	limit(T, T_min_limit, T_max_limit);</span><span class="removed-line">- 	</span><span class="removed-line">- 	double p0 = 1e5, T0 = 25;</span><span class="removed-line">- 	double dT = T - T0, dp = p - p0;</span><span class="removed-line">- </span><span class="removed-line">- 	// K = rho/(drho/dp)_T</span><span class="removed-line">- 	double mrho = get_rho(p,T);</span><span class="removed-line">- 	double mdrho_dp = rho0*(rho_p + 2.0*rho_p2*dp + rho_pT*dT + 2.0*rho_p2T*dp*dT);</span><span class="removed-line">- </span><span class="removed-line">- 	pnew = p * 1e-9;</span><span class="removed-line">- 	// K = rho/(drho/dp)_T</span><span class="removed-line">- 	double rho = get_rho(pnew,T);</span><span class="removed-line">- 	double drho_dp = 175.08/pow(pnew+0.588235,2.0);</span><span class="removed-line">- </span><span class="removed-line">- 	if(p &amp;lt; 1100e5)</span><span class="removed-line">- 		K = mrho/mdrho_dp;</span><span class="removed-line">- 	else if(p &amp;lt; 1400e5)</span><span class="removed-line">- 		K = ((p-1100e5)/300.0e5)*(rho/drho_dp) + (1.0-((p-1100e5)/300.0e5)) * (mrho/mdrho_dp);</span><span class="removed-line">- 	else</span><span class="removed-line">- 		K = rho/drho_dp;</span><span class="unchanged-line">  </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 9 (around line 873)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  </span><span class="unchanged-line">  	double DynamicViscosity=(Mu.p00 + Mu.p10*Mu.x + Mu.p01*Mu.y + Mu.p20*pow(Mu.x,2) + Mu.p11*Mu.x*Mu.y + Mu.p02*pow(Mu.y,2) + Mu.p30*pow(Mu.x,3) + Mu.p21*pow(Mu.x,2)*Mu.y + Mu.p12*Mu.x*pow(Mu.y,2) + Mu.p03*pow(Mu.y,3) + Mu.p40*pow(Mu.x,4) + Mu.p31*pow(Mu.x,3)*Mu.y + Mu.p22*pow(Mu.x,2)*pow(Mu.y,2) + Mu.p13*Mu.x*pow(Mu.y,3) + Mu.p50*pow(Mu.x,5) + Mu.p41*pow(Mu.x,4)*Mu.y + Mu.p32*pow(Mu.x,3)*pow(Mu.y,2) + Mu.p23*pow(Mu.x,2)*pow(Mu.y,3))*1e-6;</span><span class="unchanged-line">  	return DynamicViscosity;</span><span class="removed-line">- }</span><span class="removed-line">- // ------------------------------------------------------------------------- //</span><span class="removed-line">- // ------------------------------------------------------------------------- //</span><span class="removed-line">- ISO46_oil::ISO46_oil(const input&amp; in) : oil(in)</span><span class="unchanged-line">  {</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 10 (around line 931)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	double drhodp = rho_T*PR1/pow((PR2*p+1),2.0);</span><span class="unchanged-line">  	return get_rho(_p,_T)*1.0/drhodp;</span><span class="unchanged-line">  }</span><span class="removed-line">- </span><span class="removed-line">- </span><span class="unchanged-line">  Parker_skydrol_oil::Parker_skydrol_oil(const input&amp; inp) : oil(inp)</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 11 (around line 1023)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	//**************************** Begin Parker Code *******************************//</span><span class="unchanged-line">  </span><span class="unchanged-line">  </span><span class="removed-line">- 	//Adiabatic tangent bulk modulus</span><span class="removed-line">- 	//valid for type 4 phosphate ester fluid per AS1241</span><span class="removed-line">- </span><span class="removed-line">- 	//Convert C to F</span><span class="removed-line">- 	cK.T_degF = Tw * 9/5 + 32;</span><span class="removed-line">- </span><span class="removed-line">- 	//Convert Pa to psi</span><span class="removed-line">- 	cK.p_psi = pw * 1e-5 * 14.504;</span><span class="removed-line">- </span><span class="removed-line">- 	if (cK.T_degF &amp;gt; 75)</span><span class="removed-line">- 	{</span><span class="removed-line">- 		BE1 = (-0.0000003593732 * cK.p_psi - 0.008160747) * pow(cK.T_degF,3);</span><span class="removed-line">- 		BE2 = (0.0002268273 * cK.p_psi + 6.395661) * pow(cK.T_degF,2);</span><span class="removed-line">- 		BE3 = (-0.06115304 * cK.p_psi - 1862.197) * cK.T_degF;</span><span class="removed-line">- 		BE4 = (24.15663 * cK.p_psi + 305663.3);</span><span class="removed-line">- 		B = BE1 + BE2 + BE3 + BE4;</span><span class="removed-line">- 	}</span><span class="removed-line">- 	else</span><span class="removed-line">- 	{</span><span class="removed-line">- 	  slope = -0.03318917 * cK.p_psi - 1040.634;</span><span class="removed-line">- 	  BATP75 = (-0.0000003593732 * cK.p_psi - 0.008160747) * pow(75.0,3) + (0.0002268273 * cK.p_psi + 6.395661) * pow(75.0,2) + (-0.06115304 * cK.p_psi - 1862.197) * 75 + (24.15663 * cK.p_psi + 305663.3);</span><span class="removed-line">- 	  YINTP0 = BATP75 - slope * 75;</span><span class="removed-line">- 	  B = slope * cK.T_degF + YINTP0;	//psi</span><span class="removed-line">- 	}</span><span class="removed-line">- </span><span class="removed-line">- 	K = B / 14.504 * 1e5; //Pascal</span><span class="unchanged-line">  </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 12 (around line 1069)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	</span><span class="unchanged-line">  	//**************************** Begin Parker Code *******************************//</span><span class="unchanged-line">  </span><span class="removed-line">- 	//KINEMATIC VISCOSITY</span><span class="removed-line">- </span><span class="removed-line">-     //Fitting function is:  LOG LOG (v + .6) = A - B*LOG(T + 459.69) (MacCoull viscosity-temperature equation)</span><span class="removed-line">-     //where v = kinematic viscosity, cs; T = temperature in degF</span><span class="removed-line">-     //Pressure effect on viscosity is then taken into account with the Barus Equation:</span><span class="removed-line">-     //vp = v0 e^(2.3(alpha)^a(P)(10^4))</span><span class="removed-line">- 	</span><span class="removed-line">-     //Convert C to F</span><span class="removed-line">-     cnu.T_degF = Tw * 9/5 + 32;</span><span class="removed-line">- </span><span class="removed-line">-     //Convert Pa to psi</span><span class="removed-line">-     cnu.p_psi = pw * 1e-5 * 14.504;</span><span class="removed-line">- </span><span class="removed-line">-     //Calculate 1 Atm Viscosity</span><span class="removed-line">-     V0 = pow(10,pow(10,(cnu.A - cnu.B* log10(cnu.T_degF + 460)))) - 0.6;   </span><span class="removed-line">- </span><span class="removed-line">-     //Correct for pressure</span><span class="removed-line">-     KlauseA = 3.23523 - 11.3886 * cnu.C + 13.1735 * pow(cnu.C,2) - 4.8881 * pow(cnu.C,3);</span><span class="removed-line">-     KlauseB = -5.33425 + 19.9521 * cnu.C - 23.9448 * pow(cnu.C,2) + 10.155 * pow(cnu.C,3);</span><span class="removed-line">-     KlauseC = 3.35452 - 13.1273 * cnu.C + 17.1712 * pow(cnu.C,2) - 7.6551 * pow(cnu.C,3);</span><span class="removed-line">-     alpha = KlauseA + KlauseB * log10(V0) + KlauseC * pow((log10(V0)),2);</span><span class="removed-line">-     Kin_Vis = V0 * exp(2.3 * pow(alpha,(560 / (cnu.T_degF + 460))) * cnu.p_psi * 0.0001); //cSt</span><span class="unchanged-line">  			</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><h5>‚ú® Added Code Sections:</h5><div class="function-container"><div class="function-header">‚úÖ Added Section 1 (around line 140)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	</span><span class="unchanged-line">  }</span><span class="unchanged-line">  // ------------------------------------------------------------------------- //</span><span class="added-line">+ /*HLP32_oil::HLP32_oil(const input&amp; inp) : oil(inp)</span><span class="unchanged-line">  {</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 2 (around line 172)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	limit(p, p_min_limit, p_max_limit);</span><span class="unchanged-line">  	limit(T, T_min_limit, T_max_limit);</span><span class="unchanged-line">  </span><span class="added-line">+ 	double TK = _T + 273.15;</span><span class="unchanged-line">  	double rho_T = rs*(1 - als*TK); </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 3 (around line 197)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	double p = _p, T = _T;</span><span class="unchanged-line">  	limit(p, p_min_limit, p_max_limit);</span><span class="unchanged-line">  	limit(T, T_min_limit, T_max_limit);</span><span class="added-line">+ 	</span><span class="unchanged-line">  	double rs = 1047.03;			// [kg/m3]</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 4 (around line 239)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  // ------------------------------------------------------------------------- //</span><span class="unchanged-line">  double ExxonDTE10Excel32::get_rho(double _p, double _T)</span><span class="unchanged-line">  {</span><span class="added-line">+ 	double rho = 0;</span><span class="unchanged-line">  </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 5 (around line 249)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	double p0 = 1e5, T0 = 25;</span><span class="unchanged-line">  	double dT = T - T0, dp = p - p0;</span><span class="unchanged-line">  </span><span class="added-line">+ 	return rho0*(1.0 + rho_T*dT + rho_p*dp + rho_p2*pow(dp,2) + rho_pT*dp*dT + rho_p2T*pow(dp,2)*dT); </span><span class="unchanged-line">  </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 6 (around line 276)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	double nu = nu_T + nu_p1*(p - p0) + nu_p2*pow((p - p0), 2.0);</span><span class="unchanged-line">  </span><span class="unchanged-line">  	// return the viscosity in Pas</span><span class="added-line">+ 	return 1e-6*nu*get_rho(p,T);</span><span class="unchanged-line">  }</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 7 (around line 294)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	double rho = get_rho(p,T);</span><span class="unchanged-line">  	double drho_dp = rho0*(rho_p + 2.0*rho_p2*dp + rho_pT*dT + 2.0*rho_p2T*dp*dT);</span><span class="unchanged-line">  </span><span class="added-line">+ 	return (rho/drho_dp);</span><span class="added-line">+ }</span><span class="added-line">+ // ------------------------------------------------------------------------- //</span><span class="added-line">+ skydrol_oil::skydrol_oil(const input&amp; inp) : oil(inp)</span><span class="added-line">+ {</span><span class="added-line">+ 	// define the domain limits</span><span class="added-line">+ 	p_min_limit = 0.9e5;</span><span class="added-line">+ 	p_max_limit = 1000e5;</span><span class="added-line">+ 	T_min_limit = -50;</span><span class="added-line">+ 	T_max_limit = 140;</span><span class="added-line">+ </span><span class="added-line">+ 	// reference values</span><span class="added-line">+ 	p0 = 0;</span><span class="added-line">+ 	T0 = 293.0;					// K (20 C)</span><span class="added-line">+ 	rho0 = 1008.0;			// Kg/m3</span><span class="added-line">+ </span><span class="added-line">+ 	// viscosity coeffs</span><span class="added-line">+ 	cnu.p1 = 3.0649e-6;		</span><span class="added-line">+ 	cnu.p2 = -8.5688e-1;		</span><span class="added-line">+ 	cnu.T1 = 7.69698;			</span><span class="added-line">+ 	cnu.T2 = -3.07574;	</span><span class="added-line">+ 	cnu.w = 0.85;</span><span class="added-line">+ 	</span><span class="added-line">+ 	// density coeffs</span><span class="added-line">+ 	crho.T = -7.9365e-4;</span><span class="added-line">+ 	crho.p1 = 7.2993e-10;</span><span class="added-line">+ 	crho.p2 = -1.2951e-18;</span><span class="added-line">+ 	crho.pT = 3.9360e-12;</span><span class="added-line">+ </span><span class="added-line">+ }</span><span class="added-line">+ // ------------------------------------------------------------------------- //</span><span class="added-line">+ double skydrol_oil::get_rho(double _p, double _T)</span><span class="added-line">+ {</span><span class="added-line">+ </span><span class="added-line">+ 	// IMPORTANT: T must be in C, p in Pa</span><span class="added-line">+ </span><span class="added-line">+ 	double pw = _p, Tw = _T;</span><span class="added-line">+ 	</span><span class="added-line">+ 	limit(pw, p_min_limit, p_max_limit);</span><span class="added-line">+ 	limit(Tw, T_min_limit, T_max_limit);</span><span class="added-line">+ </span><span class="added-line">+ 	double dp = pw - p0;</span><span class="added-line">+ 	double dT = (Tw + 273.0) - T0;</span><span class="added-line">+ </span><span class="added-line">+ 	double rho = rho0*(1 + crho.T*dT + crho.p1*dp + crho.p2*dp*dp + crho.pT*dp*dT);</span><span class="added-line">+ 		</span><span class="added-line">+ 	return rho;</span><span class="added-line">+ }</span><span class="added-line">+ // ------------------------------------------------------------------------- //</span><span class="added-line">+ double skydrol_oil::get_K(double _p, double _T)</span><span class="added-line">+ {</span><span class="added-line">+ </span><span class="added-line">+ 	// IMPORTANT: T must be in C, p in Pa</span><span class="added-line">+ </span><span class="added-line">+ 	double pw = _p, Tw = _T;</span><span class="added-line">+ 	</span><span class="added-line">+ 	limit(pw, p_min_limit, p_max_limit);</span><span class="added-line">+ 	limit(Tw, T_min_limit, T_max_limit);</span><span class="added-line">+ 	</span><span class="added-line">+ 	double dp = pw - p0;</span><span class="added-line">+ 	double dT = (Tw + 273.0) - T0;</span><span class="added-line">+ </span><span class="added-line">+ 	double num = 1.0 + crho.T*dT + crho.p1*dp + crho.p2*dp*dp + crho.pT*dp*dT;</span><span class="added-line">+ 	double den = crho.p1 + crho.pT*dT + 2*crho.p2*dp;</span><span class="added-line">+ 	double K = num/den;</span><span class="unchanged-line">  </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 8 (around line 737)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  </span><span class="unchanged-line">  	double DynamicViscosity=(Mu.p00 + Mu.p10*Mu.x + Mu.p01*Mu.y + Mu.p20*pow(Mu.x,2) + Mu.p11*Mu.x*Mu.y + Mu.p02*pow(Mu.y,2) + Mu.p30*pow(Mu.x,3) + Mu.p21*pow(Mu.x,2)*Mu.y + Mu.p12*Mu.x*pow(Mu.y,2) + Mu.p03*pow(Mu.y,3) + Mu.p40*pow(Mu.x,4) + Mu.p31*pow(Mu.x,3)*Mu.y + Mu.p22*pow(Mu.x,2)*pow(Mu.y,2) + Mu.p13*Mu.x*pow(Mu.y,3) + Mu.p50*pow(Mu.x,5) + Mu.p41*pow(Mu.x,4)*Mu.y + Mu.p32*pow(Mu.x,3)*pow(Mu.y,2) + Mu.p23*pow(Mu.x,2)*pow(Mu.y,3))*1e-6;</span><span class="unchanged-line">  	return DynamicViscosity;</span><span class="added-line">+ }*/</span><span class="added-line">+ ISO46_oil::ISO46_oil(const input&amp; inp) : oil(inp)</span><span class="unchanged-line">  {</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 9 (around line 793)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	double drhodp = rho_T*PR1/pow((PR2*p+1),2.0);</span><span class="unchanged-line">  	return get_rho(_p,_T)*1.0/drhodp;</span><span class="unchanged-line">  }</span><span class="added-line">+ // ------------------------------------------------------------------------- //</span><span class="unchanged-line">  Parker_skydrol_oil::Parker_skydrol_oil(const input&amp; inp) : oil(inp)</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 10 (around line 809)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	</span><span class="unchanged-line">  </span><span class="unchanged-line">  </span><span class="added-line">+ //**************************** Begin Parker Code *******************************//</span><span class="added-line">+ 	    //Reference temperature and pressure</span><span class="added-line">+         tref = 100; //F</span><span class="added-line">+         pref = 0;	//psi</span><span class="added-line">+ </span><span class="added-line">+ 			//  Specific gravity coefficients for Skydrol LD-4</span><span class="added-line">+         crho.A = -0.000465142;</span><span class="added-line">+         crho.B = 1.04679;</span><span class="added-line">+ </span><span class="added-line">+ 		// Viscosity coefficients for Skydrol LD-4</span><span class="added-line">+         cnu.A = 8.57158850327909;</span><span class="added-line">+         cnu.B = 3.10174401619516;</span><span class="added-line">+         cnu.C = 0.60556845;</span><span class="added-line">+ </span><span class="added-line">+ //**************************** End Parker Code *******************************//</span><span class="added-line">+ </span><span class="added-line">+ }</span><span class="added-line">+ // ------------------------------------------------------------------------- //</span><span class="added-line">+ double Parker_skydrol_oil::get_rho(double p, double T)</span><span class="added-line">+ {</span><span class="added-line">+ </span><span class="added-line">+ 	// IMPORTANT: T must be in C, p in Pa</span><span class="added-line">+ </span><span class="added-line">+ 	double pw = p, Tw = T;</span><span class="added-line">+ </span><span class="added-line">+ 	limit(pw, p_min_limit, p_max_limit);</span><span class="added-line">+ 	limit(Tw, T_min_limit, T_max_limit);</span><span class="added-line">+ </span><span class="added-line">+ 	</span><span class="added-line">+ </span><span class="unchanged-line">  	//**************************** Begin Parker Code *******************************//</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 11 (around line 884)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	//**************************** Begin Parker Code *******************************//</span><span class="unchanged-line">  </span><span class="unchanged-line">  </span><span class="added-line">+ //Adiabatic tangent bulk modulus</span><span class="added-line">+ //valid for type 4 phosphate ester fluid per AS1241</span><span class="added-line">+ </span><span class="added-line">+ //Convert C to F</span><span class="added-line">+ cK.T_degF = T * 9/5 + 32;</span><span class="added-line">+ </span><span class="added-line">+ //Convert Pa to psi</span><span class="added-line">+ cK.p_psi = p * 1e-5 * 14.504;</span><span class="added-line">+ </span><span class="added-line">+ if (cK.T_degF &amp;gt; 75)</span><span class="added-line">+ {</span><span class="added-line">+     BE1 = (-0.0000003593732 * cK.p_psi - 0.008160747) * pow(cK.T_degF,3);</span><span class="added-line">+     BE2 = (0.0002268273 * cK.p_psi + 6.395661) * pow(cK.T_degF,2);</span><span class="added-line">+     BE3 = (-0.06115304 * cK.p_psi - 1862.197) * cK.T_degF;</span><span class="added-line">+     BE4 = (24.15663 * cK.p_psi + 305663.3);</span><span class="added-line">+     B = BE1 + BE2 + BE3 + BE4;</span><span class="added-line">+ }</span><span class="added-line">+ else</span><span class="added-line">+ {</span><span class="added-line">+   slope = -0.03318917 * cK.p_psi - 1040.634;</span><span class="added-line">+   BATP75 = (-0.0000003593732 * cK.p_psi - 0.008160747) * pow(75.0,3) + (0.0002268273 * cK.p_psi + 6.395661) * pow(75.0,2) + (-0.06115304 * cK.p_psi - 1862.197) * 75 + (24.15663 * cK.p_psi + 305663.3);</span><span class="added-line">+   YINTP0 = BATP75 - slope * 75;</span><span class="added-line">+   B = slope * cK.T_degF + YINTP0;	//psi</span><span class="added-line">+ }</span><span class="added-line">+ </span><span class="added-line">+ K = B / 14.504 * 1e5; //Pascal</span><span class="unchanged-line">  </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 12 (around line 930)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	</span><span class="unchanged-line">  	//**************************** Begin Parker Code *******************************//</span><span class="unchanged-line">  </span><span class="added-line">+ 	  //KINEMATIC VISCOSITY</span><span class="added-line">+ </span><span class="added-line">+         //Fitting function is:  LOG LOG (v + .6) = A - B*LOG(T + 459.69) (MacCoull viscosity-temperature equation)</span><span class="added-line">+         //where v = kinematic viscosity, cs; T = temperature in degF</span><span class="added-line">+         //Pressure effect on viscosity is then taken into account with the Barus Equation:</span><span class="added-line">+         //vp = v0 e^(2.3(alpha)^a(P)(10^4))</span><span class="added-line">+ 	</span><span class="added-line">+         //Convert C to F</span><span class="added-line">+          cnu.T_degF = T * 9/5 + 32;</span><span class="added-line">+ </span><span class="added-line">+         //Convert Pa to psi</span><span class="added-line">+          cnu.p_psi = p * 1e-5 * 14.504;</span><span class="added-line">+ </span><span class="added-line">+         //Calculate 1 Atm Viscosity</span><span class="added-line">+          V0 = pow(10,pow(10,(cnu.A - cnu.B* log10(cnu.T_degF + 460)))) - 0.6;   </span><span class="added-line">+ </span><span class="added-line">+         //Correct for pressure</span><span class="added-line">+          KlauseA = 3.23523 - 11.3886 * cnu.C + 13.1735 * pow(cnu.C,2) - 4.8881 * pow(cnu.C,3);</span><span class="added-line">+          KlauseB = -5.33425 + 19.9521 * cnu.C - 23.9448 * pow(cnu.C,2) + 10.155 * pow(cnu.C,3);</span><span class="added-line">+          KlauseC = 3.35452 - 13.1273 * cnu.C + 17.1712 * pow(cnu.C,2) - 7.6551 * pow(cnu.C,3);</span><span class="added-line">+          alpha = KlauseA + KlauseB * log10(V0) + KlauseC * pow((log10(V0)),2);</span><span class="added-line">+          Kin_Vis = V0 * exp(2.3 * pow(alpha,(560 / (cnu.T_degF + 460))) * cnu.p_psi * 0.0001); //cSt</span><span class="unchanged-line">  			</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div></div><div class="section"><h3 class="file-title">üìÑ oil.h</h3><p><strong>Status:</strong> üîµ 34 additions and 81 deletions (net reduction of 47 lines)</p><p><strong>Size:</strong> 8,419 ‚Üí 7,207 bytes (-1,212 bytes)</p><p><strong>Changes:</strong> +34 lines added, -81 lines removed</p><p><strong>Types of Changes:</strong> Class/Struct definitions, Functions, Include statements, Comments, Variable assignments</p><h4>üîß Code Changes (Separated by Type):</h4><h5>üóëÔ∏è Removed Code Sections:</h5><div class="function-container"><div class="function-header">‚ùå Removed Section 1 (around line 1)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  # ifndef __oil__</span><span class="unchanged-line">  # define __oil__</span><span class="unchanged-line">  </span><span class="removed-line">- #include "../../caspar_input/input.h"</span><span class="unchanged-line">  </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 2 (around line 18)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	double T_max_limit;</span><span class="unchanged-line">  </span><span class="unchanged-line">  	double lambda;		// thermal conductivity [W/m2]</span><span class="removed-line">- 	double C;					// heat capacity [J/kgK] (enthalpy change with respect to temperature)</span><span class="removed-line">- 	//double CT;					// enthalpy change with respect to pressure</span><span class="unchanged-line">  </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 3 (around line 81)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	double get_K(double p, double T);</span><span class="unchanged-line">  </span><span class="unchanged-line">  };</span><span class="removed-line">- </span><span class="removed-line">- // ------------------------------------------------------------------------- //</span><span class="removed-line">- // oil with user defined properties</span><span class="removed-line">- // NEW for Daniel Hasko 09 28 2016 change made by Rene Chacon</span><span class="removed-line">- class user_defined2_oil : public oil</span><span class="removed-line">- {</span><span class="removed-line">- 	// reference values</span><span class="removed-line">- 	double p0;</span><span class="removed-line">- 	double T0;</span><span class="removed-line">- 	double rho0;</span><span class="removed-line">- </span><span class="removed-line">- 	// coefficients</span><span class="removed-line">- 	//double nuw;</span><span class="removed-line">- 	//int nupf;</span><span class="removed-line">- 	//double nup1;</span><span class="removed-line">- 	//double nup2;</span><span class="removed-line">- 	//double nuT1;</span><span class="removed-line">- 	//double nuT2;</span><span class="removed-line">- 	</span><span class="removed-line">- 	// Roelands eq empirical coefficients:  (added by Rene Chacon 09 28 2016)</span><span class="removed-line">- 	double C_2;</span><span class="removed-line">- 	double D_2;</span><span class="removed-line">- 	double S_0;</span><span class="removed-line">- 	double G_0;</span><span class="removed-line">- 	//</span><span class="removed-line">- 	double nuT2;</span><span class="removed-line">- 	double rhop1;</span><span class="removed-line">- 	double rhop2;</span><span class="removed-line">- 	double rhoT;</span><span class="removed-line">- 	double rhopT;</span><span class="removed-line">- 	double rhop2T;  // NEW second degree term coefficient</span><span class="removed-line">- </span><span class="removed-line">- public:</span><span class="removed-line">- </span><span class="removed-line">- 	user_defined2_oil(const input&amp; in);</span><span class="removed-line">- </span><span class="removed-line">- 	double get_rho(double p, double T);</span><span class="removed-line">- 	double get_mu(double p, double T);</span><span class="removed-line">- 	double get_K(double p, double T);</span><span class="removed-line">- </span><span class="removed-line">- };</span><span class="removed-line">- </span><span class="unchanged-line">  // HLP32 oil</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 4 (around line 202)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	double get_K(double p, double T);</span><span class="unchanged-line">  </span><span class="unchanged-line">  };</span><span class="removed-line">- </span><span class="unchanged-line">  // ------------------------------------------------------------------------- //</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 5 (around line 254)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  public:</span><span class="unchanged-line">  </span><span class="unchanged-line">  	milh5606_oil(const input&amp; in);</span><span class="removed-line">- 	double get_rho(double p, double T);</span><span class="removed-line">- 	double get_mu(double p, double T);</span><span class="removed-line">- 	double get_K(double p, double T);</span><span class="removed-line">- </span><span class="removed-line">- };</span><span class="removed-line">- </span><span class="removed-line">- class ExxonDTE10Excel32 : public oil</span><span class="removed-line">- {</span><span class="removed-line">- </span><span class="removed-line">- 	// density/bulk modulus</span><span class="removed-line">- 	double rho0;</span><span class="removed-line">- </span><span class="removed-line">- 	double rho_p, rho_p2;</span><span class="removed-line">- 	double rho_T;</span><span class="removed-line">- 	double rho_pT, rho_p2T;</span><span class="removed-line">- </span><span class="removed-line">- 	// viscosity</span><span class="removed-line">- 	double nu_T0, nu_T1;</span><span class="removed-line">- 	double nu_p10, nu_p11, nu_p12;</span><span class="removed-line">- 	double nu_p20, nu_p21, nu_p22;</span><span class="removed-line">- </span><span class="removed-line">- public:</span><span class="removed-line">- </span><span class="removed-line">- 	ExxonDTE10Excel32(const input&amp; in);</span><span class="unchanged-line">  	double get_rho(double p, double T);</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 6 (around line 352)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	double get_rho(double p, double T);</span><span class="unchanged-line">  	double get_mu(double p, double T);</span><span class="unchanged-line">  	double get_K(double p, double T);</span><span class="removed-line">- };</span><span class="removed-line">- </span><span class="unchanged-line">  class ISO46_oil : public oil</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 7 (around line 376)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	double get_K(double p, double T);</span><span class="unchanged-line">  </span><span class="unchanged-line">  };</span><span class="removed-line">- </span><span class="unchanged-line">  class Parker_skydrol_oil : public oil</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 8 (around line 419)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  </span><span class="unchanged-line">  public:</span><span class="unchanged-line">  </span><span class="removed-line">- 	Parker_skydrol_oil(const input&amp; in);</span><span class="removed-line">- 	double get_C(double T = 0) { return C; }</span><span class="removed-line">- 	//double get_CT(double T = 0) { return CT; }</span><span class="removed-line">- 	double get_lambda(double T = 0) { return lambda; }</span><span class="unchanged-line">  	double get_rho(double p, double T);</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><h5>‚ú® Added Code Sections:</h5><div class="function-container"><div class="function-header">‚úÖ Added Section 1 (around line 1)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  # ifndef __oil__</span><span class="unchanged-line">  # define __oil__</span><span class="unchanged-line">  </span><span class="added-line">+ # include "../../caspar_input/input.h"</span><span class="unchanged-line">  </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 2 (around line 18)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	double T_max_limit;</span><span class="unchanged-line">  </span><span class="unchanged-line">  	double lambda;		// thermal conductivity [W/m2]</span><span class="added-line">+ 	double C;					// heat capacity [J/kgK]</span><span class="unchanged-line">  </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 3 (around line 106)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	double get_K(double p, double T);</span><span class="unchanged-line">  </span><span class="unchanged-line">  };</span><span class="added-line">+ // ------------------------------------------------------------------------- //</span><span class="added-line">+ class ExxonDTE10Excel32 : public oil</span><span class="added-line">+ {</span><span class="added-line">+ </span><span class="added-line">+ 	// density/bulk modulus</span><span class="added-line">+ 	double rho0;</span><span class="added-line">+ </span><span class="added-line">+ 	double rho_p, rho_p2;</span><span class="added-line">+ 	double rho_T;</span><span class="added-line">+ 	double rho_pT, rho_p2T;</span><span class="added-line">+ </span><span class="added-line">+ 	// viscosity</span><span class="added-line">+ 	double nu_T0, nu_T1;</span><span class="added-line">+ 	double nu_p10, nu_p11, nu_p12;</span><span class="added-line">+ 	double nu_p20, nu_p21, nu_p22;</span><span class="added-line">+ </span><span class="added-line">+ public:</span><span class="added-line">+ </span><span class="added-line">+ 	ExxonDTE10Excel32(const input&amp; in);</span><span class="added-line">+ 	double get_rho(double p, double T);</span><span class="added-line">+ 	double get_mu(double p, double T);</span><span class="added-line">+ 	double get_K(double p, double T);</span><span class="added-line">+ </span><span class="added-line">+ };</span><span class="added-line">+ // ------------------------------------------------------------------------- //</span><span class="added-line">+ </span><span class="unchanged-line">  // skydrol oil</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 4 (around line 293)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	double get_rho(double p, double T);</span><span class="unchanged-line">  	double get_mu(double p, double T);</span><span class="unchanged-line">  	double get_K(double p, double T);</span><span class="added-line">+ };*/</span><span class="unchanged-line">  class ISO46_oil : public oil</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 5 (around line 360)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  </span><span class="unchanged-line">  public:</span><span class="unchanged-line">  </span><span class="added-line">+ 	Parker_skydrol_oil(const input&amp; inp);</span><span class="unchanged-line">  	double get_rho(double p, double T);</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div></div><div class="section"><h3 class="file-title">üìÑ sGapResult.h</h3><p><strong>Status:</strong> üî¥ 3 lines of code were removed</p><p><strong>Size:</strong> 938 ‚Üí 805 bytes (-133 bytes)</p><p><strong>Changes:</strong> +0 lines added, -3 lines removed</p><p><strong>Types of Changes:</strong> Include statements, Comments</p><h4>üîß Code Changes (Separated by Type):</h4><h5>üóëÔ∏è Removed Code Sections:</h5><div class="function-container"><div class="function-header">‚ùå Removed Section 1 (around line 1)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  #pragma once</span><span class="removed-line">- #include &amp;lt;blitz\array.h&amp;gt;</span><span class="unchanged-line">  </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 2 (around line 21)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	vector&amp;lt;double&amp;gt; MSKTot;			//Total torque loss from pistons [Nm]</span><span class="unchanged-line">  	vector&amp;lt;double&amp;gt; MFT;				//Total torque loss due to pistons spin in chamber [Nm]</span><span class="unchanged-line">  	vector&amp;lt;double&amp;gt; PhiD_mech;			//Total energy dissipated [W]</span><span class="removed-line">- 	Array&amp;lt;double,1&amp;gt; PhiD_mech_2d;		//Spatial distribution of enegrgy dissipation [W]</span><span class="unchanged-line">  	vector&amp;lt;double&amp;gt; PhiD_vol;			//Total energy dissipated [W]</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div></div><div class="section"><h3>‚ú® New Files in v_3.2.0 (1 files)</h3><ul><li><strong>version_define.h</strong> - ‚ú® New file in v_3.2.0 (93 bytes)</li></ul></div><div class="section"><h3>üóëÔ∏è Files Removed from v_2.0.0 (1 files)</h3><ul><li><strong>CPistonGapHD.cpp</strong> - üóëÔ∏è File removed in v_3.2.0 (71,633 bytes)</li></ul></div><div class="section"><h3>‚úÖ Identical Files (No Changes) (13 files)</h3><ul><li><strong>CGapInput.h</strong> - ‚úÖ No changes (11,035 bytes)</li><li><strong>CGapODE.cpp.BACKUP.5236.cpp</strong> - ‚úÖ No changes (33,705 bytes)</li><li><strong>CGapODE.cpp.BASE.5236.cpp</strong> - ‚úÖ No changes (32,827 bytes)</li><li><strong>CGapODE.cpp.LOCAL.5236.cpp</strong> - ‚úÖ No changes (33,087 bytes)</li><li><strong>CGapODE.cpp.REMOTE.5236.cpp</strong> - ‚úÖ No changes (33,143 bytes)</li><li><strong>CGapODE.h</strong> - ‚úÖ No changes (2,006 bytes)</li><li><strong>CGapUtils.cpp</strong> - ‚úÖ No changes (3,020 bytes)</li><li><strong>CGapUtils.h</strong> - ‚úÖ No changes (627 bytes)</li><li><strong>CNewtonIteration.h</strong> - ‚úÖ No changes (2,186 bytes)</li><li><strong>CPressure.h</strong> - ‚úÖ No changes (9,851 bytes)</li><li><strong>Coupled.h</strong> - ‚úÖ No changes (197 bytes)</li><li><strong>fsti_netlic_client.h</strong> - ‚úÖ No changes (288 bytes)</li><li><strong>logger.cpp</strong> - ‚úÖ No changes (34 bytes)</li></ul></div><div class="section"><h2>üí° Recommendations</h2><p>üîç <strong>Review 17 modified files</strong> for logic changes</p><p>üìù <strong>Check 1 new files</strong> for integration requirements</p><p>‚ö†Ô∏è <strong>Verify 1 removed files</strong> don't break dependencies</p></div><hr><p><em>Report generated by Enhanced Code Comparison Tool with Complete Function View</em></p></body></html>