<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Code Comparison Report</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 20px; line-height: 1.6; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .summary-table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        .summary-table th, .summary-table td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        .summary-table th { background-color: #f2f2f2; font-weight: bold; }
        .function-container { background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 8px; margin: 10px 0; padding: 15px; }
        .function-header { background: #343a40; color: white; padding: 10px; border-radius: 5px; margin-bottom: 10px; font-family: monospace; font-weight: bold; }
        .code-block { background: #ffffff; border: 1px solid #dee2e6; border-radius: 5px; padding: 15px; margin: 10px 0; font-family: 'Courier New', monospace; white-space: pre-wrap; line-height: 1.4; }
        .added-line { background-color: #d4edda !important; color: #155724 !important; display: block; margin: 2px 0; padding: 2px 5px; border-left: 4px solid #28a745; }
        .removed-line { background-color: #f8d7da !important; color: #721c24 !important; display: block; margin: 2px 0; padding: 2px 5px; border-left: 4px solid #dc3545; }
        .unchanged-line { display: block; margin: 1px 0; padding: 2px 5px; }
        .section { margin: 30px 0; padding: 20px; border-radius: 8px; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .file-title { color: #495057; border-bottom: 2px solid #007bff; padding-bottom: 10px; margin-bottom: 20px; }
        .legend { background: #e9ecef; padding: 15px; border-radius: 5px; margin: 20px 0; }
        .legend-item { margin: 5px 0; }
        .no-changes { color: #6c757d; font-style: italic; }
    </style>
</head>
<body>

        <div class="header">
            <h1>üìä Code Comparison Report - Complete Functions View</h1>
            <p><strong>üìÅ Version v_3.2.0 (New):</strong> E:/Job_1/SHS--version_3.1.3/FSTI/Piston/Caspar/thermal/src</p>
            <p><strong>üìÅ Version v_2.0.0 (Old):</strong> E:/Job_1/SHS--Original/localCopy/FSTI/piston/Caspar/thermal/src</p>
            <p><strong>üìÖ Generated:</strong> 2025-06-08 18:36:10</p>
        </div>
        
        <div class="section">
            <h2>üéØ Quick Summary</h2>
            <table class="summary-table">
                <tr><th>Status</th><th>Count</th><th>Files</th></tr>
        <tr><td>üîµ <strong>Modified</strong></td><td>2</td><td>CThermal.cpp, CThermal.h</td></tr><tr><td>‚ú® <strong>New in v_3.2.0</strong></td><td>0</td><td></td></tr><tr><td>üóëÔ∏è <strong>Removed from v_2.0.0</strong></td><td>0</td><td></td></tr><tr><td>‚úÖ <strong>Identical</strong></td><td>2</td><td>No changes</td></tr><tr><td><strong>üìä Total Changes</strong></td><td><strong>+4 -558</strong></td><td><strong>Net: -554 lines</strong></td></tr>
            </table>
        </div>
        
        <div class="legend">
            <h3>üîπ How to Read the Code Changes:</h3>
            <div class="legend-item"><span class="removed-line" style="display: inline; padding: 2px 5px;">üóëÔ∏è Red sections</span> show code that was REMOVED from v_2.0.0</div>
            <div class="legend-item"><span class="added-line" style="display: inline; padding: 2px 5px;">‚ú® Green sections</span> show code that was ADDED in v_3.2.0</div>
            <div class="legend-item"><span class="unchanged-line" style="display: inline; padding: 2px 5px;">üìÑ Gray lines</span> provide context around changes</div>
            <p><strong>New Approach:</strong> Instead of mixing added/removed lines together, each change is shown as a separate section with clear context, making it easier to understand what was removed vs what was added.</p>
        </div>
        <div class="section"><h2>üìã File-by-File Analysis - Complete Functions</h2><div class="section"><h3 class="file-title">üìÑ CThermal.cpp</h3><p><strong>Status:</strong> üîµ 4 additions and 544 deletions (net reduction of 540 lines)</p><p><strong>Size:</strong> 63,103 ‚Üí 42,047 bytes (-21,056 bytes)</p><p><strong>Changes:</strong> +4 lines added, -544 lines removed</p><p><strong>Types of Changes:</strong> Functions, Include statements, Comments, Control flow</p><h4>üîß Code Changes (Separated by Type):</h4><h5>üóëÔ∏è Removed Code Sections:</h5><div class="function-container"><div class="function-header">‚ùå Removed Section 1 (around line 1)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  #include "CThermal.h"</span><span class="removed-line">- //#include "../../main/src/CPistonGap.h"</span><span class="unchanged-line">  #include "../../main/src/logger.h"</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 2 (around line 60)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	myMesh.ReadABAQUSTeth(mesh_path);</span><span class="unchanged-line">  </span><span class="unchanged-line">  	//Shift coordinate system so origin is on plane defined by bottom of bushing gap surface (closest to valve plate)</span><span class="removed-line">- 	double shift = 0.0;</span><span class="unchanged-line">  	if(body=="cylinder"){</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 3 (around line 351)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		Log &amp;lt;&amp;lt; body &amp;lt;&amp;lt; " is an invalid entry!" &amp;lt;&amp;lt; "\n";</span><span class="unchanged-line">  		system("PAUSE");</span><span class="unchanged-line">  	}</span><span class="removed-line">- 	if(coupled_caspar_simulation)</span><span class="unchanged-line">  		iter.set_noisy(0);</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 4 (around line 405)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  </span><span class="unchanged-line">  </span><span class="unchanged-line">  };</span><span class="removed-line">- // add conduction matrix for piston body</span><span class="removed-line">- void CThermal::ThermalSolve_Piston(vector&amp;lt;Array&amp;lt;double,1&amp;gt;&amp;gt; qbi, vector&amp;lt;Array&amp;lt;double,1&amp;gt;&amp;gt; wtd_h, vector&amp;lt;double&amp;gt; Tb, Array&amp;lt;double,1&amp;gt; &amp;T_body,Array&amp;lt;double,1&amp;gt; &amp;T_surface)</span><span class="removed-line">- {</span><span class="removed-line">- </span><span class="removed-line">- 	string mesh_name;</span><span class="removed-line">- 	mesh_name = myMesh.piston_name;</span><span class="removed-line">- 	</span><span class="removed-line">- 	//Size and initialize scalar field to be solved</span><span class="removed-line">- 	phi_both.resize(nNodes,0);</span><span class="removed-line">- 	</span><span class="removed-line">- 	//Log &amp;lt;&amp;lt; nCells &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 	//Log &amp;lt;&amp;lt; myMesh.conn.size() &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 	for(int a = 0; a &amp;lt; nNodes; a++){</span><span class="removed-line">- 		double temp = T_body(a);</span><span class="removed-line">- 		//phi[a] = temp;</span><span class="removed-line">- 	//	Log &amp;lt;&amp;lt; temp &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 		for(int b = 0; b &amp;lt; 4; b++){</span><span class="removed-line">- 			phi_both[myMesh.conn(a,b)] = temp;</span><span class="removed-line">- 		}</span><span class="removed-line">- 	}</span><span class="removed-line">- </span><span class="removed-line">- 	//vector&amp;lt;short&amp;gt; boundaries;</span><span class="removed-line">- 	boundaries.resize(nNodes,0);</span><span class="removed-line">- 	//Set boundaries</span><span class="removed-line">- 	SetBoundaries(qbi);</span><span class="removed-line">- 	</span><span class="removed-line">- </span><span class="removed-line">- 	//Develop Stiffness Matrix</span><span class="removed-line">- 	Log &amp;lt;&amp;lt; "Calculating Stiffness Matrix... ";</span><span class="removed-line">- 	gmm::resize(matK,nNodes,nNodes);</span><span class="removed-line">- 	//gmm::row_matrix&amp;lt;gmm::wsvector&amp;lt;double &amp;gt; &amp;gt; matK(nNodes,nNodes);</span><span class="removed-line">- 	gmm::clear(matK);</span><span class="removed-line">- 	for(int cell = 0;cell&amp;lt;nCells;cell++){</span><span class="removed-line">- 		/*Log &amp;lt;&amp;lt; "Cell: " &amp;lt;&amp;lt; cell &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 		Log &amp;lt;&amp;lt; "\n";*/</span><span class="removed-line">- 		double J = SetBMatrix(cell);</span><span class="removed-line">- 		/*Log &amp;lt;&amp;lt; "J: " &amp;lt;&amp;lt; J &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 		Log &amp;lt;&amp;lt; "\n";*/</span><span class="removed-line">- 		vector&amp;lt;vector&amp;lt;double&amp;gt; &amp;gt; Kcd;</span><span class="removed-line">- 		Kcd = CalcKcd(matB,myMesh.Tf(cell),J);//calculate the conduction matrix</span><span class="removed-line">- 		for(int a = 0;a&amp;lt;4;a++){</span><span class="removed-line">- 			for(int b = 0;b&amp;lt;4;b++){</span><span class="removed-line">- 				//if(myMesh.conn(cell,a)&amp;gt;=myMesh.conn(cell,b))</span><span class="removed-line">- 					matK(myMesh.conn(cell,a),myMesh.conn(cell,b)) = matK(myMesh.conn(cell,a),myMesh.conn(cell,b)) + Kcd[a][b];</span><span class="removed-line">- 			}</span><span class="removed-line">- 		}</span><span class="removed-line">- 		//Log &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 	}</span><span class="removed-line">- </span><span class="removed-line">- </span><span class="removed-line">- 	//add convective terms for mixed boundary faces.</span><span class="removed-line">- 	for(int a = 0;a&amp;lt;faceid_mixb.size();a++){//for each mixed boundary face</span><span class="removed-line">- 		//Log &amp;lt;&amp;lt; "Applying mixed boundary face " &amp;lt;&amp;lt; a &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 		//double phi = myMesh.phibinfi[a];</span><span class="removed-line">- 		double h = myMesh.hbi[a];</span><span class="removed-line">- 		for(int b = 0;b&amp;lt;faceid_mixb[a].size();b++){</span><span class="removed-line">- 			int faceid = faceid_mixb[a][b];</span><span class="removed-line">- 			//cout &amp;lt;&amp;lt; "Face: " &amp;lt;&amp;lt; faceid &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 			//cout &amp;lt;&amp;lt; Af.size() &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 			double dA = FaceArea(connf(faceid,0),connf(faceid,1),connf(faceid,2));</span><span class="removed-line">- 			//cout &amp;lt;&amp;lt; "Area: " &amp;lt;&amp;lt; dA &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 			//cout &amp;lt;&amp;lt; connallf.size() &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 			for(int c = 0;c&amp;lt;3;c++){</span><span class="removed-line">- 				int nodeid = connf(faceid,c);</span><span class="removed-line">- 				//cout &amp;lt;&amp;lt; "Node: " &amp;lt;&amp;lt; nodeid &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 				matK(nodeid,nodeid) = matK(nodeid,nodeid) + h*dA/6;</span><span class="removed-line">- 				if(c != 0){</span><span class="removed-line">- 					//if(connallf(faceid,0) &amp;lt;= nodeid)</span><span class="removed-line">- 						matK(nodeid,connf(faceid,0)) = matK(nodeid,connf(faceid,0)) + h*dA/12;</span><span class="removed-line">- 				}</span><span class="removed-line">- 				if(c != 1){</span><span class="removed-line">- 					//if(connallf(faceid,1) &amp;lt;= nodeid)</span><span class="removed-line">- 						matK(nodeid,connf(faceid,1)) = matK(nodeid,connf(faceid,1)) + h*dA/12;</span><span class="removed-line">- 				}</span><span class="removed-line">- 				if(c != 2){</span><span class="removed-line">- 					//if(connallf(faceid,2) &amp;lt;= nodeid)</span><span class="removed-line">- 						matK(nodeid,connf(faceid,2)) = matK(nodeid,connf(faceid,2)) + h*dA/12;</span><span class="removed-line">- 				}</span><span class="removed-line">- 			}</span><span class="removed-line">- 		}</span><span class="removed-line">- 	}</span><span class="removed-line">- </span><span class="removed-line">- 	//add convective terms for mixed heat transfer on flux boundary faces.</span><span class="removed-line">- 	for(int a = 0;a&amp;lt;2;a++){//for each mixed boundary face</span><span class="removed-line">- 		//Log &amp;lt;&amp;lt; "Applying mixed boundary face " &amp;lt;&amp;lt; a &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 		//double phi = myMesh.phibinfi[a];</span><span class="removed-line">- 		for(int b = 0;b&amp;lt;faceid_qb[0].size();b++){</span><span class="removed-line">- 			int faceid = faceid_qb[0][b];</span><span class="removed-line">- 			double h = wtd_h[a](b);</span><span class="removed-line">- 			//cout &amp;lt;&amp;lt; "Face: " &amp;lt;&amp;lt; faceid &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 			//cout &amp;lt;&amp;lt; Af.size() &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 			double dA = FaceArea(connf(faceid,0),connf(faceid,1),connf(faceid,2));</span><span class="removed-line">- 			//cout &amp;lt;&amp;lt; "Area: " &amp;lt;&amp;lt; dA &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 			//cout &amp;lt;&amp;lt; connallf.size() &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 			for(int c = 0;c&amp;lt;3;c++){</span><span class="removed-line">- 				int nodeid = connf(faceid,c);</span><span class="removed-line">- 				//cout &amp;lt;&amp;lt; "Node: " &amp;lt;&amp;lt; nodeid &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 				matK(nodeid,nodeid) = matK(nodeid,nodeid) + h*dA/6;</span><span class="removed-line">- 				if(c != 0){</span><span class="removed-line">- 					//if(connallf(faceid,0) &amp;lt;= nodeid)</span><span class="removed-line">- 						matK(nodeid,connf(faceid,0)) = matK(nodeid,connf(faceid,0)) + h*dA/12;</span><span class="removed-line">- 				}</span><span class="removed-line">- 				if(c != 1){</span><span class="removed-line">- 					//if(connallf(faceid,1) &amp;lt;= nodeid)</span><span class="removed-line">- 						matK(nodeid,connf(faceid,1)) = matK(nodeid,connf(faceid,1)) + h*dA/12;</span><span class="removed-line">- 				}</span><span class="removed-line">- 				if(c != 2){</span><span class="removed-line">- 					//if(connallf(faceid,2) &amp;lt;= nodeid)</span><span class="removed-line">- 						matK(nodeid,connf(faceid,2)) = matK(nodeid,connf(faceid,2)) + h*dA/12;</span><span class="removed-line">- 				}</span><span class="removed-line">- 			}</span><span class="removed-line">- 		}</span><span class="removed-line">- 	}</span><span class="removed-line">- </span><span class="removed-line">- 	Log &amp;lt;&amp;lt; "Done!" &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- </span><span class="removed-line">- 	//Develop Load Matrix</span><span class="removed-line">- 	Log &amp;lt;&amp;lt; "Setting Load Vector... ";</span><span class="removed-line">- 	vecq.clear();</span><span class="removed-line">- 	vecq.resize(nNodes,0);</span><span class="removed-line">- 	</span><span class="removed-line">- 	</span><span class="removed-line">- 	for(int a = 0;a&amp;lt;faceid_mixb.size();a++){//for each mixed boundary face</span><span class="removed-line">- 		double phiint = myMesh.phibinfi[a];</span><span class="removed-line">- 		double h = myMesh.hbi[a];</span><span class="removed-line">- 		for(int b = 0;b&amp;lt;faceid_mixb[a].size();b++){</span><span class="removed-line">- 			int faceid = faceid_mixb[a][b];</span><span class="removed-line">- 			//Log &amp;lt;&amp;lt; "Face: " &amp;lt;&amp;lt; faceid &amp;lt;&amp;lt; "\t" ;</span><span class="removed-line">- 			double dA = FaceArea(connf(faceid,0),connf(faceid,1),connf(faceid,2));</span><span class="removed-line">- 			//Log &amp;lt;&amp;lt; "Area: " &amp;lt;&amp;lt; dA &amp;lt;&amp;lt; "\tPhiinfinite: " &amp;lt;&amp;lt; phiint &amp;lt;&amp;lt; "\th: " &amp;lt;&amp;lt; h &amp;lt;&amp;lt; "\n";;</span><span class="removed-line">- 			for(int c = 0;c&amp;lt;3;c++){</span><span class="removed-line">- 				vecq[connf(faceid,c)] = vecq[connf(faceid,c)] + h*phiint*dA/3;</span><span class="removed-line">- 				boundaries[connf(faceid,c)] = 2;</span><span class="removed-line">- 			}</span><span class="removed-line">- 		}</span><span class="removed-line">- 	}</span><span class="removed-line">- </span><span class="removed-line">- 	for(int a = 0;a&amp;lt;2;a++){//for each mixed boundary face</span><span class="removed-line">- 		double phiint = Tb[a];</span><span class="removed-line">- 		for(int b = 0;b&amp;lt;faceid_qb[0].size();b++){</span><span class="removed-line">- 			int faceid = faceid_qb[0][b];</span><span class="removed-line">- 			double h = wtd_h[a](b);</span><span class="removed-line">- 			//Log &amp;lt;&amp;lt; "Face: " &amp;lt;&amp;lt; faceid &amp;lt;&amp;lt; "\t" ;</span><span class="removed-line">- 			double dA = FaceArea(connf(faceid,0),connf(faceid,1),connf(faceid,2));</span><span class="removed-line">- 			//Log &amp;lt;&amp;lt; "Area: " &amp;lt;&amp;lt; dA &amp;lt;&amp;lt; "\tPhiinfinite: " &amp;lt;&amp;lt; phiint &amp;lt;&amp;lt; "\th: " &amp;lt;&amp;lt; h &amp;lt;&amp;lt; "\n";;</span><span class="removed-line">- 			for(int c = 0;c&amp;lt;3;c++){</span><span class="removed-line">- 				vecq[connf(faceid,c)] = vecq[connf(faceid,c)] + h*phiint*dA/3;</span><span class="removed-line">- 				boundaries[connf(faceid,c)] = 2;</span><span class="removed-line">- 			}</span><span class="removed-line">- 		}</span><span class="removed-line">- 	}</span><span class="removed-line">- </span><span class="removed-line">- 	area_piston.resize(faceid_qb.size());</span><span class="removed-line">- </span><span class="removed-line">- 	for(int a = 0;a&amp;lt;faceid_qb.size();a++){//for each flux boundary face</span><span class="removed-line">- 		area_piston[a].resize(faceid_qb[a].size());</span><span class="removed-line">- 		for(int b = 0;b&amp;lt;faceid_qb[a].size();b++){</span><span class="removed-line">- 			int faceid = faceid_qb[a][b];</span><span class="removed-line">- 			double q = qb(faceid);</span><span class="removed-line">- 			double dA = FaceArea(connf(faceid,0),connf(faceid,1),connf(faceid,2));</span><span class="removed-line">- 			area_piston[a][b] = dA;</span><span class="removed-line">- 			//Log &amp;lt;&amp;lt; scientific &amp;lt;&amp;lt; "Face: " &amp;lt;&amp;lt; faceid &amp;lt;&amp;lt; "\tArea: " &amp;lt;&amp;lt; dA &amp;lt;&amp;lt; "\tq: " &amp;lt;&amp;lt; q &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 			for(int c = 0;c&amp;lt;3;c++){</span><span class="removed-line">- 				vecq[connf(faceid,c)] = vecq[connf(faceid,c)] + q*dA/3;</span><span class="removed-line">- 				boundaries[connf(faceid,c)] = 1;</span><span class="removed-line">- 			}</span><span class="removed-line">- 		} </span><span class="removed-line">- 	}</span><span class="removed-line">- 	</span><span class="removed-line">- 	Log &amp;lt;&amp;lt; "Done!" &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- </span><span class="removed-line">- 	//Set Constraints (phib)</span><span class="removed-line">- 	Log &amp;lt;&amp;lt; "Setting Temperature Constraints... " ;</span><span class="removed-line">- </span><span class="removed-line">- 	for(int a = 0;a&amp;lt;faceid_phib.size();a++){//for each fixed temperature face</span><span class="removed-line">- 		for(int b = 0;b&amp;lt;faceid_phib[a].size();b++){</span><span class="removed-line">- 			int faceid = faceid_phib[a][b];</span><span class="removed-line">- 			double phiint = phib(faceid);</span><span class="removed-line">- 			for(int c = 0;c&amp;lt;3;c++){</span><span class="removed-line">- 				int node = connf(faceid,c);</span><span class="removed-line">- 				//phi[node] = phiint; // Set Temperature</span><span class="removed-line">- 				vecq[node] = phiint;</span><span class="removed-line">- 				T_body(node) = phiint;//eliminate under-relaxation for this node.</span><span class="removed-line">- 				for(int i = 0;i&amp;lt;nNodes;i++){</span><span class="removed-line">- 					//matK(i,node) = 0;</span><span class="removed-line">- 					if(i == node)</span><span class="removed-line">- 						matK(node,i) = 1;</span><span class="removed-line">- 					else</span><span class="removed-line">- 						matK(node,i) = 0;</span><span class="removed-line">- 				}</span><span class="removed-line">- 			}</span><span class="removed-line">- 		}</span><span class="removed-line">- 	}</span><span class="removed-line">- </span><span class="removed-line">- 	connf_piston.resize(connf.extent(0),connf.extent(1));</span><span class="removed-line">- 	connf_piston = connf;</span><span class="removed-line">- 	faceid_qb_piston = faceid_qb;</span><span class="removed-line">- </span><span class="removed-line">- </span><span class="removed-line">- 	connallf.free();</span><span class="removed-line">- 	Log &amp;lt;&amp;lt; "Done!" &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- </span><span class="removed-line">- 	connf.free(); Afn.free(); phi.clear(); phi_surf.free(); faceid_qb.clear(); faceid_mixb.clear();</span><span class="removed-line">- </span><span class="removed-line">- };</span><span class="removed-line">- // add conduction matrix for cylinder body</span><span class="removed-line">- void CThermal::ThermalSolve_Cylinder(vector&amp;lt;Array&amp;lt;double,1&amp;gt;&amp;gt; qbi, vector&amp;lt;Array&amp;lt;double,1&amp;gt;&amp;gt; wtd_h, vector&amp;lt;double&amp;gt; Tb, Array&amp;lt;double,1&amp;gt; &amp;T_body,Array&amp;lt;double,1&amp;gt; &amp;T_surface)</span><span class="removed-line">- {</span><span class="removed-line">- 	int n_piston_Nodes;</span><span class="removed-line">- 	n_piston_Nodes = matK.nrows();</span><span class="removed-line">- </span><span class="removed-line">- </span><span class="removed-line">- 	string mesh_name;</span><span class="removed-line">- 	mesh_name = myMesh.cylinder_name;</span><span class="removed-line">- 	</span><span class="removed-line">- 	//Size and initialize scalar field to be solved</span><span class="removed-line">- 	gmm::resize(phi_both,n_piston_Nodes+nNodes);</span><span class="removed-line">- 	//phi.resize(nNodes,0);</span><span class="removed-line">- 	</span><span class="removed-line">- 	//Log &amp;lt;&amp;lt; nCells &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 	//Log &amp;lt;&amp;lt; myMesh.conn.size() &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 	for(int a = 0; a &amp;lt; nNodes; a++){</span><span class="removed-line">- 		double temp = T_body(a);</span><span class="removed-line">- 		//phi[a] = temp;</span><span class="removed-line">- 	//	Log &amp;lt;&amp;lt; temp &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 		for(int b = 0; b &amp;lt; 4; b++){</span><span class="removed-line">- 			phi_both[myMesh.conn(a,b) + n_piston_Nodes] = temp;</span><span class="removed-line">- 		}</span><span class="removed-line">- 	}</span><span class="removed-line">- </span><span class="removed-line">- 	//vector&amp;lt;short&amp;gt; boundaries;</span><span class="removed-line">- 	boundaries.resize(nNodes,0);</span><span class="removed-line">- 	//Set boundaries</span><span class="removed-line">- 	SetBoundaries(qbi);</span><span class="removed-line">- 	</span><span class="removed-line">- </span><span class="removed-line">- 	//Develop Stiffness Matrix</span><span class="removed-line">- 	Log &amp;lt;&amp;lt; "Calculating Stiffness Matrix... ";</span><span class="removed-line">- 	gmm:resize(matK,nNodes+n_piston_Nodes,nNodes+n_piston_Nodes);</span><span class="removed-line">- 	//gmm::row_matrix&amp;lt;gmm::wsvector&amp;lt;double &amp;gt; &amp;gt; matK(nNodes,nNodes);</span><span class="removed-line">- 	//gmm::clear(matK);</span><span class="removed-line">- 	for(int cell = 0;cell&amp;lt;nCells;cell++){</span><span class="removed-line">- 		/*Log &amp;lt;&amp;lt; "Cell: " &amp;lt;&amp;lt; cell &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 		Log &amp;lt;&amp;lt; "\n";*/</span><span class="removed-line">- 		double J = SetBMatrix(cell);</span><span class="removed-line">- 		/*Log &amp;lt;&amp;lt; "J: " &amp;lt;&amp;lt; J &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 		Log &amp;lt;&amp;lt; "\n";*/</span><span class="removed-line">- 		vector&amp;lt;vector&amp;lt;double&amp;gt; &amp;gt; Kcd;</span><span class="removed-line">- 		Kcd = CalcKcd(matB,myMesh.Tf(cell),J);//calculate the conduction matrix</span><span class="removed-line">- 		for(int a = 0;a&amp;lt;4;a++){</span><span class="removed-line">- 			for(int b = 0;b&amp;lt;4;b++){</span><span class="removed-line">- 				//if(myMesh.conn(cell,a)&amp;gt;=myMesh.conn(cell,b))</span><span class="removed-line">- 					matK(myMesh.conn(cell,a)+n_piston_Nodes,myMesh.conn(cell,b)+n_piston_Nodes) = matK(myMesh.conn(cell,a)+n_piston_Nodes,myMesh.conn(cell,b)+n_piston_Nodes) + Kcd[a][b];</span><span class="removed-line">- 			}</span><span class="removed-line">- 		}</span><span class="removed-line">- 		//Log &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 	}</span><span class="removed-line">- </span><span class="removed-line">- </span><span class="removed-line">- 	//add convective terms for mixed boundary faces.</span><span class="removed-line">- 	for(int a = 0;a&amp;lt;faceid_mixb.size();a++){//for each mixed boundary face</span><span class="removed-line">- 		//Log &amp;lt;&amp;lt; "Applying mixed boundary face " &amp;lt;&amp;lt; a &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 		//double phi = myMesh.phibinfi[a];</span><span class="removed-line">- 		double h = myMesh.hbi[a];</span><span class="removed-line">- 		for(int b = 0;b&amp;lt;faceid_mixb[a].size();b++){</span><span class="removed-line">- 			int faceid = faceid_mixb[a][b];</span><span class="removed-line">- 			//cout &amp;lt;&amp;lt; "Face: " &amp;lt;&amp;lt; faceid &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 			//cout &amp;lt;&amp;lt; Af.size() &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 			double dA = FaceArea(connf(faceid,0),connf(faceid,1),connf(faceid,2));</span><span class="removed-line">- 			//cout &amp;lt;&amp;lt; "Area: " &amp;lt;&amp;lt; dA &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 			//cout &amp;lt;&amp;lt; connallf.size() &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 			for(int c = 0;c&amp;lt;3;c++){</span><span class="removed-line">- 				int nodeid = connf(faceid,c) + n_piston_Nodes;</span><span class="removed-line">- 				//cout &amp;lt;&amp;lt; "Node: " &amp;lt;&amp;lt; nodeid &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 				matK(nodeid,nodeid) = matK(nodeid,nodeid) + h*dA/6;</span><span class="removed-line">- 				if(c != 0){</span><span class="removed-line">- 					//if(connallf(faceid,0) &amp;lt;= nodeid)</span><span class="removed-line">- 						matK(nodeid,connf(faceid,0)+ n_piston_Nodes) = matK(nodeid,connf(faceid,0)+ n_piston_Nodes) + h*dA/12;</span><span class="removed-line">- 				}</span><span class="removed-line">- 				if(c != 1){</span><span class="removed-line">- 					//if(connallf(faceid,1) &amp;lt;= nodeid)</span><span class="removed-line">- 						matK(nodeid,connf(faceid,1)+ n_piston_Nodes) = matK(nodeid,connf(faceid,1)+ n_piston_Nodes) + h*dA/12;</span><span class="removed-line">- 				}</span><span class="removed-line">- 				if(c != 2){</span><span class="removed-line">- 					//if(connallf(faceid,2) &amp;lt;= nodeid)</span><span class="removed-line">- 						matK(nodeid,connf(faceid,2)+ n_piston_Nodes) = matK(nodeid,connf(faceid,2)+ n_piston_Nodes) + h*dA/12;</span><span class="removed-line">- 				}</span><span class="removed-line">- 			}</span><span class="removed-line">- 		}</span><span class="removed-line">- 	}</span><span class="removed-line">- </span><span class="removed-line">- 	//add convective terms for mixed heat transfer on flux boundary faces.</span><span class="removed-line">- 	for(int a = 0;a&amp;lt;2;a++){//for each mixed boundary face</span><span class="removed-line">- 		//Log &amp;lt;&amp;lt; "Applying mixed boundary face " &amp;lt;&amp;lt; a &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 		//double phi = myMesh.phibinfi[a];</span><span class="removed-line">- 		for(int b = 0;b&amp;lt;faceid_qb[0].size();b++){</span><span class="removed-line">- 			int faceid = faceid_qb[0][b];</span><span class="removed-line">- 			double h = wtd_h[a](b);</span><span class="removed-line">- 			//cout &amp;lt;&amp;lt; "Face: " &amp;lt;&amp;lt; faceid &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 			//cout &amp;lt;&amp;lt; Af.size() &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 			double dA = FaceArea(connf(faceid,0),connf(faceid,1),connf(faceid,2));</span><span class="removed-line">- 			//cout &amp;lt;&amp;lt; "Area: " &amp;lt;&amp;lt; dA &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 			//cout &amp;lt;&amp;lt; connallf.size() &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 			for(int c = 0;c&amp;lt;3;c++){</span><span class="removed-line">- 				int nodeid = connf(faceid,c);</span><span class="removed-line">- 				//cout &amp;lt;&amp;lt; "Node: " &amp;lt;&amp;lt; nodeid &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 				matK(nodeid,nodeid) = matK(nodeid,nodeid) + h*dA/6;</span><span class="removed-line">- 				if(c != 0){</span><span class="removed-line">- 					//if(connallf(faceid,0) &amp;lt;= nodeid)</span><span class="removed-line">- 						matK(nodeid,connf(faceid,0)) = matK(nodeid,connf(faceid,0)) + h*dA/12;</span><span class="removed-line">- 				}</span><span class="removed-line">- 				if(c != 1){</span><span class="removed-line">- 					//if(connallf(faceid,1) &amp;lt;= nodeid)</span><span class="removed-line">- 						matK(nodeid,connf(faceid,1)) = matK(nodeid,connf(faceid,1)) + h*dA/12;</span><span class="removed-line">- 				}</span><span class="removed-line">- 				if(c != 2){</span><span class="removed-line">- 					//if(connallf(faceid,2) &amp;lt;= nodeid)</span><span class="removed-line">- 						matK(nodeid,connf(faceid,2)) = matK(nodeid,connf(faceid,2)) + h*dA/12;</span><span class="removed-line">- 				}</span><span class="removed-line">- 			}</span><span class="removed-line">- 		}</span><span class="removed-line">- 	}</span><span class="removed-line">- </span><span class="removed-line">- 	Log &amp;lt;&amp;lt; "Done!" &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- </span><span class="removed-line">- 	//Develop Load Matrix</span><span class="removed-line">- 	Log &amp;lt;&amp;lt; "Setting Load Vector... ";</span><span class="removed-line">- 	//vecq.clear();</span><span class="removed-line">- 	vecq.resize(nNodes+n_piston_Nodes,0);</span><span class="removed-line">- 	</span><span class="removed-line">- 	</span><span class="removed-line">- 	for(int a = 0;a&amp;lt;faceid_mixb.size();a++){//for each mixed boundary face</span><span class="removed-line">- 		double phiint = myMesh.phibinfi[a];</span><span class="removed-line">- 		double h = myMesh.hbi[a];</span><span class="removed-line">- 		for(int b = 0;b&amp;lt;faceid_mixb[a].size();b++){</span><span class="removed-line">- 			int faceid = faceid_mixb[a][b];</span><span class="removed-line">- 			//Log &amp;lt;&amp;lt; "Face: " &amp;lt;&amp;lt; faceid &amp;lt;&amp;lt; "\t" ;</span><span class="removed-line">- 			double dA = FaceArea(connf(faceid,0),connf(faceid,1),connf(faceid,2));</span><span class="removed-line">- 			//Log &amp;lt;&amp;lt; "Area: " &amp;lt;&amp;lt; dA &amp;lt;&amp;lt; "\tPhiinfinite: " &amp;lt;&amp;lt; phiint &amp;lt;&amp;lt; "\th: " &amp;lt;&amp;lt; h &amp;lt;&amp;lt; "\n";;</span><span class="removed-line">- 			for(int c = 0;c&amp;lt;3;c++){</span><span class="removed-line">- 				vecq[connf(faceid,c)+n_piston_Nodes] = vecq[connf(faceid,c)+n_piston_Nodes] + h*phiint*dA/3;</span><span class="removed-line">- 				boundaries[connf(faceid,c)] = 2;</span><span class="removed-line">- 			}</span><span class="removed-line">- 		}</span><span class="removed-line">- 	}</span><span class="removed-line">- </span><span class="removed-line">- 	for(int a = 0;a&amp;lt;2;a++){//for each mixed boundary face</span><span class="removed-line">- 		double phiint = Tb[a];</span><span class="removed-line">- 		for(int b = 0;b&amp;lt;faceid_qb[0].size();b++){</span><span class="removed-line">- 			int faceid = faceid_qb[0][b];</span><span class="removed-line">- 			double h = wtd_h[a](b);</span><span class="removed-line">- 			//Log &amp;lt;&amp;lt; "Face: " &amp;lt;&amp;lt; faceid &amp;lt;&amp;lt; "\t" ;</span><span class="removed-line">- 			double dA = FaceArea(connf(faceid,0),connf(faceid,1),connf(faceid,2));</span><span class="removed-line">- 			//Log &amp;lt;&amp;lt; "Area: " &amp;lt;&amp;lt; dA &amp;lt;&amp;lt; "\tPhiinfinite: " &amp;lt;&amp;lt; phiint &amp;lt;&amp;lt; "\th: " &amp;lt;&amp;lt; h &amp;lt;&amp;lt; "\n";;</span><span class="removed-line">- 			for(int c = 0;c&amp;lt;3;c++){</span><span class="removed-line">- 				vecq[connf(faceid,c)] = vecq[connf(faceid,c)] + h*phiint*dA/3;</span><span class="removed-line">- 				boundaries[connf(faceid,c)] = 2;</span><span class="removed-line">- 			}</span><span class="removed-line">- 		}</span><span class="removed-line">- 	}</span><span class="removed-line">- </span><span class="removed-line">- 	area_cylinder.resize(faceid_qb.size());</span><span class="removed-line">- </span><span class="removed-line">- 	for(int a = 0;a&amp;lt;faceid_qb.size();a++){//for each flux boundary face</span><span class="removed-line">- 		area_cylinder[a].resize(faceid_qb[a].size());</span><span class="removed-line">- 		for(int b = 0;b&amp;lt;faceid_qb[a].size();b++){</span><span class="removed-line">- 			int faceid = faceid_qb[a][b];</span><span class="removed-line">- 			double q = qb(faceid);</span><span class="removed-line">- 			double dA = FaceArea(connf(faceid,0),connf(faceid,1),connf(faceid,2));</span><span class="removed-line">- 			area_cylinder[a][b] = dA;</span><span class="removed-line">- 			//Log &amp;lt;&amp;lt; scientific &amp;lt;&amp;lt; "Face: " &amp;lt;&amp;lt; faceid &amp;lt;&amp;lt; "\tArea: " &amp;lt;&amp;lt; dA &amp;lt;&amp;lt; "\tq: " &amp;lt;&amp;lt; q &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 			for(int c = 0;c&amp;lt;3;c++){</span><span class="removed-line">- 				vecq[connf(faceid,c)+n_piston_Nodes] = vecq[connf(faceid,c)+n_piston_Nodes] + q*dA/3;</span><span class="removed-line">- 				boundaries[connf(faceid,c)] = 1;</span><span class="removed-line">- 			}</span><span class="removed-line">- 		}</span><span class="removed-line">- 	}</span><span class="removed-line">- 	</span><span class="removed-line">- 	Log &amp;lt;&amp;lt; "Done!" &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- </span><span class="removed-line">- 	//Set Constraints (phib)</span><span class="removed-line">- 	Log &amp;lt;&amp;lt; "Setting Temperature Constraints... " ;</span><span class="removed-line">- </span><span class="removed-line">- 	for(int a = 0;a&amp;lt;faceid_phib.size();a++){//for each fixed temperature face</span><span class="removed-line">- 		for(int b = 0;b&amp;lt;faceid_phib[a].size();b++){</span><span class="removed-line">- 			int faceid = faceid_phib[a][b];</span><span class="removed-line">- 			double phiint = phib(faceid);</span><span class="removed-line">- 			for(int c = 0;c&amp;lt;3;c++){</span><span class="removed-line">- 				int node = connf(faceid,c);</span><span class="removed-line">- 				//phi[node] = phiint; // Set Temperature</span><span class="removed-line">- 				vecq[node+n_piston_Nodes] = phiint;</span><span class="removed-line">- 				T_body(node+n_piston_Nodes) = phiint;//eliminate under-relaxation for this node.</span><span class="removed-line">- 				for(int i = n_piston_Nodes;i&amp;lt;nNodes+n_piston_Nodes;i++){</span><span class="removed-line">- 					//matK(i,node) = 0;</span><span class="removed-line">- 					if(i == node+n_piston_Nodes)</span><span class="removed-line">- 						matK(node+n_piston_Nodes,i) = 1;</span><span class="removed-line">- 					else</span><span class="removed-line">- 						matK(node+n_piston_Nodes,i) = 0;</span><span class="removed-line">- 				}</span><span class="removed-line">- 			}</span><span class="removed-line">- 		}</span><span class="removed-line">- 	}</span><span class="removed-line">- </span><span class="removed-line">- 	</span><span class="removed-line">- 	connf_cylinder.resize(connf.extent(0),connf.extent(1));</span><span class="removed-line">- 	connf_cylinder = connf;</span><span class="removed-line">- 	faceid_qb_cylinder = faceid_qb;</span><span class="removed-line">- </span><span class="removed-line">- 	connallf.free();</span><span class="removed-line">- 	Log &amp;lt;&amp;lt; "Done!" &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- </span><span class="removed-line">- 	connf.free(); Afn.free(); phi.clear(); phi_surf.free(); faceid_qb.clear(); faceid_mixb.clear();</span><span class="removed-line">- </span><span class="removed-line">- };</span><span class="removed-line">- // add conduction matrix between piston and cylinder body</span><span class="removed-line">- void CThermal::ThermalSolve_interbody_conduction(vector&amp;lt;vector&amp;lt;int&amp;gt;&amp;gt; &amp;Mid_K2B, vector&amp;lt;vector&amp;lt;double&amp;gt;&amp;gt; &amp;Mwt_K2B, vector&amp;lt;vector&amp;lt;int&amp;gt;&amp;gt; &amp;Mid_B2K, vector&amp;lt;vector&amp;lt;double&amp;gt;&amp;gt; &amp;Mwt_B2K, double C)</span><span class="removed-line">- {</span><span class="removed-line">- 	//double lambda_oil = my_oil -&amp;gt; get_lambda();//oilpistongap.oillambda;</span><span class="removed-line">- 	//double C = operatingpistongap.speed * lambda_oil / 60 / 9;</span><span class="removed-line">- 	// from piston to cylinder</span><span class="removed-line">- 	for(int j = 0; j &amp;lt; Mid_K2B.size(); j++)</span><span class="removed-line">- 	{</span><span class="removed-line">- 		int faceid = faceid_qb_cylinder[0][j];</span><span class="removed-line">- 		for(int i = 0; i &amp;lt; Mid_K2B[j].size(); i++)</span><span class="removed-line">- 		{</span><span class="removed-line">- 			int faceid_p = faceid_qb_piston[0][Mid_K2B[j][i]];</span><span class="removed-line">- 			double dA = area_cylinder[0][j];</span><span class="removed-line">- 			double kj = +1 * C * dA * Mwt_K2B[j][i];</span><span class="removed-line">- 			double ki = -1 * C * dA * Mwt_K2B[j][i];</span><span class="removed-line">- 			matK(connf_cylinder(faceid,0),connf_cylinder(faceid,0)) += kj;</span><span class="removed-line">- 			matK(connf_cylinder(faceid,0),connf_cylinder(faceid,1)) += kj;</span><span class="removed-line">- 			matK(connf_cylinder(faceid,0),connf_cylinder(faceid,2)) += kj;</span><span class="removed-line">- 			matK(connf_cylinder(faceid,1),connf_cylinder(faceid,0)) += kj;</span><span class="removed-line">- 			matK(connf_cylinder(faceid,1),connf_cylinder(faceid,1)) += kj;</span><span class="removed-line">- 			matK(connf_cylinder(faceid,1),connf_cylinder(faceid,2)) += kj;</span><span class="removed-line">- 			matK(connf_cylinder(faceid,2),connf_cylinder(faceid,0)) += kj;</span><span class="removed-line">- 			matK(connf_cylinder(faceid,2),connf_cylinder(faceid,1)) += kj;</span><span class="removed-line">- 			matK(connf_cylinder(faceid,2),connf_cylinder(faceid,2)) += kj;</span><span class="removed-line">- 			matK(connf_cylinder(faceid,0),connf_piston(faceid_p,0)) += ki;</span><span class="removed-line">- 			matK(connf_cylinder(faceid,0),connf_piston(faceid_p,1)) += ki;</span><span class="removed-line">- 			matK(connf_cylinder(faceid,0),connf_piston(faceid_p,2)) += ki;</span><span class="removed-line">- 			matK(connf_cylinder(faceid,1),connf_piston(faceid_p,0)) += ki;</span><span class="removed-line">- 			matK(connf_cylinder(faceid,1),connf_piston(faceid_p,1)) += ki;</span><span class="removed-line">- 			matK(connf_cylinder(faceid,1),connf_piston(faceid_p,2)) += ki;</span><span class="removed-line">- 			matK(connf_cylinder(faceid,2),connf_piston(faceid_p,0)) += ki;</span><span class="removed-line">- 			matK(connf_cylinder(faceid,2),connf_piston(faceid_p,1)) += ki;</span><span class="removed-line">- 			matK(connf_cylinder(faceid,2),connf_piston(faceid_p,2)) += ki;</span><span class="removed-line">- 		}</span><span class="removed-line">- 	}</span><span class="removed-line">- 	// from cylinder to piston</span><span class="removed-line">- 	for(int i = 0; i &amp;lt; Mid_B2K.size(); i++)</span><span class="removed-line">- 	{</span><span class="removed-line">- 		int faceid_p = faceid_qb_piston[0][i];</span><span class="removed-line">- 		for(int j = 0; j &amp;lt; Mid_B2K[i].size(); j++)</span><span class="removed-line">- 		{</span><span class="removed-line">- 			int faceid = faceid_qb_cylinder[0][Mid_B2K[i][j]];</span><span class="removed-line">- 			double dA = area_piston[0][i];</span><span class="removed-line">- 			double ki = +1 * C * dA * Mwt_B2K[i][j];</span><span class="removed-line">- 			double kj = -1 * C * dA * Mwt_B2K[i][j];</span><span class="removed-line">- 			matK(connf_piston(faceid_p,0),connf_piston(faceid_p,0)) += ki;</span><span class="removed-line">- 			matK(connf_piston(faceid_p,0),connf_piston(faceid_p,1)) += ki;</span><span class="removed-line">- 			matK(connf_piston(faceid_p,0),connf_piston(faceid_p,2)) += ki;</span><span class="removed-line">- 			matK(connf_piston(faceid_p,1),connf_piston(faceid_p,0)) += ki;</span><span class="removed-line">- 			matK(connf_piston(faceid_p,1),connf_piston(faceid_p,1)) += ki;</span><span class="removed-line">- 			matK(connf_piston(faceid_p,1),connf_piston(faceid_p,2)) += ki;</span><span class="removed-line">- 			matK(connf_piston(faceid_p,2),connf_piston(faceid_p,0)) += ki;</span><span class="removed-line">- 			matK(connf_piston(faceid_p,2),connf_piston(faceid_p,1)) += ki;</span><span class="removed-line">- 			matK(connf_piston(faceid_p,2),connf_piston(faceid_p,2)) += ki;</span><span class="removed-line">- 			matK(connf_piston(faceid_p,0),connf_cylinder(faceid,0)) += kj;</span><span class="removed-line">- 			matK(connf_piston(faceid_p,0),connf_cylinder(faceid,1)) += kj;</span><span class="removed-line">- 			matK(connf_piston(faceid_p,0),connf_cylinder(faceid,2)) += kj;</span><span class="removed-line">- 			matK(connf_piston(faceid_p,1),connf_cylinder(faceid,0)) += kj;</span><span class="removed-line">- 			matK(connf_piston(faceid_p,1),connf_cylinder(faceid,1)) += kj;</span><span class="removed-line">- 			matK(connf_piston(faceid_p,1),connf_cylinder(faceid,2)) += kj;</span><span class="removed-line">- 			matK(connf_piston(faceid_p,2),connf_cylinder(faceid,0)) += kj;</span><span class="removed-line">- 			matK(connf_piston(faceid_p,2),connf_cylinder(faceid,1)) += kj;</span><span class="removed-line">- 			matK(connf_piston(faceid_p,2),connf_cylinder(faceid,2)) += kj;</span><span class="removed-line">- </span><span class="removed-line">- 		}</span><span class="removed-line">- 	}</span><span class="removed-line">- 	connf_piston.free(); connf_cylinder.free(); area_piston.clear(); area_cylinder.clear(); faceid_qb_piston.clear(); faceid_qb_cylinder.clear();</span><span class="removed-line">- }</span><span class="removed-line">- // solving heat transfer linear system</span><span class="removed-line">- void CThermal::ThermalSolve_new(void)</span><span class="removed-line">- {</span><span class="removed-line">- </span><span class="removed-line">- 	Log &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 	Log &amp;lt;&amp;lt; "Solving both body temperature distribution... " &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 	Log &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- </span><span class="removed-line">- 	gmm::csr_matrix&amp;lt;double&amp;gt; Kint;</span><span class="removed-line">- 	//gmm::clean(Kint, 1E-12);</span><span class="removed-line">- 	gmm::copy(matK,Kint);</span><span class="removed-line">- 	gmm::clear(matK);</span><span class="removed-line">- 	</span><span class="removed-line">- 	//Solve System</span><span class="removed-line">- 	double tol;</span><span class="removed-line">- 	tol = myinput.data.thermal.piston.solver.tol;</span><span class="removed-line">- </span><span class="removed-line">- 	gmm::iteration iter(tol);</span><span class="removed-line">- 	iter.set_maxiter(myinput.data.thermal.piston.solver.maxit);</span><span class="removed-line">- </span><span class="removed-line">- </span><span class="removed-line">- 	if(coupled_caspar_simulation)</span><span class="removed-line">- 		iter.set_noisy(0);</span><span class="removed-line">- 	else</span><span class="removed-line">- 		iter.set_noisy(1);</span><span class="removed-line">- </span><span class="removed-line">- 	gmm::identity_matrix BS;</span><span class="removed-line">- 	gmm::diagonal_precond&amp;lt;gmm::csr_matrix&amp;lt;double &amp;gt; &amp;gt;P(Kint);</span><span class="removed-line">- 	gmm::cg(Kint, phi_both, vecq, BS, P, iter);</span><span class="removed-line">- </span><span class="removed-line">- 	if(iter.converged())</span><span class="removed-line">- 		Log &amp;lt;&amp;lt; "Temperature Distribution Complete!" &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 	else{</span><span class="removed-line">- 		Log &amp;lt;&amp;lt; "Temperature Distribution Failed!" &amp;lt;&amp;lt; endl;</span><span class="removed-line">- 		exit(1);</span><span class="removed-line">- 	}</span><span class="removed-line">- };</span><span class="removed-line">- // assign heat transfer linear system result to piston/cylinder body/surface temperature array</span><span class="removed-line">- void CThermal::ThermalSolve_post(string body,vector&amp;lt;Array&amp;lt;double,1&amp;gt;&amp;gt; qbi,Array&amp;lt;double,1&amp;gt; &amp;T_body,Array&amp;lt;double,1&amp;gt; &amp;T_surface)</span><span class="removed-line">- {</span><span class="removed-line">- </span><span class="removed-line">- 	Log &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 	Log &amp;lt;&amp;lt; "Solving " + body + " temperature distribution... " &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 	Log &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- </span><span class="removed-line">- 	string mesh_name;</span><span class="removed-line">- 	phi.resize(nNodes,0);</span><span class="removed-line">- 	//Define paths according to solid body</span><span class="removed-line">- 	if(body=="piston")</span><span class="removed-line">- 	{</span><span class="removed-line">- 		mesh_name = myMesh.piston_name;</span><span class="removed-line">- 		for(int i=0;i&amp;lt;nNodes;i++)</span><span class="removed-line">- 			phi[i] = phi_both[i];</span><span class="removed-line">- 	}</span><span class="removed-line">- 	else if(body=="cylinder")</span><span class="removed-line">- 	{</span><span class="removed-line">- 		mesh_name = myMesh.cylinder_name;</span><span class="removed-line">- 		for(int i=0;i&amp;lt;nNodes;i++)</span><span class="removed-line">- 			phi[i] = phi_both[phi_both.size()-nNodes+i];</span><span class="removed-line">- 	}</span><span class="removed-line">- 		</span><span class="removed-line">- </span><span class="removed-line">- 	//Assign results</span><span class="removed-line">- 	T_body.resize(nCells);</span><span class="removed-line">- 	Array&amp;lt;double,1&amp;gt; T_body_old = T_body;</span><span class="removed-line">- 	for(int i = 0;i&amp;lt;nCells;i++)</span><span class="removed-line">- 		T_body(i) = 0.25*(phi[myMesh.conn(i,0)] + phi[myMesh.conn(i,1)] + phi[myMesh.conn(i,2)] + phi[myMesh.conn(i,3)]);</span><span class="removed-line">- 	T_body = T_body_old + myinput.data.options_piston.numeric.AlphaTh * (T_body - T_body_old);</span><span class="removed-line">- 	T_body_old.free();</span><span class="removed-line">- 	</span><span class="removed-line">- 	T_surface.resize(faceid_qb[0].size());</span><span class="removed-line">- 	Array&amp;lt;double,1&amp;gt; T_surf_old = T_surface;</span><span class="removed-line">- 	for(int i = 0;i&amp;lt;faceid_qb[0].size();i++){</span><span class="removed-line">- 		//double temp = phi[connf(i,0)]/3 + phi[connf(i,1)]/3 + phi[connf(i,2)]/3;</span><span class="removed-line">- 		int id = faceid_qb[0][i];</span><span class="removed-line">- 		T_surface(i) = (phi[connf(id,0)] + phi[connf(id,1)] + phi[connf(id,2)]) / 3.0;</span><span class="removed-line">- 		//Log &amp;lt;&amp;lt; "T_surface(" &amp;lt;&amp;lt; i &amp;lt;&amp;lt; ") = " &amp;lt;&amp;lt; temp &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 	}</span><span class="removed-line">- 	T_surface = T_surf_old + myinput.data.options_piston.numeric.AlphaTh * (T_surface - T_surf_old);</span><span class="removed-line">- 	T_surf_old.free();</span><span class="removed-line">- </span><span class="removed-line">- </span><span class="removed-line">- 	//Output VTK and others</span><span class="removed-line">- 	ThermalOutput(body);</span><span class="removed-line">- </span><span class="removed-line">- 	</span><span class="removed-line">- </span><span class="removed-line">- 	//free arrays</span><span class="removed-line">- 	connf.free(); Afn.free(); phi.clear(); phi_surf.free(); faceid_qb.clear(); faceid_mixb.clear();</span><span class="removed-line">- </span><span class="removed-line">- </span><span class="removed-line">- 	Log &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 	Log &amp;lt;&amp;lt; "Done " + body + " temperature distribution!" &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 	Log &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- </span><span class="removed-line">- </span><span class="removed-line">- };</span><span class="removed-line">- </span><span class="unchanged-line">  void CThermal::CheckBoundaryFaces(string body)</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 5 (around line 1278)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	fout.close();</span><span class="unchanged-line">  	fout.clear();</span><span class="unchanged-line">  </span><span class="removed-line">- 	//white Gap Surface Face Centers Coordinate for other cylinder bores at ODC</span><span class="removed-line">- 	/*double dtheta = 2.0*PI/(double) faceid_qb.size();</span><span class="removed-line">- 	double theta = dtheta;</span><span class="removed-line">- 	if(body == 1)</span><span class="removed-line">- 	{</span><span class="removed-line">- 		for(int j=1;j&amp;lt;faceid_qb.size();j++)</span><span class="removed-line">- 		{</span><span class="removed-line">- 			int nFaces_gap;</span><span class="removed-line">- 			vector&amp;lt;int&amp;gt; Faces_gap;</span><span class="removed-line">- 			nFaces_gap = (int) faceid_qb[j].size();</span><span class="removed-line">- 			Faces_gap = faceid_qb[j];</span><span class="removed-line">- 			string output;</span><span class="removed-line">- 			string bore_n;</span><span class="removed-line">- 			char buffer[500];</span><span class="removed-line">- 			_itoa_s(j,buffer,10);</span><span class="removed-line">- 			bore_n = buffer;</span><span class="removed-line">- 			output = "./temp/piston/bushing/xyz_faces" + bore_n + ".dat";</span><span class="removed-line">- 			fout.open(output.c_str());</span><span class="removed-line">- 			fout &amp;lt;&amp;lt; nFaces_gap &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 			for(int i=0;i&amp;lt;nFaces_gap;i++)</span><span class="removed-line">- 			{				</span><span class="removed-line">- 				fout &amp;lt;&amp;lt; scientific &amp;lt;&amp;lt; xyzf(Faces_gap[i],0) * cos(theta) - xyzf(Faces_gap[i],1) * sin(theta) &amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; </span><span class="removed-line">- 					xyzf(Faces_gap[i],0) * sin(theta) + xyzf(Faces_gap[i],1) * cos(theta)&amp;lt;&amp;lt; "\t" &amp;lt;&amp;lt; xyzf(Faces_gap[i],2) &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 			}</span><span class="removed-line">- 			fout &amp;lt;&amp;lt; "*" &amp;lt;&amp;lt; "\n";</span><span class="removed-line">- 			fout.close();</span><span class="removed-line">- 			fout.clear();</span><span class="removed-line">- 			theta += dtheta;</span><span class="removed-line">- 		}</span><span class="removed-line">- 	}*/</span><span class="removed-line">- </span><span class="unchanged-line">  </span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 6 (around line 1368)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	qb.resize(nFaces);	qb=0.0;</span><span class="unchanged-line">  	for(int i=0;i&amp;lt;(int) faceid_qb.size();i++)</span><span class="unchanged-line">  	{</span><span class="removed-line">- 		//cout&amp;lt;&amp;lt;i&amp;lt;&amp;lt;endl;</span><span class="unchanged-line">  		for(int j=0;j&amp;lt;(int) faceid_qb[i].size();j++)</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><h5>‚ú® Added Code Sections:</h5><div class="function-container"><div class="function-header">‚úÖ Added Section 1 (around line 113)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	{</span><span class="unchanged-line">  		WriteGapSurfacexyz(myMesh.body);</span><span class="unchanged-line">  	};</span><span class="added-line">+ </span><span class="unchanged-line">  };</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚úÖ Added Section 2 (around line 349)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  		Log &amp;lt;&amp;lt; body &amp;lt;&amp;lt; " is an invalid entry!" &amp;lt;&amp;lt; "\n";</span><span class="unchanged-line">  		system("PAUSE");</span><span class="unchanged-line">  	}</span><span class="added-line">+ 	/*if(coupled_caspar_simulation)</span><span class="unchanged-line">  		iter.set_noisy(0);</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div></div><div class="section"><h3 class="file-title">üìÑ CThermal.h</h3><p><strong>Status:</strong> üî¥ 14 lines of code were removed</p><p><strong>Size:</strong> 4,878 ‚Üí 3,906 bytes (-972 bytes)</p><p><strong>Changes:</strong> +0 lines added, -14 lines removed</p><p><strong>Types of Changes:</strong> Functions</p><h4>üîß Code Changes (Separated by Type):</h4><h5>üóëÔ∏è Removed Code Sections:</h5><div class="function-container"><div class="function-header">‚ùå Removed Section 1 (around line 98)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	void readMeshThermal(string body);</span><span class="unchanged-line">  	//Solve thermal problem</span><span class="unchanged-line">  	void ThermalSolve(string body,vector&amp;lt;Array&amp;lt;double,1&amp;gt;&amp;gt; qbi,Array&amp;lt;double,1&amp;gt; &amp;T_body,Array&amp;lt;double,1&amp;gt; &amp;T_surface);	</span><span class="removed-line">- 	void ThermalSolve_Piston(vector&amp;lt;Array&amp;lt;double,1&amp;gt;&amp;gt; qbi, vector&amp;lt;Array&amp;lt;double,1&amp;gt;&amp;gt; wtd_h, vector&amp;lt;double&amp;gt; Tb, Array&amp;lt;double,1&amp;gt; &amp;T_body,Array&amp;lt;double,1&amp;gt; &amp;T_surface);	</span><span class="removed-line">- 	void ThermalSolve_Cylinder(vector&amp;lt;Array&amp;lt;double,1&amp;gt;&amp;gt; qbi, vector&amp;lt;Array&amp;lt;double,1&amp;gt;&amp;gt; wtd_h, vector&amp;lt;double&amp;gt; Tb, Array&amp;lt;double,1&amp;gt; &amp;T_body,Array&amp;lt;double,1&amp;gt; &amp;T_surface);	</span><span class="removed-line">- 	void ThermalSolve_interbody_conduction(vector&amp;lt;vector&amp;lt;int&amp;gt;&amp;gt; &amp;Mid_K2B, vector&amp;lt;vector&amp;lt;double&amp;gt;&amp;gt; &amp;Mwt_K2B, vector&amp;lt;vector&amp;lt;int&amp;gt;&amp;gt; &amp;Mid_B2K, vector&amp;lt;vector&amp;lt;double&amp;gt;&amp;gt; &amp;Mwt_B2K, double C);	</span><span class="removed-line">- 	void ThermalSolve_new(void);	</span><span class="removed-line">- 	void ThermalSolve_post(string body,vector&amp;lt;Array&amp;lt;double,1&amp;gt;&amp;gt; qbi,Array&amp;lt;double,1&amp;gt; &amp;T_body,Array&amp;lt;double,1&amp;gt; &amp;T_surface);	</span><span class="unchanged-line">  	//Check all part si bounded and no boundary faces are missing</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div><div class="function-container"><div class="function-header">‚ùå Removed Section 2 (around line 143)</div><div class="code-block"><span style="color: #6c757d; font-style: italic;">// ... context before ...</span>
<span class="unchanged-line">  	vector&amp;lt;vector&amp;lt;double&amp;gt;&amp;gt; matB;	//Gradient of shape functions</span><span class="unchanged-line">  	</span><span class="unchanged-line">  	vector&amp;lt;double&amp;gt; vecq;			//Load Vector</span><span class="removed-line">- 	vector&amp;lt;double&amp;gt; phi_both;</span><span class="unchanged-line">  	vector&amp;lt;double&amp;gt; phi;</span><span style="color: #6c757d; font-style: italic;">// ... context after ...</span></div></div></div><div class="section"><h3>‚úÖ Identical Files (No Changes) (2 files)</h3><ul><li><strong>CFEMThermal.cpp</strong> - ‚úÖ No changes (35,371 bytes)</li><li><strong>CFEMThermal.h</strong> - ‚úÖ No changes (1,324 bytes)</li></ul></div><div class="section"><h2>üí° Recommendations</h2><p>üîç <strong>Review 2 modified files</strong> for logic changes</p></div><hr><p><em>Report generated by Enhanced Code Comparison Tool with Complete Function View</em></p></body></html>